debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/BLESS/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': True, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'BLESS'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/BLESS//IsA.jsonl
#All Instances: 1337
#Valid Instances: 935 in BLESS (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                        subj_anchors_wordnet_sg
0    [a catfish or [Z] is a [MASK]., a catfish or [...                                         [carp]
1    [a musket or [Z] is a [MASK]., a musket or [Z]...                                [pistol, rifle]
2    [a lemon or [Z] is a [MASK]., a lemon or [Z] i...                                       [yellow]
3    [a turtle or [Z] is a [MASK]., a turtle or [Z]...              [snake, bird, fish, lizard, frog]
4    [a bag or [Z] is a [MASK]., a bag or [Z] is a ...                          [shoe, package, case]
..                                                 ...                                            ...
930  [a wrench or [Z] is a [MASK]., a wrench or [Z]...               [nail, maybe, chain, bolt, nuts]
931  [a squirrel or [Z] is a [MASK]., a squirrel or...                      [fox, badger, deer, bear]
932  [a cello or [Z] is a [MASK]., a cello or [Z] i...                [guitar, string, piano, violin]
933  [a glove or [Z] is a [MASK]., a glove or [Z] i...                                   [belt, mask]
934  [a stereo or [Z] is a [MASK]., a stereo or [Z]...  [speaker, amplifier, radio, computer, guitar]

[935 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as catfish and [Z]., [MASK], incl...                                             [carp]
1    [[MASK] such as muskets and [Z]., [MASK], incl...                                  [pistols, rifles]
2    [[MASK] such as lemon and [Z]., [MASK], includ...                                           [yellow]
3    [[MASK] such as turtles and [Z]., [MASK], incl...            [snakes, birds, fishes, lizards, frogs]
4    [[MASK] such as bags and [Z]., [MASK], includi...                           [shoes, packages, cases]
..                                                 ...                                                ...
930  [[MASK] such as wrenches and [Z]., [MASK], inc...                [nails, maybe, chains, bolts, nuts]
931  [[MASK] such as squirrel and [Z]., [MASK], inc...                          [fox, badger, deer, bear]
932  [[MASK] such as cellos and [Z]., [MASK], inclu...                [guitars, strings, pianos, violins]
933  [[MASK] such as glove and [Z]., [MASK], includ...                                      [belts, mask]
934  [[MASK] such as stereos and [Z]., [MASK], incl...  [speakers, amplifiers, radios, computers, guit...

[935 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/935 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 50%|████▉     | 464/935 [01:00<01:01,  7.72it/s] 50%|████▉     | 464/935 [01:20<01:01,  7.72it/s] 97%|█████████▋| 909/935 [02:00<00:03,  7.53it/s]100%|██████████| 935/935 [02:03<00:00,  7.56it/s]
  0%|          | 0/935 [00:00<?, ?it/s] 25%|██▍       | 232/935 [01:00<03:02,  3.85it/s] 25%|██▍       | 232/935 [01:16<03:02,  3.85it/s] 50%|█████     | 468/935 [02:00<01:59,  3.90it/s] 50%|█████     | 468/935 [02:16<01:59,  3.90it/s] 74%|███████▎  | 688/935 [03:00<01:05,  3.79it/s] 74%|███████▎  | 688/935 [03:16<01:05,  3.79it/s] 98%|█████████▊| 918/935 [04:00<00:04,  3.81it/s]100%|██████████| 935/935 [04:05<00:00,  3.81it/s]
  sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                         subj_anchors_wordnet_score            subj_anchors_wordnet_sg                  subj_anchors_wordnet_pl  \
0   catfish     [fish]      IsA  [A catfish is a [MASK]., A catfish is an [MASK].]  [sandfish, wolffish, eel, greeneye, ghostfish,...     2             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish            1  [animal, fish, insect, eel, oyster, organism, ...  {'animal': -5.884246700948145, 'fish': -7.3868...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...                                             [carp]  {'bass': 0.39879070899703284, 'carp': 0.181602...                             [carp]                                   [carp]   
1   muskets  [firearm]      IsA    [A musket is a [MASK]., A musket is an [MASK].]  [flintlock, hackbut, harquebus, firelock, arqu...     3             2       musket      muskets  [a musket is a [MASK]., a musket is a type of ...  [a musket or [Z] is a [MASK]., a musket or [Z]...  [[MASK] such as muskets., [MASK], including mu...  [[MASK] such as muskets and [Z]., [MASK], incl...  [such as muskets and [MASK]., such as muskets ...   muskets musket muskets            1  [artillery, firearm, gun, cannon, arrow, instr...  {'artillery': -6.829809756901031, 'firearm': -...  [firearm, cannon, gun, weapon, rifle, pistol, ...  {'firearm': -5.349813407088699, 'cannon': -7.0...  [weapon, firearm, gun, artillery, arm, impleme...  {'weapons': -6.112329372878857, 'firearms': -6...                                  [pistols, rifles]  {'pistols': 0.24924550476399335, 'cannons': 0....                    [pistol, rifle]                        [pistols, rifles]   
2     lemon  [produce]      IsA      [A lemon is a [MASK]., A lemon is an [MASK].]  [lemanderin, grapefruit, good, insert, button,...     4             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon            1  [apple, orange, object, adjective, olive, almo...  {'apple': -6.533058511601689, 'orange': -7.425...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...                                           [yellow]  {'lime': 0.5027932287617163, 'orange': 0.15136...                           [yellow]                                 [yellow]   
3   turtles    [beast]      IsA    [A turtle is a [MASK]., A turtle is an [MASK].]         [turtleneck, pullover, slipover, cardigan]     6             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles            1  [animal, bird, fish, person, human, object, cr...  {'animal': -5.460504933765254, 'bird': -8.7831...  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...  [snake, bird, fish, lizard, frog]  [snakes, birds, fishes, lizards, frogs]   
4      bags  [luggage]      IsA          [A bag is a [MASK]., A bag is an [MASK].]  [box, job, knocker, barrowful, measure, desser...     7             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags            1  [object, envelope, umbrella, item, accessory, ...  {'object': -7.057799467734983, 'envelope': -8....  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...                           [shoes, packages, cases]  {'boxes': 0.1638453546911478, 'yes': 0.0626923...              [shoe, package, case]                 [shoes, packages, cases]   

                            subj_anchors_wordnet_all    subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0                                             [carp]  catfish catfish catfish           1  [a catfish or a carp is a [MASK]., a catfish o...  [[MASK] such as catfish and carp., [MASK], inc...  [fish, species, carp, freshwater, salmon, pred...  {'fish': -4.270898285899183, 'species': -13.02...  [fish, species, carp, fishing, animal, reptile...  {'fish': -4.8170564855226266, 'species': -8.71...  
1                                    [pistol, rifle]   muskets musket muskets           2  [a musket or a pistol is a [MASK]., a musket o...  [[MASK] such as muskets and pistols., [MASK] s...  [firearm, weapon, gun, pistol, cannon, handgun...  {'firearm': -4.768125888670261, 'weapon': -7.2...  [weapon, firearm, gun, arm, thing, weaponry, a...  {'weapons': -5.495475819229012, 'firearms': -6...  
2                                           [yellow]        lemon lemon lemon           1  [a lemon or a yellow is a [MASK]., a lemon or ...  [[MASK] such as lemon and yellow., [MASK], inc...  [fruit, flower, orange, wine, lime, drink, app...  {'fruit': -7.371728576620542, 'flower': -9.337...  [color, colour, orange, yellow, flower, variet...  {'colors': -5.956233236265533, 'colours': -8.1...  
3  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
4                              [shoe, package, case]            bags bag bags           3  [a bag or a shoe is a [MASK]., a bag or a pack...  [[MASK] such as bags and shoes., [MASK] such a...  [container, luggage, shoe, backpack, clothing,...  {'container': -7.055212893260816, 'luggage': -...  [item, thing, luggage, object, good, belonging...  {'items': -7.653512465214155, 'things': -7.722...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  36.2 	  60.9 	   60.9 	  45.8 
  1 	 subj_anchors_wordnet_all 	  36.2 	  60.9 	   62.7 	  46   
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  16.4 	  32.7 	   42.4 	  23.6 	              1 
  2 	 lsp_sap     	  16.1 	  36.6 	   49.6 	  25.1 	              3 
  3 	 def_dap     	  17.1 	  37.1 	   47.7 	  25.5 	              2 
  4 	 lsp_dap     	  17.1 	  37.5 	   51.4 	  26   	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.BLESS.tsv
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.BLESS.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/BLESS/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': True, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'BLESS'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/BLESS//IsA.jsonl
#All Instances: 1337
#Valid Instances: 935 in BLESS (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                        subj_anchors_wordnet_sg
0    [a catfish or [Z] is a [MASK]., a catfish or [...                                         [carp]
1    [a musket or [Z] is a [MASK]., a musket or [Z]...                                [pistol, rifle]
2    [a lemon or [Z] is a [MASK]., a lemon or [Z] i...                                       [yellow]
3    [a turtle or [Z] is a [MASK]., a turtle or [Z]...              [snake, bird, fish, lizard, frog]
4    [a bag or [Z] is a [MASK]., a bag or [Z] is a ...                          [shoe, case, package]
..                                                 ...                                            ...
930  [a wrench or [Z] is a [MASK]., a wrench or [Z]...               [nail, maybe, chain, bolt, nuts]
931  [a squirrel or [Z] is a [MASK]., a squirrel or...                      [deer, bear, badger, fox]
932  [a cello or [Z] is a [MASK]., a cello or [Z] i...                [string, piano, violin, guitar]
933  [a glove or [Z] is a [MASK]., a glove or [Z] i...                                   [belt, mask]
934  [a stereo or [Z] is a [MASK]., a stereo or [Z]...  [speaker, amplifier, radio, computer, guitar]

[935 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as catfish and [Z]., [MASK], incl...                                             [carp]
1    [[MASK] such as muskets and [Z]., [MASK], incl...                                  [pistols, rifles]
2    [[MASK] such as lemon and [Z]., [MASK], includ...                                           [yellow]
3    [[MASK] such as turtles and [Z]., [MASK], incl...            [snakes, birds, fishes, lizards, frogs]
4    [[MASK] such as bags and [Z]., [MASK], includi...                           [shoes, cases, packages]
..                                                 ...                                                ...
930  [[MASK] such as wrenches and [Z]., [MASK], inc...                [nails, maybe, chains, bolts, nuts]
931  [[MASK] such as squirrel and [Z]., [MASK], inc...                          [deer, bear, badger, fox]
932  [[MASK] such as cellos and [Z]., [MASK], inclu...                [strings, pianos, violins, guitars]
933  [[MASK] such as glove and [Z]., [MASK], includ...                                      [belts, mask]
934  [[MASK] such as stereos and [Z]., [MASK], incl...  [speakers, amplifiers, radios, computers, guit...

[935 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/935 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 50%|█████     | 468/935 [01:00<00:59,  7.80it/s] 50%|█████     | 468/935 [01:20<00:59,  7.80it/s] 98%|█████████▊| 917/935 [02:00<00:02,  7.61it/s]100%|██████████| 935/935 [02:02<00:00,  7.62it/s]
  0%|          | 0/935 [00:00<?, ?it/s] 25%|██▌       | 234/935 [01:00<02:59,  3.90it/s] 25%|██▌       | 234/935 [01:17<02:59,  3.90it/s] 50%|█████     | 472/935 [02:00<01:57,  3.92it/s] 50%|█████     | 472/935 [02:17<01:57,  3.92it/s] 74%|███████▍  | 693/935 [03:00<01:03,  3.81it/s] 74%|███████▍  | 693/935 [03:17<01:03,  3.81it/s] 99%|█████████▉| 926/935 [04:00<00:02,  3.83it/s]100%|██████████| 935/935 [04:03<00:00,  3.84it/s]
  sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                         subj_anchors_wordnet_score            subj_anchors_wordnet_sg                  subj_anchors_wordnet_pl  \
0   catfish     [fish]      IsA  [A catfish is a [MASK]., A catfish is an [MASK].]  [sandfish, wolffish, eel, greeneye, ghostfish,...     2             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish            1  [animal, fish, insect, eel, oyster, organism, ...  {'animal': -5.884246700948145, 'fish': -7.3868...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...                                             [carp]  {'bass': 0.39879070899703284, 'carp': 0.181602...                             [carp]                                   [carp]   
1   muskets  [firearm]      IsA    [A musket is a [MASK]., A musket is an [MASK].]  [flintlock, hackbut, harquebus, firelock, arqu...     3             2       musket      muskets  [a musket is a [MASK]., a musket is a type of ...  [a musket or [Z] is a [MASK]., a musket or [Z]...  [[MASK] such as muskets., [MASK], including mu...  [[MASK] such as muskets and [Z]., [MASK], incl...  [such as muskets and [MASK]., such as muskets ...   muskets musket muskets            1  [artillery, firearm, gun, cannon, arrow, instr...  {'artillery': -6.829809756901031, 'firearm': -...  [firearm, cannon, gun, weapon, rifle, pistol, ...  {'firearm': -5.349813407088699, 'cannon': -7.0...  [weapon, firearm, gun, artillery, arm, impleme...  {'weapons': -6.112329372878857, 'firearms': -6...                                  [pistols, rifles]  {'pistols': 0.24924550476399335, 'cannons': 0....                    [pistol, rifle]                        [pistols, rifles]   
2     lemon  [produce]      IsA      [A lemon is a [MASK]., A lemon is an [MASK].]  [lemanderin, grapefruit, good, insert, button,...     4             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon            1  [apple, orange, object, adjective, olive, almo...  {'apple': -6.533058511601689, 'orange': -7.425...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...                                           [yellow]  {'lime': 0.5027932287617163, 'orange': 0.15136...                           [yellow]                                 [yellow]   
3   turtles    [beast]      IsA    [A turtle is a [MASK]., A turtle is an [MASK].]         [turtleneck, pullover, slipover, cardigan]     6             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles            1  [animal, bird, fish, person, human, object, cr...  {'animal': -5.460504933765254, 'bird': -8.7831...  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...  [snake, bird, fish, lizard, frog]  [snakes, birds, fishes, lizards, frogs]   
4      bags  [luggage]      IsA          [A bag is a [MASK]., A bag is an [MASK].]  [box, job, knocker, barrowful, measure, desser...     7             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags            1  [object, envelope, umbrella, item, accessory, ...  {'object': -7.057799467734983, 'envelope': -8....  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...                           [shoes, cases, packages]  {'boxes': 0.1638453546911478, 'yes': 0.0626923...              [shoe, case, package]                 [shoes, cases, packages]   

                            subj_anchors_wordnet_all    subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0                                             [carp]  catfish catfish catfish           1  [a catfish or a carp is a [MASK]., a catfish o...  [[MASK] such as catfish and carp., [MASK], inc...  [fish, species, carp, freshwater, salmon, pred...  {'fish': -4.270898285899183, 'species': -13.02...  [fish, species, carp, fishing, animal, reptile...  {'fish': -4.8170564855226266, 'species': -8.71...  
1                                    [pistol, rifle]   muskets musket muskets           2  [a musket or a pistol is a [MASK]., a musket o...  [[MASK] such as muskets and pistols., [MASK] s...  [firearm, weapon, gun, pistol, cannon, handgun...  {'firearm': -4.768125888670261, 'weapon': -7.2...  [weapon, firearm, gun, arm, thing, weaponry, a...  {'weapons': -5.495475819229012, 'firearms': -6...  
2                                           [yellow]        lemon lemon lemon           1  [a lemon or a yellow is a [MASK]., a lemon or ...  [[MASK] such as lemon and yellow., [MASK], inc...  [fruit, flower, orange, wine, lime, drink, app...  {'fruit': -7.371728576620542, 'flower': -9.337...  [color, colour, orange, yellow, flower, variet...  {'colors': -5.956233236265533, 'colours': -8.1...  
3  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
4                              [shoe, case, package]            bags bag bags           3  [a bag or a shoe is a [MASK]., a bag or a case...  [[MASK] such as bags and shoes., [MASK] such a...  [container, luggage, shoe, backpack, clothing,...  {'container': -7.055212893260816, 'luggage': -...  [item, thing, luggage, object, good, belonging...  {'items': -7.653512465214155, 'things': -7.722...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  37.1 	  60.5 	   60.5 	  46.4 
  1 	 subj_anchors_wordnet_all 	  37.1 	  60.5 	   62.7 	  46.7 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  16.4 	  32.7 	   42.4 	  23.6 	              1 
  2 	 lsp_sap     	  16.1 	  36.6 	   49.6 	  25.1 	              3 
  3 	 def_dap     	  17.1 	  37   	   47.7 	  25.5 	              2 
  4 	 lsp_dap     	  17.2 	  37.3 	   51.7 	  26   	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.BLESS.tsv
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.BLESS.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/BLESS/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': True, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'BLESS'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/BLESS//IsA.jsonl
#All Instances: 1337
#Valid Instances: 935 in BLESS (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                        subj_anchors_wordnet_sg
0    [a catfish or [Z] is a [MASK]., a catfish or [...                                         [carp]
1    [a musket or [Z] is a [MASK]., a musket or [Z]...                                [rifle, pistol]
2    [a lemon or [Z] is a [MASK]., a lemon or [Z] i...                                       [yellow]
3    [a turtle or [Z] is a [MASK]., a turtle or [Z]...              [snake, bird, fish, lizard, frog]
4    [a bag or [Z] is a [MASK]., a bag or [Z] is a ...                          [shoe, package, case]
..                                                 ...                                            ...
930  [a wrench or [Z] is a [MASK]., a wrench or [Z]...               [nail, maybe, chain, bolt, nuts]
931  [a squirrel or [Z] is a [MASK]., a squirrel or...                      [bear, deer, badger, fox]
932  [a cello or [Z] is a [MASK]., a cello or [Z] i...                [string, guitar, violin, piano]
933  [a glove or [Z] is a [MASK]., a glove or [Z] i...                                   [mask, belt]
934  [a stereo or [Z] is a [MASK]., a stereo or [Z]...  [speaker, amplifier, radio, computer, guitar]

[935 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as catfish and [Z]., [MASK], incl...                                             [carp]
1    [[MASK] such as muskets and [Z]., [MASK], incl...                                  [rifles, pistols]
2    [[MASK] such as lemon and [Z]., [MASK], includ...                                           [yellow]
3    [[MASK] such as turtles and [Z]., [MASK], incl...            [snakes, birds, fishes, lizards, frogs]
4    [[MASK] such as bags and [Z]., [MASK], includi...                           [shoes, packages, cases]
..                                                 ...                                                ...
930  [[MASK] such as wrenches and [Z]., [MASK], inc...                [nails, maybe, chains, bolts, nuts]
931  [[MASK] such as squirrel and [Z]., [MASK], inc...                          [bear, deer, badger, fox]
932  [[MASK] such as cellos and [Z]., [MASK], inclu...                [strings, guitars, violins, pianos]
933  [[MASK] such as glove and [Z]., [MASK], includ...                                      [mask, belts]
934  [[MASK] such as stereos and [Z]., [MASK], incl...  [speakers, amplifiers, radios, computers, guit...

[935 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/935 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 50%|█████     | 469/935 [01:00<00:59,  7.81it/s] 50%|█████     | 469/935 [01:20<00:59,  7.81it/s] 99%|█████████▊| 922/935 [02:00<00:01,  7.65it/s]100%|██████████| 935/935 [02:02<00:00,  7.65it/s]
  0%|          | 0/935 [00:00<?, ?it/s] 25%|██▌       | 235/935 [01:00<02:58,  3.91it/s] 25%|██▌       | 235/935 [01:17<02:58,  3.91it/s] 51%|█████     | 474/935 [02:00<01:56,  3.94it/s] 51%|█████     | 474/935 [02:17<01:56,  3.94it/s] 75%|███████▍  | 699/935 [03:00<01:01,  3.85it/s] 75%|███████▍  | 699/935 [03:17<01:01,  3.85it/s]100%|█████████▉| 931/935 [04:00<00:01,  3.86it/s]100%|██████████| 935/935 [04:01<00:00,  3.87it/s]
  sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                         subj_anchors_wordnet_score            subj_anchors_wordnet_sg                  subj_anchors_wordnet_pl  \
0   catfish     [fish]      IsA  [A catfish is a [MASK]., A catfish is an [MASK].]  [sandfish, wolffish, eel, greeneye, ghostfish,...     2             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish            1  [animal, fish, insect, eel, oyster, organism, ...  {'animal': -5.884246700948145, 'fish': -7.3868...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...                                             [carp]  {'bass': 0.39879070899703284, 'carp': 0.181602...                             [carp]                                   [carp]   
1   muskets  [firearm]      IsA    [A musket is a [MASK]., A musket is an [MASK].]  [flintlock, hackbut, harquebus, firelock, arqu...     3             2       musket      muskets  [a musket is a [MASK]., a musket is a type of ...  [a musket or [Z] is a [MASK]., a musket or [Z]...  [[MASK] such as muskets., [MASK], including mu...  [[MASK] such as muskets and [Z]., [MASK], incl...  [such as muskets and [MASK]., such as muskets ...   muskets musket muskets            1  [artillery, firearm, gun, cannon, arrow, instr...  {'artillery': -6.829809756901031, 'firearm': -...  [firearm, cannon, gun, weapon, rifle, pistol, ...  {'firearm': -5.349813407088699, 'cannon': -7.0...  [weapon, firearm, gun, artillery, arm, impleme...  {'weapons': -6.112329372878857, 'firearms': -6...                                  [rifles, pistols]  {'pistols': 0.24924550476399335, 'cannons': 0....                    [rifle, pistol]                        [rifles, pistols]   
2     lemon  [produce]      IsA      [A lemon is a [MASK]., A lemon is an [MASK].]  [lemanderin, grapefruit, good, insert, button,...     4             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon            1  [apple, orange, object, adjective, olive, almo...  {'apple': -6.533058511601689, 'orange': -7.425...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...                                           [yellow]  {'lime': 0.5027932287617163, 'orange': 0.15136...                           [yellow]                                 [yellow]   
3   turtles    [beast]      IsA    [A turtle is a [MASK]., A turtle is an [MASK].]         [turtleneck, pullover, slipover, cardigan]     6             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles            1  [animal, bird, fish, person, human, object, cr...  {'animal': -5.460504933765254, 'bird': -8.7831...  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...  [snake, bird, fish, lizard, frog]  [snakes, birds, fishes, lizards, frogs]   
4      bags  [luggage]      IsA          [A bag is a [MASK]., A bag is an [MASK].]  [box, job, knocker, barrowful, measure, desser...     7             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags            1  [object, envelope, umbrella, item, accessory, ...  {'object': -7.057799467734983, 'envelope': -8....  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...                           [shoes, packages, cases]  {'boxes': 0.1638453546911478, 'yes': 0.0626923...              [shoe, package, case]                 [shoes, packages, cases]   

                            subj_anchors_wordnet_all    subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0                                             [carp]  catfish catfish catfish           1  [a catfish or a carp is a [MASK]., a catfish o...  [[MASK] such as catfish and carp., [MASK], inc...  [fish, species, carp, freshwater, salmon, pred...  {'fish': -4.270898285899183, 'species': -13.02...  [fish, species, carp, fishing, animal, reptile...  {'fish': -4.8170564855226266, 'species': -8.71...  
1                                    [rifle, pistol]   muskets musket muskets           2  [a musket or a rifle is a [MASK]., a musket or...  [[MASK] such as muskets and rifles., [MASK] su...  [firearm, weapon, gun, pistol, cannon, handgun...  {'firearm': -4.768125888670261, 'weapon': -7.2...  [weapon, firearm, gun, arm, thing, weaponry, a...  {'weapons': -5.495475819229011, 'firearms': -6...  
2                                           [yellow]        lemon lemon lemon           1  [a lemon or a yellow is a [MASK]., a lemon or ...  [[MASK] such as lemon and yellow., [MASK], inc...  [fruit, flower, orange, wine, lime, drink, app...  {'fruit': -7.371728576620542, 'flower': -9.337...  [color, colour, orange, yellow, flower, variet...  {'colors': -5.956233236265533, 'colours': -8.1...  
3  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
4                              [shoe, package, case]            bags bag bags           3  [a bag or a shoe is a [MASK]., a bag or a pack...  [[MASK] such as bags and shoes., [MASK] such a...  [container, luggage, shoe, backpack, clothing,...  {'container': -7.055212893260816, 'luggage': -...  [item, thing, luggage, object, good, belonging...  {'items': -7.653512465214155, 'things': -7.722...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  31.8 	  60.8 	   60.8 	  43.7 
  1 	 subj_anchors_wordnet_all 	  31.8 	  60.8 	   62.7 	  44   
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  16.4 	  32.7 	   42.4 	  23.6 	              1 
  2 	 lsp_sap     	  16.1 	  36.6 	   49.6 	  25.1 	              3 
  3 	 def_dap     	  17.1 	  37   	   47.7 	  25.5 	              2 
  4 	 lsp_dap     	  17.1 	  37.4 	   51.8 	  26   	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.BLESS.tsv
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.BLESS.csv
