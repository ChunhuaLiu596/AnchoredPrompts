debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'SWOW', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'OnlySWOWStrength', 'add_swow_filter': False, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                          subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...   [bass, carp, shrimp, perch, alligator]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...       [lime, orange, apple, yes, cherry]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...        [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...        [box, yes, shoe, case, obviously]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...    [fox, deer, squirrels, mouse, rodent]
...                                                 ...                                      ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...  [artist, poet, editor, actor, musician]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...      [house, shed, barn, garden, street]

[2094 rows x 2 columns]
                                                lsp_dap                               subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...  [basses, carp, shrimps, perches, alligators]
1     [[MASK] such as lemon and [Z]., [MASK], includ...        [limes, orange, apples, yes, cherries]
2     [[MASK] such as turtles and [Z]., [MASK], incl...       [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...         [boxes, yes, shoes, cases, obviously]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...       [foxes, deer, squirrels, mice, rodents]
...                                                 ...                                           ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2092  [[MASK] such as writers and [Z]., [MASK], incl...  [artists, poets, editors, actors, musicians]
2093  [[MASK] such as yard and [Z]., [MASK], includi...        [houses, shed, barn, gardens, streets]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 13%|█▎        | 282/2094 [01:00<06:26,  4.69it/s] 13%|█▎        | 282/2094 [01:20<06:26,  4.69it/s] 27%|██▋       | 564/2094 [02:00<05:26,  4.69it/s] 27%|██▋       | 564/2094 [02:20<05:26,  4.69it/s] 40%|████      | 845/2094 [03:00<04:26,  4.68it/s] 40%|████      | 845/2094 [03:20<04:26,  4.68it/s] 54%|█████▍    | 1126/2094 [04:00<03:26,  4.68it/s] 54%|█████▍    | 1126/2094 [04:20<03:26,  4.68it/s] 67%|██████▋   | 1407/2094 [05:00<02:26,  4.68it/s] 67%|██████▋   | 1407/2094 [05:20<02:26,  4.68it/s] 81%|████████  | 1689/2094 [06:00<01:26,  4.68it/s] 81%|████████  | 1689/2094 [06:20<01:26,  4.68it/s] 94%|█████████▍| 1970/2094 [07:00<00:26,  4.68it/s] 94%|█████████▍| 1970/2094 [07:20<00:26,  4.68it/s]100%|██████████| 2094/2094 [07:27<00:00,  4.68it/s]
  0%|          | 0/2094 [00:00<?, ?it/s]  7%|▋         | 142/2094 [01:00<13:45,  2.36it/s]  7%|▋         | 142/2094 [01:12<13:45,  2.36it/s] 14%|█▎        | 284/2094 [02:00<12:48,  2.36it/s] 14%|█▎        | 284/2094 [02:12<12:48,  2.36it/s] 20%|██        | 426/2094 [03:00<11:46,  2.36it/s] 20%|██        | 426/2094 [03:12<11:46,  2.36it/s] 27%|██▋       | 567/2094 [04:00<10:49,  2.35it/s] 27%|██▋       | 567/2094 [04:12<10:49,  2.35it/s] 33%|███▎      | 701/2094 [05:01<10:04,  2.31it/s] 33%|███▎      | 701/2094 [05:12<10:04,  2.31it/s] 40%|████      | 842/2094 [06:01<09:00,  2.32it/s] 40%|████      | 842/2094 [06:12<09:00,  2.32it/s] 47%|████▋     | 984/2094 [07:01<07:56,  2.33it/s] 47%|████▋     | 984/2094 [07:12<07:56,  2.33it/s] 54%|█████▍    | 1126/2094 [08:01<06:53,  2.34it/s] 54%|█████▍    | 1126/2094 [08:12<06:53,  2.34it/s] 61%|██████    | 1268/2094 [09:01<05:51,  2.35it/s] 61%|██████    | 1268/2094 [09:12<05:51,  2.35it/s] 67%|██████▋   | 1410/2094 [10:01<04:50,  2.35it/s] 67%|██████▋   | 1410/2094 [10:12<04:50,  2.35it/s] 74%|███████▍  | 1552/2094 [11:01<03:50,  2.36it/s] 74%|███████▍  | 1552/2094 [11:13<03:50,  2.36it/s] 81%|████████  | 1695/2094 [12:02<02:49,  2.36it/s] 81%|████████  | 1695/2094 [12:13<02:49,  2.36it/s] 88%|████████▊ | 1837/2094 [13:02<01:49,  2.36it/s] 88%|████████▊ | 1837/2094 [13:13<01:49,  2.36it/s] 94%|█████████▍| 1972/2094 [14:03<00:52,  2.32it/s] 94%|█████████▍| 1972/2094 [14:23<00:52,  2.32it/s]100%|██████████| 2094/2094 [14:54<00:00,  2.34it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                         subj_anchors_sg                               subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...  [bass, carp, shrimp, perch, alligator, trout, ...  {'bass': 0.39879070899703284, 'carp': 0.181602...  [bass, carp, shrimp, perch, alligator]  [basses, carp, shrimps, perches, alligators]  [bass, carp, shrimp, perch, alligator, trout, ...  catfish catfish catfish          10   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...  [lime, orange, apple, yes, cherry, water, pepp...  {'lime': 0.5027932287617163, 'orange': 0.15136...      [lime, orange, apple, yes, cherry]        [limes, orange, apples, yes, cherries]  [lime, orange, apple, yes, cherry, water, pepp...        lemon lemon lemon          10   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...       [snake, bird, fish, lizard, frog]       [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...  [boxes, yes, shoes, cases, obviously, yeah, cl...  {'boxes': 0.1638453546911478, 'yes': 0.0626923...       [box, yes, shoe, case, obviously]         [boxes, yes, shoes, cases, obviously]  [box, yes, shoe, case, obviously, yeah, clothe...            bags bag bags          10   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....  [foxes, deer, squirrels, mice, rodents, rats, ...  {'foxes': 0.21225315535610373, 'deer': 0.16438...   [fox, deer, squirrels, mouse, rodent]       [foxes, deer, squirrels, mice, rodents]  [fox, deer, squirrels, mouse, rodent, rat, dog...   rabbits rabbit rabbits          10   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a bass is a [MASK]., a catfish o...  [[MASK] such as catfish and basses., [MASK] su...  [fish, species, turtle, shrimp, crocodile, pre...  {'fish': -4.49076650378941, 'species': -12.787...  [fish, species, animal, seafood, invertebrates...  {'fish': -5.132430900941943, 'species': -9.238...  
1  [a lemon or a lime is a [MASK]., a lemon or an...  [[MASK] such as lemon and limes., [MASK] such ...  [fruit, drink, apple, lime, candy, yes, berry,...  {'fruit': -6.215222270411444, 'drink': -9.5472...  [fruit, thing, citrus, lime, yes, apple, flavo...  {'fruits': -6.38605876173733, 'fruit': -6.9349...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a box is a [MASK]., a bag or a yes i...  [[MASK] such as bags and boxes., [MASK] such a...  [container, luggage, backpack, suitcase, yes, ...  {'container': -7.19792714910603, 'luggage': -8...  [thing, item, stuff, luggage, object, yes, goo...  {'things': -7.003505253732369, 'items': -8.343...  
4  [a rabbit or a fox is a [MASK]., a rabbit or a...  [[MASK] such as rabbits and foxes., [MASK] suc...  [mammal, animal, dog, mouse, creature, bird, c...  {'mammal': -6.555871063773531, 'animal': -6.69...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.978859688699233, 'rodents': -7....  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  13.6 	  34.8 	   34.8 	  21.4 
  1 	 subj_anchors_all 	  13.6 	  34.8 	   45   	  22.7 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.8 	  37.6 	   49.1 	  24.5 	              2 
  4 	 lsp_dap     	  13.1 	  33.6 	   44.9 	  22.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWStrength.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWStrength.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'SWOW', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'OnlySWOWStrength', 'add_swow_filter': False, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                          subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...   [bass, carp, shrimp, perch, alligator]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...       [lime, orange, apple, yes, cherry]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...        [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...        [box, yes, shoe, case, obviously]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...    [fox, deer, squirrels, mouse, rodent]
...                                                 ...                                      ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...  [artist, poet, editor, actor, musician]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...      [house, shed, barn, garden, street]

[2094 rows x 2 columns]
                                                lsp_dap                               subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...  [basses, carp, shrimps, perches, alligators]
1     [[MASK] such as lemon and [Z]., [MASK], includ...        [limes, orange, apples, yes, cherries]
2     [[MASK] such as turtles and [Z]., [MASK], incl...       [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...         [boxes, yes, shoes, cases, obviously]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...       [foxes, deer, squirrels, mice, rodents]
...                                                 ...                                           ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2092  [[MASK] such as writers and [Z]., [MASK], incl...  [artists, poets, editors, actors, musicians]
2093  [[MASK] such as yard and [Z]., [MASK], includi...        [houses, shed, barn, gardens, streets]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 13%|█▎        | 279/2094 [01:00<06:30,  4.65it/s] 13%|█▎        | 279/2094 [01:20<06:30,  4.65it/s] 26%|██▌       | 549/2094 [02:00<05:39,  4.55it/s] 26%|██▌       | 549/2094 [02:20<05:39,  4.55it/s] 39%|███▉      | 814/2094 [03:00<04:45,  4.48it/s] 39%|███▉      | 814/2094 [03:20<04:45,  4.48it/s] 52%|█████▏    | 1079/2094 [04:00<03:47,  4.45it/s] 52%|█████▏    | 1079/2094 [04:20<03:47,  4.45it/s] 64%|██████▍   | 1344/2094 [05:00<02:49,  4.44it/s] 64%|██████▍   | 1344/2094 [05:20<02:49,  4.44it/s] 77%|███████▋  | 1609/2094 [06:00<01:49,  4.43it/s] 77%|███████▋  | 1609/2094 [06:20<01:49,  4.43it/s] 89%|████████▉ | 1874/2094 [07:00<00:49,  4.42it/s] 89%|████████▉ | 1874/2094 [07:20<00:49,  4.42it/s]100%|██████████| 2094/2094 [07:50<00:00,  4.45it/s]
  0%|          | 0/2094 [00:00<?, ?it/s]  6%|▋         | 134/2094 [01:00<14:43,  2.22it/s]  6%|▋         | 134/2094 [01:19<14:43,  2.22it/s] 13%|█▎        | 268/2094 [02:00<13:41,  2.22it/s] 13%|█▎        | 268/2094 [02:19<13:41,  2.22it/s] 19%|█▉        | 402/2094 [03:01<12:41,  2.22it/s] 19%|█▉        | 402/2094 [03:19<12:41,  2.22it/s] 26%|██▌       | 543/2094 [04:01<11:23,  2.27it/s] 26%|██▌       | 543/2094 [04:19<11:23,  2.27it/s] 33%|███▎      | 684/2094 [05:01<10:14,  2.29it/s] 33%|███▎      | 684/2094 [05:19<10:14,  2.29it/s] 39%|███▉      | 824/2094 [06:01<09:10,  2.31it/s] 39%|███▉      | 824/2094 [06:19<09:10,  2.31it/s] 46%|████▌     | 965/2094 [07:02<08:07,  2.32it/s] 46%|████▌     | 965/2094 [07:19<08:07,  2.32it/s] 53%|█████▎    | 1106/2094 [08:02<07:05,  2.32it/s] 53%|█████▎    | 1106/2094 [08:19<07:05,  2.32it/s] 60%|█████▉    | 1247/2094 [09:02<06:03,  2.33it/s] 60%|█████▉    | 1247/2094 [09:19<06:03,  2.33it/s] 66%|██████▋   | 1388/2094 [10:02<05:02,  2.33it/s] 66%|██████▋   | 1388/2094 [10:19<05:02,  2.33it/s] 73%|███████▎  | 1529/2094 [11:02<04:01,  2.34it/s] 73%|███████▎  | 1529/2094 [11:19<04:01,  2.34it/s] 80%|███████▉  | 1670/2094 [12:03<03:01,  2.34it/s] 80%|███████▉  | 1670/2094 [12:19<03:01,  2.34it/s] 86%|████████▋ | 1811/2094 [13:03<02:00,  2.34it/s] 86%|████████▋ | 1811/2094 [13:19<02:00,  2.34it/s] 93%|█████████▎| 1952/2094 [14:03<01:00,  2.34it/s] 93%|█████████▎| 1952/2094 [14:19<01:00,  2.34it/s]100%|█████████▉| 2093/2094 [15:03<00:00,  2.34it/s]100%|██████████| 2094/2094 [15:03<00:00,  2.32it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                         subj_anchors_sg                               subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...  [bass, carp, shrimp, perch, alligator, trout, ...  {'bass': 0.39879070899703284, 'carp': 0.181602...  [bass, carp, shrimp, perch, alligator]  [basses, carp, shrimps, perches, alligators]  [bass, carp, shrimp, perch, alligator, trout, ...  catfish catfish catfish          10   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...  [lime, orange, apple, yes, cherry, water, pepp...  {'lime': 0.5027932287617163, 'orange': 0.15136...      [lime, orange, apple, yes, cherry]        [limes, orange, apples, yes, cherries]  [lime, orange, apple, yes, cherry, water, pepp...        lemon lemon lemon          10   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...       [snake, bird, fish, lizard, frog]       [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...  [boxes, yes, shoes, cases, obviously, yeah, cl...  {'boxes': 0.1638453546911478, 'yes': 0.0626923...       [box, yes, shoe, case, obviously]         [boxes, yes, shoes, cases, obviously]  [box, yes, shoe, case, obviously, yeah, clothe...            bags bag bags          10   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....  [foxes, deer, squirrels, mice, rodents, rats, ...  {'foxes': 0.21225315535610373, 'deer': 0.16438...   [fox, deer, squirrels, mouse, rodent]       [foxes, deer, squirrels, mice, rodents]  [fox, deer, squirrels, mouse, rodent, rat, dog...   rabbits rabbit rabbits          10   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a bass is a [MASK]., a catfish o...  [[MASK] such as catfish and basses., [MASK] su...  [fish, species, turtle, shrimp, crocodile, pre...  {'fish': -4.49076650378941, 'species': -12.787...  [fish, species, animal, seafood, invertebrates...  {'fish': -5.132430900941943, 'species': -9.238...  
1  [a lemon or a lime is a [MASK]., a lemon or an...  [[MASK] such as lemon and limes., [MASK] such ...  [fruit, drink, apple, lime, candy, yes, berry,...  {'fruit': -6.215222270411444, 'drink': -9.5472...  [fruit, thing, citrus, lime, yes, apple, flavo...  {'fruits': -6.38605876173733, 'fruit': -6.9349...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a box is a [MASK]., a bag or a yes i...  [[MASK] such as bags and boxes., [MASK] such a...  [container, luggage, backpack, suitcase, yes, ...  {'container': -7.19792714910603, 'luggage': -8...  [thing, item, stuff, luggage, object, yes, goo...  {'things': -7.003505253732369, 'items': -8.343...  
4  [a rabbit or a fox is a [MASK]., a rabbit or a...  [[MASK] such as rabbits and foxes., [MASK] suc...  [mammal, animal, dog, mouse, creature, bird, c...  {'mammal': -6.555871063773531, 'animal': -6.69...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.978859688699233, 'rodents': -7....  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  13.6 	  34.8 	   34.8 	  21.4 
  1 	 subj_anchors_all 	  13.6 	  34.8 	   45   	  22.7 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.8 	  37.6 	   49.1 	  24.5 	              2 
  4 	 lsp_dap     	  13.1 	  33.6 	   44.9 	  22.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWStrength.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWStrength.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'SWOW', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'OnlySWOWStrength', 'add_swow_filter': False, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                          subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...   [bass, carp, shrimp, perch, alligator]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...       [lime, orange, apple, yes, cherry]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...        [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...        [box, yes, shoe, case, obviously]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...    [fox, deer, squirrels, mouse, rodent]
...                                                 ...                                      ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...  [artist, poet, editor, actor, musician]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...      [house, shed, barn, garden, street]

[2094 rows x 2 columns]
                                                lsp_dap                               subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...  [basses, carp, shrimps, perches, alligators]
1     [[MASK] such as lemon and [Z]., [MASK], includ...        [limes, orange, apples, yes, cherries]
2     [[MASK] such as turtles and [Z]., [MASK], incl...       [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...         [boxes, yes, shoes, cases, obviously]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...       [foxes, deer, squirrels, mice, rodents]
...                                                 ...                                           ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2092  [[MASK] such as writers and [Z]., [MASK], incl...  [artists, poets, editors, actors, musicians]
2093  [[MASK] such as yard and [Z]., [MASK], includi...        [houses, shed, barn, gardens, streets]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 14%|█▎        | 283/2094 [01:00<06:24,  4.71it/s] 14%|█▎        | 283/2094 [01:20<06:24,  4.71it/s] 27%|██▋       | 567/2094 [02:00<05:23,  4.72it/s] 27%|██▋       | 567/2094 [02:20<05:23,  4.72it/s] 41%|████      | 851/2094 [03:00<04:23,  4.73it/s] 41%|████      | 851/2094 [03:20<04:23,  4.73it/s] 54%|█████▍    | 1135/2094 [04:00<03:22,  4.72it/s] 54%|█████▍    | 1135/2094 [04:20<03:22,  4.72it/s] 68%|██████▊   | 1419/2094 [05:00<02:22,  4.73it/s] 68%|██████▊   | 1419/2094 [05:20<02:22,  4.73it/s] 81%|████████▏ | 1703/2094 [06:00<01:22,  4.73it/s] 81%|████████▏ | 1703/2094 [06:20<01:22,  4.73it/s] 95%|█████████▍| 1987/2094 [07:00<00:22,  4.72it/s] 95%|█████████▍| 1987/2094 [07:20<00:22,  4.72it/s]100%|██████████| 2094/2094 [07:23<00:00,  4.72it/s]
  0%|          | 0/2094 [00:00<?, ?it/s]  7%|▋         | 144/2094 [01:00<13:37,  2.39it/s]  7%|▋         | 144/2094 [01:16<13:37,  2.39it/s] 14%|█▍        | 288/2094 [02:00<12:36,  2.39it/s] 14%|█▍        | 288/2094 [02:16<12:36,  2.39it/s] 21%|██        | 432/2094 [03:00<11:36,  2.39it/s] 21%|██        | 432/2094 [03:16<11:36,  2.39it/s] 27%|██▋       | 575/2094 [04:01<10:37,  2.38it/s] 27%|██▋       | 575/2094 [04:16<10:37,  2.38it/s] 34%|███▍      | 718/2094 [05:01<09:37,  2.38it/s] 34%|███▍      | 718/2094 [05:16<09:37,  2.38it/s] 41%|████      | 861/2094 [06:01<08:38,  2.38it/s] 41%|████      | 861/2094 [06:16<08:38,  2.38it/s] 48%|████▊     | 1004/2094 [07:01<07:38,  2.38it/s] 48%|████▊     | 1004/2094 [07:16<07:38,  2.38it/s] 55%|█████▍    | 1148/2094 [08:01<06:37,  2.38it/s] 55%|█████▍    | 1148/2094 [08:16<06:37,  2.38it/s] 62%|██████▏   | 1292/2094 [09:02<05:36,  2.38it/s] 62%|██████▏   | 1292/2094 [09:16<05:36,  2.38it/s] 69%|██████▊   | 1435/2094 [10:02<04:36,  2.38it/s] 69%|██████▊   | 1435/2094 [10:16<04:36,  2.38it/s] 75%|███████▌  | 1579/2094 [11:02<03:35,  2.38it/s] 75%|███████▌  | 1579/2094 [11:16<03:35,  2.38it/s] 82%|████████▏ | 1723/2094 [12:02<02:35,  2.39it/s] 82%|████████▏ | 1723/2094 [12:16<02:35,  2.39it/s] 89%|████████▉ | 1866/2094 [13:02<01:35,  2.38it/s] 89%|████████▉ | 1866/2094 [13:16<01:35,  2.38it/s] 96%|█████████▌| 2010/2094 [14:03<00:35,  2.39it/s] 96%|█████████▌| 2010/2094 [14:16<00:35,  2.39it/s]100%|██████████| 2094/2094 [14:38<00:00,  2.38it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                         subj_anchors_sg                               subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...  [bass, carp, shrimp, perch, alligator, trout, ...  {'bass': 0.39879070899703284, 'carp': 0.181602...  [bass, carp, shrimp, perch, alligator]  [basses, carp, shrimps, perches, alligators]  [bass, carp, shrimp, perch, alligator, trout, ...  catfish catfish catfish          10   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...  [lime, orange, apple, yes, cherry, water, pepp...  {'lime': 0.5027932287617163, 'orange': 0.15136...      [lime, orange, apple, yes, cherry]        [limes, orange, apples, yes, cherries]  [lime, orange, apple, yes, cherry, water, pepp...        lemon lemon lemon          10   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...       [snake, bird, fish, lizard, frog]       [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...  [boxes, yes, shoes, cases, obviously, yeah, cl...  {'boxes': 0.1638453546911478, 'yes': 0.0626923...       [box, yes, shoe, case, obviously]         [boxes, yes, shoes, cases, obviously]  [box, yes, shoe, case, obviously, yeah, clothe...            bags bag bags          10   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....  [foxes, deer, squirrels, mice, rodents, rats, ...  {'foxes': 0.21225315535610373, 'deer': 0.16438...   [fox, deer, squirrels, mouse, rodent]       [foxes, deer, squirrels, mice, rodents]  [fox, deer, squirrels, mouse, rodent, rat, dog...   rabbits rabbit rabbits          10   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a bass is a [MASK]., a catfish o...  [[MASK] such as catfish and basses., [MASK] su...  [fish, species, turtle, shrimp, crocodile, pre...  {'fish': -4.49076650378941, 'species': -12.787...  [fish, species, animal, seafood, invertebrates...  {'fish': -5.132430900941943, 'species': -9.238...  
1  [a lemon or a lime is a [MASK]., a lemon or an...  [[MASK] such as lemon and limes., [MASK] such ...  [fruit, drink, apple, lime, candy, yes, berry,...  {'fruit': -6.215222270411444, 'drink': -9.5472...  [fruit, thing, citrus, lime, yes, apple, flavo...  {'fruits': -6.38605876173733, 'fruit': -6.9349...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a box is a [MASK]., a bag or a yes i...  [[MASK] such as bags and boxes., [MASK] such a...  [container, luggage, backpack, suitcase, yes, ...  {'container': -7.19792714910603, 'luggage': -8...  [thing, item, stuff, luggage, object, yes, goo...  {'things': -7.003505253732369, 'items': -8.343...  
4  [a rabbit or a fox is a [MASK]., a rabbit or a...  [[MASK] such as rabbits and foxes., [MASK] suc...  [mammal, animal, dog, mouse, creature, bird, c...  {'mammal': -6.555871063773531, 'animal': -6.69...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.978859688699233, 'rodents': -7....  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  13.6 	  34.8 	   34.8 	  21.4 
  1 	 subj_anchors_all 	  13.6 	  34.8 	   45   	  22.7 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.8 	  37.6 	   49.1 	  24.5 	              2 
  4 	 lsp_dap     	  13.1 	  33.6 	   44.9 	  22.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWStrength.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWStrength.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'SWOW', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'OnlySWOWSimilar', 'add_swow_filter': False, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                          subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...   [bass, carp, shrimp, perch, alligator]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...       [lime, orange, apple, yes, cherry]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...        [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...        [box, yes, shoe, case, obviously]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...    [fox, deer, squirrels, mouse, rodent]
...                                                 ...                                      ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...  [artist, poet, editor, actor, musician]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...      [house, shed, barn, garden, street]

[2094 rows x 2 columns]
                                                lsp_dap                               subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...  [basses, carp, shrimps, perches, alligators]
1     [[MASK] such as lemon and [Z]., [MASK], includ...        [limes, orange, apples, yes, cherries]
2     [[MASK] such as turtles and [Z]., [MASK], incl...       [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...         [boxes, yes, shoes, cases, obviously]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...       [foxes, deer, squirrels, mice, rodents]
...                                                 ...                                           ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2092  [[MASK] such as writers and [Z]., [MASK], incl...  [artists, poets, editors, actors, musicians]
2093  [[MASK] such as yard and [Z]., [MASK], includi...        [houses, shed, barn, gardens, streets]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 13%|█▎        | 278/2094 [01:00<06:32,  4.63it/s] 13%|█▎        | 278/2094 [01:20<06:32,  4.63it/s] 27%|██▋       | 556/2094 [02:00<05:32,  4.63it/s] 27%|██▋       | 556/2094 [02:20<05:32,  4.63it/s] 40%|███▉      | 834/2094 [03:00<04:32,  4.63it/s] 40%|███▉      | 834/2094 [03:20<04:32,  4.63it/s] 53%|█████▎    | 1111/2094 [04:00<03:32,  4.62it/s] 53%|█████▎    | 1111/2094 [04:20<03:32,  4.62it/s] 66%|██████▋   | 1389/2094 [05:00<02:32,  4.63it/s] 66%|██████▋   | 1389/2094 [05:20<02:32,  4.63it/s] 80%|███████▉  | 1667/2094 [06:00<01:32,  4.63it/s] 80%|███████▉  | 1667/2094 [06:20<01:32,  4.63it/s] 93%|█████████▎| 1945/2094 [07:00<00:32,  4.63it/s] 93%|█████████▎| 1945/2094 [07:20<00:32,  4.63it/s]100%|██████████| 2094/2094 [07:32<00:00,  4.63it/s]
  0%|          | 0/2094 [00:00<?, ?it/s]  7%|▋         | 141/2094 [01:00<13:55,  2.34it/s]  7%|▋         | 141/2094 [01:17<13:55,  2.34it/s] 13%|█▎        | 281/2094 [02:00<12:59,  2.33it/s] 13%|█▎        | 281/2094 [02:17<12:59,  2.33it/s] 20%|██        | 422/2094 [03:01<11:57,  2.33it/s] 20%|██        | 422/2094 [03:17<11:57,  2.33it/s] 27%|██▋       | 562/2094 [04:01<10:57,  2.33it/s] 27%|██▋       | 562/2094 [04:17<10:57,  2.33it/s] 34%|███▎      | 702/2094 [05:01<09:57,  2.33it/s] 34%|███▎      | 702/2094 [05:17<09:57,  2.33it/s] 40%|████      | 842/2094 [06:01<08:58,  2.33it/s] 40%|████      | 842/2094 [06:17<08:58,  2.33it/s] 47%|████▋     | 982/2094 [07:01<07:57,  2.33it/s] 47%|████▋     | 982/2094 [07:17<07:57,  2.33it/s] 54%|█████▎    | 1123/2094 [08:02<06:56,  2.33it/s] 54%|█████▎    | 1123/2094 [08:17<06:56,  2.33it/s] 60%|██████    | 1263/2094 [09:02<05:56,  2.33it/s] 60%|██████    | 1263/2094 [09:17<05:56,  2.33it/s] 67%|██████▋   | 1403/2094 [10:02<04:56,  2.33it/s] 67%|██████▋   | 1403/2094 [10:17<04:56,  2.33it/s] 74%|███████▎  | 1544/2094 [11:02<03:55,  2.33it/s] 74%|███████▎  | 1544/2094 [11:17<03:55,  2.33it/s] 80%|████████  | 1685/2094 [12:02<02:55,  2.33it/s] 80%|████████  | 1685/2094 [12:17<02:55,  2.33it/s] 87%|████████▋ | 1826/2094 [13:03<01:54,  2.33it/s] 87%|████████▋ | 1826/2094 [13:17<01:54,  2.33it/s] 94%|█████████▍| 1967/2094 [14:03<00:54,  2.33it/s] 94%|█████████▍| 1967/2094 [14:17<00:54,  2.33it/s]100%|██████████| 2094/2094 [14:58<00:00,  2.33it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                         subj_anchors_sg                               subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...  [bass, carp, shrimp, perch, alligator, trout, ...  {'bass': 0.39879070899703284, 'carp': 0.181602...  [bass, carp, shrimp, perch, alligator]  [basses, carp, shrimps, perches, alligators]  [bass, carp, shrimp, perch, alligator, trout, ...  catfish catfish catfish          10   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...  [lime, orange, apple, yes, cherry, water, pepp...  {'lime': 0.5027932287617163, 'orange': 0.15136...      [lime, orange, apple, yes, cherry]        [limes, orange, apples, yes, cherries]  [lime, orange, apple, yes, cherry, water, pepp...        lemon lemon lemon          10   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...       [snake, bird, fish, lizard, frog]       [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...  [boxes, yes, shoes, cases, obviously, yeah, cl...  {'boxes': 0.1638453546911478, 'yes': 0.0626923...       [box, yes, shoe, case, obviously]         [boxes, yes, shoes, cases, obviously]  [box, yes, shoe, case, obviously, yeah, clothe...            bags bag bags          10   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....  [foxes, deer, squirrels, mice, rodents, rats, ...  {'foxes': 0.21225315535610373, 'deer': 0.16438...   [fox, deer, squirrels, mouse, rodent]       [foxes, deer, squirrels, mice, rodents]  [fox, deer, squirrels, mouse, rodent, rat, dog...   rabbits rabbit rabbits          10   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a bass is a [MASK]., a catfish o...  [[MASK] such as catfish and basses., [MASK] su...  [fish, species, turtle, shrimp, crocodile, pre...  {'fish': -4.49076650378941, 'species': -12.787...  [fish, species, animal, seafood, invertebrates...  {'fish': -5.132430900941943, 'species': -9.238...  
1  [a lemon or a lime is a [MASK]., a lemon or an...  [[MASK] such as lemon and limes., [MASK] such ...  [fruit, drink, apple, lime, candy, yes, berry,...  {'fruit': -6.215222270411444, 'drink': -9.5472...  [fruit, thing, citrus, lime, yes, apple, flavo...  {'fruits': -6.38605876173733, 'fruit': -6.9349...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a box is a [MASK]., a bag or a yes i...  [[MASK] such as bags and boxes., [MASK] such a...  [container, luggage, backpack, suitcase, yes, ...  {'container': -7.19792714910603, 'luggage': -8...  [thing, item, stuff, luggage, object, yes, goo...  {'things': -7.003505253732369, 'items': -8.343...  
4  [a rabbit or a fox is a [MASK]., a rabbit or a...  [[MASK] such as rabbits and foxes., [MASK] suc...  [mammal, animal, dog, mouse, creature, bird, c...  {'mammal': -6.555871063773531, 'animal': -6.69...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.978859688699233, 'rodents': -7....  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  13.6 	  34.8 	   34.8 	  21.4 
  1 	 subj_anchors_all 	  13.6 	  34.8 	   45   	  22.7 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.8 	  37.6 	   49.1 	  24.5 	              2 
  4 	 lsp_dap     	  13.1 	  33.6 	   44.9 	  22.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWSimilar.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWSimilar.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'SWOW', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'OnlySWOWSimilar', 'add_swow_filter': False, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                          subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...   [bass, carp, shrimp, perch, alligator]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...       [lime, orange, apple, yes, cherry]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...        [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...        [box, yes, shoe, case, obviously]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...    [fox, deer, squirrels, mouse, rodent]
...                                                 ...                                      ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...  [artist, poet, editor, actor, musician]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...      [house, shed, barn, garden, street]

[2094 rows x 2 columns]
                                                lsp_dap                               subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...  [basses, carp, shrimps, perches, alligators]
1     [[MASK] such as lemon and [Z]., [MASK], includ...        [limes, orange, apples, yes, cherries]
2     [[MASK] such as turtles and [Z]., [MASK], incl...       [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...         [boxes, yes, shoes, cases, obviously]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...       [foxes, deer, squirrels, mice, rodents]
...                                                 ...                                           ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2092  [[MASK] such as writers and [Z]., [MASK], incl...  [artists, poets, editors, actors, musicians]
2093  [[MASK] such as yard and [Z]., [MASK], includi...        [houses, shed, barn, gardens, streets]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 13%|█▎        | 281/2094 [01:00<06:27,  4.68it/s] 13%|█▎        | 281/2094 [01:20<06:27,  4.68it/s] 27%|██▋       | 562/2094 [02:00<05:27,  4.68it/s] 27%|██▋       | 562/2094 [02:20<05:27,  4.68it/s] 40%|████      | 844/2094 [03:00<04:27,  4.68it/s] 40%|████      | 844/2094 [03:20<04:27,  4.68it/s] 54%|█████▎    | 1125/2094 [04:00<03:27,  4.68it/s] 54%|█████▎    | 1125/2094 [04:20<03:27,  4.68it/s] 67%|██████▋   | 1406/2094 [05:00<02:26,  4.68it/s] 67%|██████▋   | 1406/2094 [05:20<02:26,  4.68it/s] 81%|████████  | 1687/2094 [06:00<01:26,  4.68it/s] 81%|████████  | 1687/2094 [06:20<01:26,  4.68it/s] 94%|█████████▍| 1968/2094 [07:00<00:26,  4.68it/s] 94%|█████████▍| 1968/2094 [07:20<00:26,  4.68it/s]100%|██████████| 2094/2094 [07:27<00:00,  4.68it/s]
  0%|          | 0/2094 [00:00<?, ?it/s]  7%|▋         | 142/2094 [01:00<13:46,  2.36it/s]  7%|▋         | 142/2094 [01:12<13:46,  2.36it/s] 14%|█▎        | 284/2094 [02:00<12:46,  2.36it/s] 14%|█▎        | 284/2094 [02:12<12:46,  2.36it/s] 20%|██        | 426/2094 [03:00<11:46,  2.36it/s] 20%|██        | 426/2094 [03:12<11:46,  2.36it/s] 27%|██▋       | 568/2094 [04:00<10:46,  2.36it/s] 27%|██▋       | 568/2094 [04:12<10:46,  2.36it/s] 34%|███▍      | 710/2094 [05:01<09:47,  2.36it/s] 34%|███▍      | 710/2094 [05:12<09:47,  2.36it/s] 41%|████      | 851/2094 [06:01<08:48,  2.35it/s] 41%|████      | 851/2094 [06:12<08:48,  2.35it/s] 47%|████▋     | 992/2094 [07:01<07:48,  2.35it/s] 47%|████▋     | 992/2094 [07:12<07:48,  2.35it/s] 54%|█████▍    | 1134/2094 [08:01<06:48,  2.35it/s] 54%|█████▍    | 1134/2094 [08:12<06:48,  2.35it/s] 61%|██████    | 1276/2094 [09:01<05:47,  2.35it/s] 61%|██████    | 1276/2094 [09:12<05:47,  2.35it/s] 68%|██████▊   | 1418/2094 [10:02<04:47,  2.35it/s] 68%|██████▊   | 1418/2094 [10:12<04:47,  2.35it/s] 74%|███████▍  | 1560/2094 [11:02<03:46,  2.35it/s] 74%|███████▍  | 1560/2094 [11:12<03:46,  2.35it/s] 81%|████████▏ | 1702/2094 [12:02<02:46,  2.36it/s] 81%|████████▏ | 1702/2094 [12:12<02:46,  2.36it/s] 88%|████████▊ | 1844/2094 [13:02<01:46,  2.36it/s] 88%|████████▊ | 1844/2094 [13:22<01:46,  2.36it/s] 95%|█████████▍| 1986/2094 [14:02<00:45,  2.36it/s] 95%|█████████▍| 1986/2094 [14:22<00:45,  2.36it/s]100%|██████████| 2094/2094 [14:48<00:00,  2.36it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                         subj_anchors_sg                               subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...  [bass, carp, shrimp, perch, alligator, trout, ...  {'bass': 0.39879070899703284, 'carp': 0.181602...  [bass, carp, shrimp, perch, alligator]  [basses, carp, shrimps, perches, alligators]  [bass, carp, shrimp, perch, alligator, trout, ...  catfish catfish catfish          10   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...  [lime, orange, apple, yes, cherry, water, pepp...  {'lime': 0.5027932287617163, 'orange': 0.15136...      [lime, orange, apple, yes, cherry]        [limes, orange, apples, yes, cherries]  [lime, orange, apple, yes, cherry, water, pepp...        lemon lemon lemon          10   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...       [snake, bird, fish, lizard, frog]       [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...  [boxes, yes, shoes, cases, obviously, yeah, cl...  {'boxes': 0.1638453546911478, 'yes': 0.0626923...       [box, yes, shoe, case, obviously]         [boxes, yes, shoes, cases, obviously]  [box, yes, shoe, case, obviously, yeah, clothe...            bags bag bags          10   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....  [foxes, deer, squirrels, mice, rodents, rats, ...  {'foxes': 0.21225315535610373, 'deer': 0.16438...   [fox, deer, squirrels, mouse, rodent]       [foxes, deer, squirrels, mice, rodents]  [fox, deer, squirrels, mouse, rodent, rat, dog...   rabbits rabbit rabbits          10   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a bass is a [MASK]., a catfish o...  [[MASK] such as catfish and basses., [MASK] su...  [fish, species, turtle, shrimp, crocodile, pre...  {'fish': -4.49076650378941, 'species': -12.787...  [fish, species, animal, seafood, invertebrates...  {'fish': -5.132430900941943, 'species': -9.238...  
1  [a lemon or a lime is a [MASK]., a lemon or an...  [[MASK] such as lemon and limes., [MASK] such ...  [fruit, drink, apple, lime, candy, yes, berry,...  {'fruit': -6.215222270411444, 'drink': -9.5472...  [fruit, thing, citrus, lime, yes, apple, flavo...  {'fruits': -6.38605876173733, 'fruit': -6.9349...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a box is a [MASK]., a bag or a yes i...  [[MASK] such as bags and boxes., [MASK] such a...  [container, luggage, backpack, suitcase, yes, ...  {'container': -7.19792714910603, 'luggage': -8...  [thing, item, stuff, luggage, object, yes, goo...  {'things': -7.003505253732369, 'items': -8.343...  
4  [a rabbit or a fox is a [MASK]., a rabbit or a...  [[MASK] such as rabbits and foxes., [MASK] suc...  [mammal, animal, dog, mouse, creature, bird, c...  {'mammal': -6.555871063773531, 'animal': -6.69...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.978859688699233, 'rodents': -7....  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  13.6 	  34.8 	   34.8 	  21.4 
  1 	 subj_anchors_all 	  13.6 	  34.8 	   45   	  22.7 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.8 	  37.6 	   49.1 	  24.5 	              2 
  4 	 lsp_dap     	  13.1 	  33.6 	   44.9 	  22.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWSimilar.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWSimilar.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'SWOW', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'OnlySWOWSimilar', 'add_swow_filter': False, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                          subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...   [bass, carp, shrimp, perch, alligator]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...       [lime, orange, apple, yes, cherry]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...        [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...        [box, yes, shoe, case, obviously]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...    [fox, deer, squirrels, mouse, rodent]
...                                                 ...                                      ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...   [human, dimension, people, maybe, yes]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...  [artist, poet, editor, actor, musician]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...      [house, shed, barn, garden, street]

[2094 rows x 2 columns]
                                                lsp_dap                               subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...  [basses, carp, shrimps, perches, alligators]
1     [[MASK] such as lemon and [Z]., [MASK], includ...        [limes, orange, apples, yes, cherries]
2     [[MASK] such as turtles and [Z]., [MASK], incl...       [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...         [boxes, yes, shoes, cases, obviously]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...       [foxes, deer, squirrels, mice, rodents]
...                                                 ...                                           ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...       [human, dimensions, people, maybe, yes]
2092  [[MASK] such as writers and [Z]., [MASK], incl...  [artists, poets, editors, actors, musicians]
2093  [[MASK] such as yard and [Z]., [MASK], includi...        [houses, shed, barn, gardens, streets]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 13%|█▎        | 281/2094 [01:00<06:28,  4.67it/s] 13%|█▎        | 281/2094 [01:20<06:28,  4.67it/s] 27%|██▋       | 562/2094 [02:00<05:27,  4.67it/s] 27%|██▋       | 562/2094 [02:20<05:27,  4.67it/s] 40%|████      | 843/2094 [03:00<04:27,  4.67it/s] 40%|████      | 843/2094 [03:20<04:27,  4.67it/s] 54%|█████▎    | 1124/2094 [04:00<03:27,  4.67it/s] 54%|█████▎    | 1124/2094 [04:20<03:27,  4.67it/s] 67%|██████▋   | 1404/2094 [05:00<02:27,  4.67it/s] 67%|██████▋   | 1404/2094 [05:20<02:27,  4.67it/s] 80%|████████  | 1684/2094 [06:00<01:27,  4.67it/s] 80%|████████  | 1684/2094 [06:20<01:27,  4.67it/s] 94%|█████████▍| 1965/2094 [07:00<00:27,  4.67it/s] 94%|█████████▍| 1965/2094 [07:20<00:27,  4.67it/s]100%|██████████| 2094/2094 [07:28<00:00,  4.67it/s]
  0%|          | 0/2094 [00:00<?, ?it/s]  7%|▋         | 142/2094 [01:00<13:48,  2.36it/s]  7%|▋         | 142/2094 [01:11<13:48,  2.36it/s] 14%|█▎        | 284/2094 [02:00<12:48,  2.36it/s] 14%|█▎        | 284/2094 [02:11<12:48,  2.36it/s] 20%|██        | 426/2094 [03:00<11:48,  2.36it/s] 20%|██        | 426/2094 [03:11<11:48,  2.36it/s] 27%|██▋       | 568/2094 [04:01<10:48,  2.35it/s] 27%|██▋       | 568/2094 [04:11<10:48,  2.35it/s] 34%|███▍      | 709/2094 [05:01<09:48,  2.35it/s] 34%|███▍      | 709/2094 [05:11<09:48,  2.35it/s] 41%|████      | 850/2094 [06:01<08:50,  2.35it/s] 41%|████      | 850/2094 [06:11<08:50,  2.35it/s] 47%|████▋     | 991/2094 [07:01<07:49,  2.35it/s] 47%|████▋     | 991/2094 [07:11<07:49,  2.35it/s] 54%|█████▍    | 1133/2094 [08:01<06:48,  2.35it/s] 54%|█████▍    | 1133/2094 [08:21<06:48,  2.35it/s] 61%|██████    | 1275/2094 [09:02<05:48,  2.35it/s] 61%|██████    | 1275/2094 [09:21<05:48,  2.35it/s] 68%|██████▊   | 1416/2094 [10:02<04:48,  2.35it/s] 68%|██████▊   | 1416/2094 [10:21<04:48,  2.35it/s] 74%|███████▍  | 1558/2094 [11:02<03:47,  2.35it/s] 74%|███████▍  | 1558/2094 [11:21<03:47,  2.35it/s] 81%|████████  | 1700/2094 [12:02<02:47,  2.35it/s] 81%|████████  | 1700/2094 [12:21<02:47,  2.35it/s] 88%|████████▊ | 1842/2094 [13:02<01:46,  2.36it/s] 88%|████████▊ | 1842/2094 [13:21<01:46,  2.36it/s] 95%|█████████▍| 1984/2094 [14:02<00:46,  2.36it/s] 95%|█████████▍| 1984/2094 [14:21<00:46,  2.36it/s]100%|██████████| 2094/2094 [14:49<00:00,  2.35it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                         subj_anchors_sg                               subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...  [bass, carp, shrimp, perch, alligator, trout, ...  {'bass': 0.39879070899703284, 'carp': 0.181602...  [bass, carp, shrimp, perch, alligator]  [basses, carp, shrimps, perches, alligators]  [bass, carp, shrimp, perch, alligator, trout, ...  catfish catfish catfish          10   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...  [lime, orange, apple, yes, cherry, water, pepp...  {'lime': 0.5027932287617163, 'orange': 0.15136...      [lime, orange, apple, yes, cherry]        [limes, orange, apples, yes, cherries]  [lime, orange, apple, yes, cherry, water, pepp...        lemon lemon lemon          10   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...       [snake, bird, fish, lizard, frog]       [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...  [boxes, yes, shoes, cases, obviously, yeah, cl...  {'boxes': 0.1638453546911478, 'yes': 0.0626923...       [box, yes, shoe, case, obviously]         [boxes, yes, shoes, cases, obviously]  [box, yes, shoe, case, obviously, yeah, clothe...            bags bag bags          10   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....  [foxes, deer, squirrels, mice, rodents, rats, ...  {'foxes': 0.21225315535610373, 'deer': 0.16438...   [fox, deer, squirrels, mouse, rodent]       [foxes, deer, squirrels, mice, rodents]  [fox, deer, squirrels, mouse, rodent, rat, dog...   rabbits rabbit rabbits          10   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a bass is a [MASK]., a catfish o...  [[MASK] such as catfish and basses., [MASK] su...  [fish, species, turtle, shrimp, crocodile, pre...  {'fish': -4.49076650378941, 'species': -12.787...  [fish, species, animal, seafood, invertebrates...  {'fish': -5.132430900941943, 'species': -9.238...  
1  [a lemon or a lime is a [MASK]., a lemon or an...  [[MASK] such as lemon and limes., [MASK] such ...  [fruit, drink, apple, lime, candy, yes, berry,...  {'fruit': -6.215222270411444, 'drink': -9.5472...  [fruit, thing, citrus, lime, yes, apple, flavo...  {'fruits': -6.38605876173733, 'fruit': -6.9349...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a box is a [MASK]., a bag or a yes i...  [[MASK] such as bags and boxes., [MASK] such a...  [container, luggage, backpack, suitcase, yes, ...  {'container': -7.19792714910603, 'luggage': -8...  [thing, item, stuff, luggage, object, yes, goo...  {'things': -7.003505253732369, 'items': -8.343...  
4  [a rabbit or a fox is a [MASK]., a rabbit or a...  [[MASK] such as rabbits and foxes., [MASK] suc...  [mammal, animal, dog, mouse, creature, bird, c...  {'mammal': -6.555871063773531, 'animal': -6.69...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.978859688699233, 'rodents': -7....  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  13.6 	  34.8 	   34.8 	  21.4 
  1 	 subj_anchors_all 	  13.6 	  34.8 	   45   	  22.7 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.8 	  37.6 	   49.1 	  24.5 	              2 
  4 	 lsp_dap     	  13.1 	  33.6 	   44.9 	  22.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWSimilar.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_SWOW_wns_False_wnf_False_swow_score_source_OnlySWOWSimilar.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'LM', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'ShareSWOWStrength', 'add_swow_filter': True, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                         subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...  [bass, carp, shrimp, perch, alligator]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...                        [orange, yellow]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...       [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...                            [case, shoe]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...   [fox, deer, squirrels, mouse, rodent]
...                                                 ...                                     ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...                      [people, universe]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...                      [people, universe]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...                      [people, universe]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...      [journalist, poet, artist, author]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...                                  [barn]

[2094 rows x 2 columns]
                                                lsp_dap                               subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...  [basses, carp, shrimps, perches, alligators]
1     [[MASK] such as lemon and [Z]., [MASK], includ...                              [orange, yellow]
2     [[MASK] such as turtles and [Z]., [MASK], incl...       [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...                                [cases, shoes]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...       [foxes, deer, squirrels, mice, rodents]
...                                                 ...                                           ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...                            [people, universe]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...                            [people, universe]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...                            [people, universe]
2092  [[MASK] such as writers and [Z]., [MASK], incl...        [journalists, poets, artists, authors]
2093  [[MASK] such as yard and [Z]., [MASK], includi...                                        [barn]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 23%|██▎       | 486/2094 [01:00<03:18,  8.09it/s] 23%|██▎       | 486/2094 [01:20<03:18,  8.09it/s] 45%|████▍     | 935/2094 [02:00<02:30,  7.72it/s] 45%|████▍     | 935/2094 [02:20<02:30,  7.72it/s] 65%|██████▌   | 1365/2094 [03:00<01:37,  7.46it/s] 65%|██████▌   | 1365/2094 [03:20<01:37,  7.46it/s] 88%|████████▊ | 1836/2094 [04:00<00:33,  7.60it/s] 88%|████████▊ | 1836/2094 [04:20<00:33,  7.60it/s]100%|██████████| 2094/2094 [04:30<00:00,  7.76it/s]
  0%|          | 0/2094 [00:00<?, ?it/s] 12%|█▏        | 246/2094 [01:00<07:31,  4.10it/s] 12%|█▏        | 246/2094 [01:19<07:31,  4.10it/s] 23%|██▎       | 492/2094 [02:00<06:30,  4.10it/s] 23%|██▎       | 492/2094 [02:19<06:30,  4.10it/s] 35%|███▍      | 725/2094 [03:00<05:43,  3.99it/s] 35%|███▍      | 725/2094 [03:19<05:43,  3.99it/s] 45%|████▌     | 947/2094 [04:00<04:56,  3.87it/s] 45%|████▌     | 947/2094 [04:19<04:56,  3.87it/s] 55%|█████▌    | 1158/2094 [05:00<04:10,  3.74it/s] 55%|█████▌    | 1158/2094 [05:19<04:10,  3.74it/s] 66%|██████▌   | 1380/2094 [06:00<03:11,  3.72it/s] 66%|██████▌   | 1380/2094 [06:19<03:11,  3.72it/s] 78%|███████▊  | 1624/2094 [07:01<02:02,  3.83it/s] 78%|███████▊  | 1624/2094 [07:19<02:02,  3.83it/s] 89%|████████▉ | 1865/2094 [08:01<00:58,  3.89it/s] 89%|████████▉ | 1865/2094 [08:19<00:58,  3.89it/s]100%|██████████| 2094/2094 [08:52<00:00,  3.93it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                         subj_anchors_sg                               subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...  [bass, carp, shrimp, perch, alligator, trout, ...  {'bass': 0.39879070899703284, 'carp': 0.181602...  [bass, carp, shrimp, perch, alligator]  [basses, carp, shrimps, perches, alligators]  [bass, carp, shrimp, perch, alligator, trout, ...  catfish catfish catfish          10   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...                                   [orange, yellow]  {'lime': 0.5027932287617163, 'orange': 0.15136...                        [orange, yellow]                              [orange, yellow]                                   [orange, yellow]        lemon lemon lemon           2   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...       [snake, bird, fish, lizard, frog]       [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...                                     [cases, shoes]  {'boxes': 0.1638453546911478, 'yes': 0.0626923...                            [case, shoe]                                [cases, shoes]                                       [case, shoe]            bags bag bags           2   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....  [foxes, deer, squirrels, mice, rodents, rats, ...  {'foxes': 0.21225315535610373, 'deer': 0.16438...   [fox, deer, squirrels, mouse, rodent]       [foxes, deer, squirrels, mice, rodents]  [fox, deer, squirrels, mouse, rodent, rat, dog...   rabbits rabbit rabbits          10   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a bass is a [MASK]., a catfish o...  [[MASK] such as catfish and basses., [MASK] su...  [fish, species, turtle, shrimp, crocodile, pre...  {'fish': -4.49076650378941, 'species': -12.787...  [fish, species, animal, seafood, invertebrates...  {'fish': -5.132430900941943, 'species': -9.238...  
1  [a lemon or an orange is a [MASK]., a lemon or...  [[MASK] such as lemon and orange., [MASK] such...  [fruit, orange, apple, drink, vegetable, flowe...  {'fruit': -6.5065366113085785, 'orange': -9.51...  [color, fruit, colour, citrus, orange, thing, ...  {'colors': -7.510048377139142, 'fruits': -8.33...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a case is a [MASK]., a bag or a shoe...  [[MASK] such as bags and cases., [MASK] such a...  [luggage, container, shoe, clothing, backpack,...  {'luggage': -7.433512193122446, 'container': -...  [item, thing, luggage, object, good, clothing,...  {'items': -7.71317658247203, 'things': -7.7782...  
4  [a rabbit or a fox is a [MASK]., a rabbit or a...  [[MASK] such as rabbits and foxes., [MASK] suc...  [mammal, animal, dog, mouse, creature, bird, c...  {'mammal': -6.555871063773531, 'animal': -6.69...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.978859688699233, 'rodents': -7....  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  14.1 	    25 	   25   	  18.4 
  1 	 subj_anchors_all 	  14.1 	    25 	   29.3 	  19   
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.1 	  37.2 	   49.8 	  24.3 	              2 
  4 	 lsp_dap     	  12.9 	  33.9 	   45.2 	  22   	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWStrength.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWStrength.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'LM', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'ShareSWOWStrength', 'add_swow_filter': True, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                         subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...  [bass, carp, shrimp, perch, alligator]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...                        [orange, yellow]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...       [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...                            [shoe, case]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...   [fox, deer, squirrels, mouse, rodent]
...                                                 ...                                     ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...                      [people, universe]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...                      [people, universe]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...                      [people, universe]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...      [poet, artist, journalist, author]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...                                  [barn]

[2094 rows x 2 columns]
                                                lsp_dap                               subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...  [basses, carp, shrimps, perches, alligators]
1     [[MASK] such as lemon and [Z]., [MASK], includ...                              [orange, yellow]
2     [[MASK] such as turtles and [Z]., [MASK], incl...       [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...                                [shoes, cases]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...       [foxes, deer, squirrels, mice, rodents]
...                                                 ...                                           ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...                            [people, universe]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...                            [people, universe]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...                            [people, universe]
2092  [[MASK] such as writers and [Z]., [MASK], incl...        [poets, artists, journalists, authors]
2093  [[MASK] such as yard and [Z]., [MASK], includi...                                        [barn]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 23%|██▎       | 488/2094 [01:00<03:18,  8.11it/s] 23%|██▎       | 488/2094 [01:20<03:18,  8.11it/s] 45%|████▍     | 940/2094 [02:00<02:28,  7.77it/s] 45%|████▍     | 940/2094 [02:20<02:28,  7.77it/s] 65%|██████▌   | 1369/2094 [03:00<01:36,  7.48it/s] 65%|██████▌   | 1369/2094 [03:20<01:36,  7.48it/s] 88%|████████▊ | 1842/2094 [04:00<00:32,  7.64it/s] 88%|████████▊ | 1842/2094 [04:20<00:32,  7.64it/s]100%|██████████| 2094/2094 [04:28<00:00,  7.80it/s]
  0%|          | 0/2094 [00:00<?, ?it/s] 12%|█▏        | 247/2094 [01:00<07:31,  4.09it/s] 12%|█▏        | 247/2094 [01:11<07:31,  4.09it/s] 24%|██▎       | 494/2094 [02:00<06:30,  4.10it/s] 24%|██▎       | 494/2094 [02:11<06:30,  4.10it/s] 35%|███▍      | 726/2094 [03:00<05:43,  3.98it/s] 35%|███▍      | 726/2094 [03:11<05:43,  3.98it/s] 45%|████▌     | 949/2094 [04:00<04:55,  3.88it/s] 45%|████▌     | 949/2094 [04:11<04:55,  3.88it/s] 55%|█████▌    | 1160/2094 [05:00<04:09,  3.75it/s] 55%|█████▌    | 1160/2094 [05:11<04:09,  3.75it/s] 66%|██████▌   | 1382/2094 [06:00<03:10,  3.73it/s] 66%|██████▌   | 1382/2094 [06:11<03:10,  3.73it/s] 78%|███████▊  | 1626/2094 [07:01<02:01,  3.84it/s] 78%|███████▊  | 1626/2094 [07:11<02:01,  3.84it/s] 89%|████████▉ | 1868/2094 [08:01<00:58,  3.90it/s] 89%|████████▉ | 1868/2094 [08:11<00:58,  3.90it/s]100%|██████████| 2094/2094 [08:51<00:00,  3.94it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                         subj_anchors_sg                               subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...  [bass, carp, shrimp, perch, alligator, trout, ...  {'bass': 0.39879070899703284, 'carp': 0.181602...  [bass, carp, shrimp, perch, alligator]  [basses, carp, shrimps, perches, alligators]  [bass, carp, shrimp, perch, alligator, trout, ...  catfish catfish catfish          10   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...                                   [orange, yellow]  {'lime': 0.5027932287617163, 'orange': 0.15136...                        [orange, yellow]                              [orange, yellow]                                   [orange, yellow]        lemon lemon lemon           2   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...       [snake, bird, fish, lizard, frog]       [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...                                     [shoes, cases]  {'boxes': 0.1638453546911478, 'yes': 0.0626923...                            [shoe, case]                                [shoes, cases]                                       [shoe, case]            bags bag bags           2   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....  [foxes, deer, squirrels, mice, rodents, rats, ...  {'foxes': 0.21225315535610373, 'deer': 0.16438...   [fox, deer, squirrels, mouse, rodent]       [foxes, deer, squirrels, mice, rodents]  [fox, deer, squirrels, mouse, rodent, rat, dog...   rabbits rabbit rabbits          10   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a bass is a [MASK]., a catfish o...  [[MASK] such as catfish and basses., [MASK] su...  [fish, species, turtle, shrimp, crocodile, pre...  {'fish': -4.49076650378941, 'species': -12.787...  [fish, species, animal, seafood, invertebrates...  {'fish': -5.132430900941943, 'species': -9.238...  
1  [a lemon or an orange is a [MASK]., a lemon or...  [[MASK] such as lemon and orange., [MASK] such...  [fruit, orange, apple, drink, vegetable, flowe...  {'fruit': -6.5065366113085785, 'orange': -9.51...  [color, fruit, colour, citrus, orange, thing, ...  {'colors': -7.510048377139142, 'fruits': -8.33...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a shoe is a [MASK]., a bag or a case...  [[MASK] such as bags and shoes., [MASK] such a...  [luggage, container, shoe, clothing, backpack,...  {'luggage': -7.433512193122445, 'container': -...  [item, thing, luggage, object, good, clothing,...  {'items': -7.71317658247203, 'things': -7.7782...  
4  [a rabbit or a fox is a [MASK]., a rabbit or a...  [[MASK] such as rabbits and foxes., [MASK] suc...  [mammal, animal, dog, mouse, creature, bird, c...  {'mammal': -6.555871063773531, 'animal': -6.69...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.978859688699233, 'rodents': -7....  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  14.4 	    25 	   25   	  18.5 
  1 	 subj_anchors_all 	  14.4 	    25 	   29.3 	  19.1 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.1 	  37.2 	   49.8 	  24.3 	              2 
  4 	 lsp_dap     	  12.9 	  33.9 	   45.2 	  22   	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWStrength.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWStrength.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'LM', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'ShareSWOWStrength', 'add_swow_filter': True, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                         subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...  [bass, carp, shrimp, perch, alligator]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...                        [orange, yellow]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...       [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...                            [shoe, case]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...   [fox, deer, squirrels, mouse, rodent]
...                                                 ...                                     ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...                      [universe, people]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...                      [universe, people]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...                      [universe, people]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...      [poet, journalist, author, artist]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...                                  [barn]

[2094 rows x 2 columns]
                                                lsp_dap                               subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...  [basses, carp, shrimps, perches, alligators]
1     [[MASK] such as lemon and [Z]., [MASK], includ...                              [orange, yellow]
2     [[MASK] such as turtles and [Z]., [MASK], incl...       [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...                                [shoes, cases]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...       [foxes, deer, squirrels, mice, rodents]
...                                                 ...                                           ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...                            [universe, people]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...                            [universe, people]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...                            [universe, people]
2092  [[MASK] such as writers and [Z]., [MASK], incl...        [poets, journalists, authors, artists]
2093  [[MASK] such as yard and [Z]., [MASK], includi...                                        [barn]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 23%|██▎       | 483/2094 [01:00<03:20,  8.03it/s] 23%|██▎       | 483/2094 [01:20<03:20,  8.03it/s] 44%|████▍     | 928/2094 [02:00<02:32,  7.67it/s] 44%|████▍     | 928/2094 [02:20<02:32,  7.67it/s] 65%|██████▍   | 1353/2094 [03:00<01:40,  7.40it/s] 65%|██████▍   | 1353/2094 [03:20<01:40,  7.40it/s] 87%|████████▋ | 1816/2094 [04:00<00:36,  7.52it/s] 87%|████████▋ | 1816/2094 [04:20<00:36,  7.52it/s]100%|██████████| 2094/2094 [04:32<00:00,  7.68it/s]
  0%|          | 0/2094 [00:00<?, ?it/s] 11%|█▏        | 240/2094 [01:00<07:43,  4.00it/s] 11%|█▏        | 240/2094 [01:17<07:43,  4.00it/s] 23%|██▎       | 486/2094 [02:00<06:37,  4.04it/s] 23%|██▎       | 486/2094 [02:17<06:37,  4.04it/s] 34%|███▍      | 716/2094 [03:00<05:49,  3.94it/s] 34%|███▍      | 716/2094 [03:17<05:49,  3.94it/s] 45%|████▍     | 934/2094 [04:01<05:04,  3.81it/s] 45%|████▍     | 934/2094 [04:17<05:04,  3.81it/s] 55%|█████▍    | 1143/2094 [05:01<04:17,  3.69it/s] 55%|█████▍    | 1143/2094 [05:17<04:17,  3.69it/s] 65%|██████▌   | 1364/2094 [06:01<03:18,  3.69it/s] 65%|██████▌   | 1364/2094 [06:17<03:18,  3.69it/s] 76%|███████▋  | 1597/2094 [07:01<02:12,  3.75it/s] 76%|███████▋  | 1597/2094 [07:17<02:12,  3.75it/s] 88%|████████▊ | 1833/2094 [08:01<01:08,  3.81it/s] 88%|████████▊ | 1833/2094 [08:17<01:08,  3.81it/s]100%|██████████| 2094/2094 [09:01<00:00,  3.87it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                         subj_anchors_sg                               subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...  [bass, carp, shrimp, perch, alligator, trout, ...  {'bass': 0.39879070899703284, 'carp': 0.181602...  [bass, carp, shrimp, perch, alligator]  [basses, carp, shrimps, perches, alligators]  [bass, carp, shrimp, perch, alligator, trout, ...  catfish catfish catfish          10   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...                                   [orange, yellow]  {'lime': 0.5027932287617163, 'orange': 0.15136...                        [orange, yellow]                              [orange, yellow]                                   [orange, yellow]        lemon lemon lemon           2   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...       [snake, bird, fish, lizard, frog]       [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...                                     [shoes, cases]  {'boxes': 0.1638453546911478, 'yes': 0.0626923...                            [shoe, case]                                [shoes, cases]                                       [shoe, case]            bags bag bags           2   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....  [foxes, deer, squirrels, mice, rodents, rats, ...  {'foxes': 0.21225315535610373, 'deer': 0.16438...   [fox, deer, squirrels, mouse, rodent]       [foxes, deer, squirrels, mice, rodents]  [fox, deer, squirrels, mouse, rodent, rat, dog...   rabbits rabbit rabbits          10   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a bass is a [MASK]., a catfish o...  [[MASK] such as catfish and basses., [MASK] su...  [fish, species, turtle, shrimp, crocodile, pre...  {'fish': -4.49076650378941, 'species': -12.787...  [fish, species, animal, seafood, invertebrates...  {'fish': -5.132430900941943, 'species': -9.238...  
1  [a lemon or an orange is a [MASK]., a lemon or...  [[MASK] such as lemon and orange., [MASK] such...  [fruit, orange, apple, drink, vegetable, flowe...  {'fruit': -6.5065366113085785, 'orange': -9.51...  [color, fruit, colour, citrus, orange, thing, ...  {'colors': -7.510048377139142, 'fruits': -8.33...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a shoe is a [MASK]., a bag or a case...  [[MASK] such as bags and shoes., [MASK] such a...  [luggage, container, shoe, clothing, backpack,...  {'luggage': -7.433512193122445, 'container': -...  [item, thing, luggage, object, good, clothing,...  {'items': -7.71317658247203, 'things': -7.7782...  
4  [a rabbit or a fox is a [MASK]., a rabbit or a...  [[MASK] such as rabbits and foxes., [MASK] suc...  [mammal, animal, dog, mouse, creature, bird, c...  {'mammal': -6.555871063773531, 'animal': -6.69...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.978859688699233, 'rodents': -7....  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  14.4 	    25 	   25   	  18.5 
  1 	 subj_anchors_all 	  14.4 	    25 	   29.3 	  19.1 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.1 	  37.2 	   49.8 	  24.3 	              2 
  4 	 lsp_dap     	  12.9 	  33.9 	   45.2 	  22   	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWStrength.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWStrength.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'LM', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'ShareSWOWSimilar', 'add_swow_filter': True, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                         subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...                                 [trout]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...      [lime, orange, apple, yes, cherry]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...       [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...       [box, yes, shoe, case, obviously]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...                                [rodent]
...                                                 ...                                     ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...  [human, dimension, people, maybe, yes]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...  [human, dimension, people, maybe, yes]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...  [human, dimension, people, maybe, yes]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...                     [publisher, editor]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...     [house, shed, barn, garden, street]

[2094 rows x 2 columns]
                                                lsp_dap                          subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...                                  [trout]
1     [[MASK] such as lemon and [Z]., [MASK], includ...   [limes, orange, apples, yes, cherries]
2     [[MASK] such as turtles and [Z]., [MASK], incl...  [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...    [boxes, yes, shoes, cases, obviously]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...                                [rodents]
...                                                 ...                                      ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...  [human, dimensions, people, maybe, yes]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...  [human, dimensions, people, maybe, yes]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...  [human, dimensions, people, maybe, yes]
2092  [[MASK] such as writers and [Z]., [MASK], incl...                    [publishers, editors]
2093  [[MASK] such as yard and [Z]., [MASK], includi...   [houses, shed, barn, gardens, streets]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 25%|██▍       | 517/2094 [01:00<03:03,  8.61it/s] 25%|██▍       | 517/2094 [01:20<03:03,  8.61it/s] 48%|████▊     | 998/2094 [02:00<02:12,  8.25it/s] 48%|████▊     | 998/2094 [02:20<02:12,  8.25it/s] 69%|██████▉   | 1453/2094 [03:00<01:20,  7.94it/s] 69%|██████▉   | 1453/2094 [03:20<01:20,  7.94it/s] 89%|████████▉ | 1870/2094 [04:00<00:29,  7.54it/s] 89%|████████▉ | 1870/2094 [04:20<00:29,  7.54it/s]100%|██████████| 2094/2094 [04:31<00:00,  7.71it/s]
  0%|          | 0/2094 [00:00<?, ?it/s] 13%|█▎        | 272/2094 [01:00<06:43,  4.52it/s] 13%|█▎        | 272/2094 [01:18<06:43,  4.52it/s] 25%|██▍       | 522/2094 [02:00<06:04,  4.31it/s] 25%|██▍       | 522/2094 [02:18<06:04,  4.31it/s] 38%|███▊      | 786/2094 [03:00<05:00,  4.35it/s] 38%|███▊      | 786/2094 [03:18<05:00,  4.35it/s] 48%|████▊     | 1000/2094 [04:00<04:31,  4.04it/s] 48%|████▊     | 1000/2094 [04:18<04:31,  4.04it/s] 58%|█████▊    | 1224/2094 [05:00<03:41,  3.93it/s] 58%|█████▊    | 1224/2094 [05:18<03:41,  3.93it/s] 70%|██████▉   | 1460/2094 [06:00<02:41,  3.93it/s] 70%|██████▉   | 1460/2094 [06:18<02:41,  3.93it/s] 80%|███████▉  | 1672/2094 [07:00<01:51,  3.80it/s] 80%|███████▉  | 1672/2094 [07:18<01:51,  3.80it/s] 90%|████████▉ | 1880/2094 [08:01<00:58,  3.68it/s] 90%|████████▉ | 1880/2094 [08:18<00:58,  3.68it/s]100%|██████████| 2094/2094 [08:59<00:00,  3.88it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                     subj_anchors_sg                          subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...                                            [trout]  {'bass': 0.39879070899703284, 'carp': 0.181602...                             [trout]                                  [trout]                                            [trout]  catfish catfish catfish           1   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...  [lime, orange, apple, yes, cherry, water, pepp...  {'lime': 0.5027932287617163, 'orange': 0.15136...  [lime, orange, apple, yes, cherry]   [limes, orange, apples, yes, cherries]  [lime, orange, apple, yes, cherry, water, pepp...        lemon lemon lemon          10   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...   [snake, bird, fish, lizard, frog]  [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...  [boxes, yes, shoes, cases, obviously, yeah, cl...  {'boxes': 0.1638453546911478, 'yes': 0.0626923...   [box, yes, shoe, case, obviously]    [boxes, yes, shoes, cases, obviously]  [box, yes, shoe, case, obviously, yeah, clothe...            bags bag bags          10   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....                                          [rodents]  {'foxes': 0.21225315535610373, 'deer': 0.16438...                            [rodent]                                [rodents]                                           [rodent]   rabbits rabbit rabbits           1   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a trout is a [MASK]., a catfish ...  [[MASK] such as catfish and trout., [MASK], in...  [fish, species, salmon, trout, freshwater, pre...  {'fish': -4.253217245046752, 'species': -12.24...  [fish, species, fishing, fishery, animal, seaf...  {'fish': -5.0773572713633035, 'species': -7.86...  
1  [a lemon or a lime is a [MASK]., a lemon or an...  [[MASK] such as lemon and limes., [MASK] such ...  [fruit, drink, apple, lime, candy, yes, berry,...  {'fruit': -6.215222270411444, 'drink': -9.5472...  [fruit, thing, citrus, lime, yes, apple, flavo...  {'fruits': -6.38605876173733, 'fruit': -6.9349...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a box is a [MASK]., a bag or a yes i...  [[MASK] such as bags and boxes., [MASK] such a...  [container, luggage, backpack, suitcase, yes, ...  {'container': -7.19792714910603, 'luggage': -8...  [thing, item, stuff, luggage, object, yes, goo...  {'things': -7.003505253732369, 'items': -8.343...  
4  [a rabbit or a rodent is a [MASK]., a rabbit o...  [[MASK] such as rabbits and rodents., [MASK], ...  [mammal, animal, species, creature, predator, ...  {'mammal': -5.311165544519599, 'animal': -6.29...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.68861383113838, 'rodents': -6.7...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  15.4 	  25.9 	   25.9 	  19.5 
  1 	 subj_anchors_all 	  15.4 	  25.9 	   31   	  20.2 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.3 	  38.2 	   50.1 	  24.5 	              2 
  4 	 lsp_dap     	  12.9 	  33.8 	   45.7 	  22.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWSimilar.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWSimilar.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'LM', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'ShareSWOWSimilar', 'add_swow_filter': True, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                         subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...                                 [trout]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...      [lime, orange, apple, yes, cherry]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...       [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...       [box, yes, shoe, case, obviously]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...                                [rodent]
...                                                 ...                                     ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...  [human, dimension, people, maybe, yes]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...  [human, dimension, people, maybe, yes]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...  [human, dimension, people, maybe, yes]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...                     [editor, publisher]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...     [house, shed, barn, garden, street]

[2094 rows x 2 columns]
                                                lsp_dap                          subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...                                  [trout]
1     [[MASK] such as lemon and [Z]., [MASK], includ...   [limes, orange, apples, yes, cherries]
2     [[MASK] such as turtles and [Z]., [MASK], incl...  [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...    [boxes, yes, shoes, cases, obviously]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...                                [rodents]
...                                                 ...                                      ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...  [human, dimensions, people, maybe, yes]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...  [human, dimensions, people, maybe, yes]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...  [human, dimensions, people, maybe, yes]
2092  [[MASK] such as writers and [Z]., [MASK], incl...                    [editors, publishers]
2093  [[MASK] such as yard and [Z]., [MASK], includi...   [houses, shed, barn, gardens, streets]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 25%|██▌       | 528/2094 [01:00<02:58,  8.79it/s] 25%|██▌       | 528/2094 [01:20<02:58,  8.79it/s] 48%|████▊     | 1012/2094 [02:00<02:09,  8.35it/s] 48%|████▊     | 1012/2094 [02:20<02:09,  8.35it/s] 71%|███████   | 1479/2094 [03:00<01:15,  8.09it/s] 71%|███████   | 1479/2094 [03:20<01:15,  8.09it/s] 91%|█████████ | 1901/2094 [04:00<00:25,  7.67it/s] 91%|█████████ | 1901/2094 [04:20<00:25,  7.67it/s]100%|██████████| 2094/2094 [04:26<00:00,  7.85it/s]
  0%|          | 0/2094 [00:00<?, ?it/s] 13%|█▎        | 278/2094 [01:00<06:32,  4.63it/s] 13%|█▎        | 278/2094 [01:13<06:32,  4.63it/s] 25%|██▌       | 529/2094 [02:00<05:58,  4.36it/s] 25%|██▌       | 529/2094 [02:13<05:58,  4.36it/s] 38%|███▊      | 799/2094 [03:00<04:53,  4.42it/s] 38%|███▊      | 799/2094 [03:13<04:53,  4.42it/s] 48%|████▊     | 1015/2094 [04:00<04:23,  4.09it/s] 48%|████▊     | 1015/2094 [04:13<04:23,  4.09it/s] 59%|█████▉    | 1243/2094 [05:00<03:33,  3.99it/s] 59%|█████▉    | 1243/2094 [05:13<03:33,  3.99it/s] 71%|███████   | 1486/2094 [06:00<02:31,  4.00it/s] 71%|███████   | 1486/2094 [06:13<02:31,  4.00it/s] 81%|████████▏ | 1705/2094 [07:00<01:40,  3.88it/s] 81%|████████▏ | 1705/2094 [07:13<01:40,  3.88it/s] 92%|█████████▏| 1917/2094 [08:01<00:46,  3.77it/s] 92%|█████████▏| 1917/2094 [08:13<00:46,  3.77it/s]100%|██████████| 2094/2094 [08:50<00:00,  3.95it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                     subj_anchors_sg                          subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...                                            [trout]  {'bass': 0.39879070899703284, 'carp': 0.181602...                             [trout]                                  [trout]                                            [trout]  catfish catfish catfish           1   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...  [lime, orange, apple, yes, cherry, water, pepp...  {'lime': 0.5027932287617163, 'orange': 0.15136...  [lime, orange, apple, yes, cherry]   [limes, orange, apples, yes, cherries]  [lime, orange, apple, yes, cherry, water, pepp...        lemon lemon lemon          10   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...   [snake, bird, fish, lizard, frog]  [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...  [boxes, yes, shoes, cases, obviously, yeah, cl...  {'boxes': 0.1638453546911478, 'yes': 0.0626923...   [box, yes, shoe, case, obviously]    [boxes, yes, shoes, cases, obviously]  [box, yes, shoe, case, obviously, yeah, clothe...            bags bag bags          10   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....                                          [rodents]  {'foxes': 0.21225315535610373, 'deer': 0.16438...                            [rodent]                                [rodents]                                           [rodent]   rabbits rabbit rabbits           1   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a trout is a [MASK]., a catfish ...  [[MASK] such as catfish and trout., [MASK], in...  [fish, species, salmon, trout, freshwater, pre...  {'fish': -4.253217245046752, 'species': -12.24...  [fish, species, fishing, fishery, animal, seaf...  {'fish': -5.0773572713633035, 'species': -7.86...  
1  [a lemon or a lime is a [MASK]., a lemon or an...  [[MASK] such as lemon and limes., [MASK] such ...  [fruit, drink, apple, lime, candy, yes, berry,...  {'fruit': -6.215222270411444, 'drink': -9.5472...  [fruit, thing, citrus, lime, yes, apple, flavo...  {'fruits': -6.38605876173733, 'fruit': -6.9349...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a box is a [MASK]., a bag or a yes i...  [[MASK] such as bags and boxes., [MASK] such a...  [container, luggage, backpack, suitcase, yes, ...  {'container': -7.19792714910603, 'luggage': -8...  [thing, item, stuff, luggage, object, yes, goo...  {'things': -7.003505253732369, 'items': -8.343...  
4  [a rabbit or a rodent is a [MASK]., a rabbit o...  [[MASK] such as rabbits and rodents., [MASK], ...  [mammal, animal, species, creature, predator, ...  {'mammal': -5.311165544519599, 'animal': -6.29...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.68861383113838, 'rodents': -6.7...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  15.8 	  25.9 	   25.9 	  19.6 
  1 	 subj_anchors_all 	  15.8 	  25.9 	   31   	  20.3 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.3 	  38.2 	   50.1 	  24.5 	              2 
  4 	 lsp_dap     	  12.9 	  33.8 	   45.7 	  22.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWSimilar.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWSimilar.ALLSWOW.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/ALL/swow_rw/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'LM', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'ShareSWOWSimilar', 'add_swow_filter': True, 'dataset': 'ALLSWOW'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/ALL/swow_rw//IsA.jsonl
#All Instances: 2094
#Valid Instances: 2094 in ALLSWOW (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                         subj_anchors_sg
0     [a catfish or [Z] is a [MASK]., a catfish or [...                                 [trout]
1     [a lemon or [Z] is a [MASK]., a lemon or [Z] i...      [lime, orange, apple, yes, cherry]
2     [a turtle or [Z] is a [MASK]., a turtle or [Z]...       [snake, bird, fish, lizard, frog]
3     [a bag or [Z] is a [MASK]., a bag or [Z] is a ...       [box, yes, shoe, case, obviously]
4     [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...                                [rodent]
...                                                 ...                                     ...
2089  [a world or [Z] is a [MASK]., a world or [Z] i...  [human, dimension, people, maybe, yes]
2090  [a world or [Z] is a [MASK]., a world or [Z] i...  [human, dimension, people, maybe, yes]
2091  [a world or [Z] is a [MASK]., a world or [Z] i...  [human, dimension, people, maybe, yes]
2092  [a writer or [Z] is a [MASK]., a writer or [Z]...                     [publisher, editor]
2093  [a yard or [Z] is a [MASK]., a yard or [Z] is ...     [house, shed, barn, garden, street]

[2094 rows x 2 columns]
                                                lsp_dap                          subj_anchors_pl
0     [[MASK] such as catfish and [Z]., [MASK], incl...                                  [trout]
1     [[MASK] such as lemon and [Z]., [MASK], includ...   [limes, orange, apples, yes, cherries]
2     [[MASK] such as turtles and [Z]., [MASK], incl...  [snakes, birds, fishes, lizards, frogs]
3     [[MASK] such as bags and [Z]., [MASK], includi...    [boxes, yes, shoes, cases, obviously]
4     [[MASK] such as rabbits and [Z]., [MASK], incl...                                [rodents]
...                                                 ...                                      ...
2089  [[MASK] such as worlds and [Z]., [MASK], inclu...  [human, dimensions, people, maybe, yes]
2090  [[MASK] such as worlds and [Z]., [MASK], inclu...  [human, dimensions, people, maybe, yes]
2091  [[MASK] such as worlds and [Z]., [MASK], inclu...  [human, dimensions, people, maybe, yes]
2092  [[MASK] such as writers and [Z]., [MASK], incl...                    [publishers, editors]
2093  [[MASK] such as yard and [Z]., [MASK], includi...   [houses, shed, barn, gardens, streets]

[2094 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/2094 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 25%|██▍       | 516/2094 [01:00<03:03,  8.59it/s] 25%|██▍       | 516/2094 [01:20<03:03,  8.59it/s] 48%|████▊     | 995/2094 [02:00<02:13,  8.22it/s] 48%|████▊     | 995/2094 [02:20<02:13,  8.22it/s] 69%|██████▉   | 1447/2094 [03:00<01:21,  7.90it/s] 69%|██████▉   | 1447/2094 [03:20<01:21,  7.90it/s] 89%|████████▉ | 1862/2094 [04:00<00:30,  7.51it/s] 89%|████████▉ | 1862/2094 [04:20<00:30,  7.51it/s]100%|██████████| 2094/2094 [04:32<00:00,  7.68it/s]
  0%|          | 0/2094 [00:00<?, ?it/s] 13%|█▎        | 272/2094 [01:00<06:44,  4.51it/s] 13%|█▎        | 272/2094 [01:17<06:44,  4.51it/s] 25%|██▍       | 518/2094 [02:00<06:09,  4.27it/s] 25%|██▍       | 518/2094 [02:17<06:09,  4.27it/s] 37%|███▋      | 779/2094 [03:00<05:05,  4.30it/s] 37%|███▋      | 779/2094 [03:17<05:05,  4.30it/s] 48%|████▊     | 997/2094 [04:00<04:31,  4.04it/s] 48%|████▊     | 997/2094 [04:17<04:31,  4.04it/s] 58%|█████▊    | 1216/2094 [05:00<03:45,  3.90it/s] 58%|█████▊    | 1216/2094 [05:17<03:45,  3.90it/s] 69%|██████▉   | 1453/2094 [06:00<02:43,  3.91it/s] 69%|██████▉   | 1453/2094 [06:17<02:43,  3.91it/s] 80%|███████▉  | 1665/2094 [07:00<01:53,  3.79it/s] 80%|███████▉  | 1665/2094 [07:17<01:53,  3.79it/s] 89%|████████▉ | 1872/2094 [08:00<01:00,  3.67it/s] 89%|████████▉ | 1872/2094 [08:17<01:00,  3.67it/s]100%|█████████▉| 2091/2094 [09:01<00:00,  3.67it/s]100%|██████████| 2094/2094 [09:02<00:00,  3.86it/s]
  sub_label   obj_label relation  obj_in_BERT         masked_sentences  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                                       subj_anchors                                 subj_anchors_score                     subj_anchors_sg                          subj_anchors_pl                                   subj_anchors_all    subj_anchors_combined  anchor_num  \
0   catfish      [fish]      IsA            1  [A catfish is a [MASK]]     1             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish  [fish, boat, river, genus, gastropod, lizard, ...  {'fish': -17.492517940945792, 'boat': -19.0523...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...                                            [trout]  {'bass': 0.39879070899703284, 'carp': 0.181602...                             [trout]                                  [trout]                                            [trout]  catfish catfish catfish           1   
1     lemon   [produce]      IsA            1    [A lemon is a [MASK]]     2             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon  [fruit, tree, person, bottle, key, seed, twist...  {'fruit': -15.145185477808239, 'tree': -15.459...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...  [lime, orange, apple, yes, cherry, water, pepp...  {'lime': 0.5027932287617163, 'orange': 0.15136...  [lime, orange, apple, yes, cherry]   [limes, orange, apples, yes, cherries]  [lime, orange, apple, yes, cherry, water, pepp...        lemon lemon lemon          10   
2   turtles     [beast]      IsA            1   [A turtle is a [MASK]]     3             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles   [lizard, person, shell, boat, human, fish, tree]  {'lizard': -16.036533980021577, 'person': -16....  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [snakes, birds, fish, lizards, frogs, dragons,...  {'snakes': 0.3146660774946213, 'birds': 0.1580...   [snake, bird, fish, lizard, frog]  [snakes, birds, fishes, lizards, frogs]  [snake, bird, fish, lizard, frog, dragon, shar...   turtles turtle turtles          10   
3      bags   [luggage]      IsA            1      [A bag is a [MASK]]     4             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags  [person, box, pouch, pack, container, suitcase...  {'person': -15.800401335816666, 'box': -16.478...  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...  [boxes, yes, shoes, cases, obviously, yeah, cl...  {'boxes': 0.1638453546911478, 'yes': 0.0626923...   [box, yes, shoe, case, obviously]    [boxes, yes, shoes, cases, obviously]  [box, yes, shoe, case, obviously, yeah, clothe...            bags bag bags          10   
4   rabbits  [creature]      IsA            1   [A rabbit is a [MASK]]     5             2       rabbit      rabbits  [a rabbit is a [MASK]., a rabbit is a type of ...  [a rabbit or [Z] is a [MASK]., a rabbit or [Z]...  [[MASK] such as rabbits., [MASK], including ra...  [[MASK] such as rabbits and [Z]., [MASK], incl...  [such as rabbits and [MASK]., such as rabbits ...   rabbits rabbit rabbits  [person, horse, human, dog, man, child, pig, k...  {'person': -15.755672171378398, 'horse': -15.9...  [animal, mammal, dog, bird, cat, fox, pig, har...  {'animal': -6.5751558948461675, 'mammal': -8.9...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.903334231711103, 'rodents': -7....                                          [rodents]  {'foxes': 0.21225315535610373, 'deer': 0.16438...                            [rodent]                                [rodents]                                           [rodent]   rabbits rabbit rabbits           1   

                            def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [a catfish or a trout is a [MASK]., a catfish ...  [[MASK] such as catfish and trout., [MASK], in...  [fish, species, salmon, trout, freshwater, pre...  {'fish': -4.253217245046752, 'species': -12.24...  [fish, species, fishing, fishery, animal, seaf...  {'fish': -5.0773572713633035, 'species': -7.86...  
1  [a lemon or a lime is a [MASK]., a lemon or an...  [[MASK] such as lemon and limes., [MASK] such ...  [fruit, drink, apple, lime, candy, yes, berry,...  {'fruit': -6.215222270411444, 'drink': -9.5472...  [fruit, thing, citrus, lime, yes, apple, flavo...  {'fruits': -6.38605876173733, 'fruit': -6.9349...  
2  [a turtle or a snake is a [MASK]., a turtle or...  [[MASK] such as turtles and snakes., [MASK] su...  [animal, bird, fish, mammal, creature, lizard,...  {'animal': -7.5255446660385035, 'bird': -7.676...  [reptile, animal, wildlife, invertebrates, bir...  {'reptiles': -6.164623090730166, 'animals': -6...  
3  [a bag or a box is a [MASK]., a bag or a yes i...  [[MASK] such as bags and boxes., [MASK] such a...  [container, luggage, backpack, suitcase, yes, ...  {'container': -7.19792714910603, 'luggage': -8...  [thing, item, stuff, luggage, object, yes, goo...  {'things': -7.003505253732369, 'items': -8.343...  
4  [a rabbit or a rodent is a [MASK]., a rabbit o...  [[MASK] such as rabbits and rodents., [MASK], ...  [mammal, animal, species, creature, predator, ...  {'mammal': -5.311165544519599, 'animal': -6.29...  [animal, rodent, mammal, wildlife, livestock, ...  {'animals': -5.68861383113838, 'rodents': -6.7...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type        	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_sg  	  15.8 	  25.9 	   25.9 	  19.7 
  1 	 subj_anchors_all 	  15.8 	  25.9 	   31   	  20.4 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  13.3 	  36.7 	   46.8 	  23.2 	              1 
  2 	 lsp_sap     	  12.3 	  33.1 	   44.4 	  21.2 	              3 
  3 	 def_dap     	  14.3 	  38.2 	   50.1 	  24.5 	              2 
  4 	 lsp_dap     	  12.9 	  33.8 	   45.7 	  22.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWSimilar.ALLSWOW.tsv
save log/bert-large-uncased/ALL/swow_rw/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_LM_wns_False_wnf_False_swow_score_source_ShareSWOWSimilar.ALLSWOW.csv
