debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/lm_diagnostic_extended/singular/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': True, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'DIAG'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/lm_diagnostic_extended/singular//IsA.jsonl
#All Instances: 576
#Valid Instances: 576 in DIAG (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                       subj_anchors_wordnet_sg
0    [a graver or [Z] is a [MASK]., a graver or [Z]...      [shovel, digger, deeper, hammer, harder]
1    [a smallmouth or [Z] is a [MASK]., a smallmout...              [catfish, carp, bass, frog, eel]
2    [a pelican or [Z] is a [MASK]., a pelican or [...           [dolphin, whale, bird, heron, duck]
3    [a sapsucker or [Z] is a [MASK]., a sapsucker ...      [snake, spider, vampire, lizard, zombie]
4    [a mako or [Z] is a [MASK]., a mako or [Z] is ...               [human, dog, bird, man, animal]
..                                                 ...                                           ...
571  [a biplane or [Z] is a [MASK]., a biplane or [...  [fighter, bomber, scout, aircraft, airplane]
572  [a baobab or [Z] is a [MASK]., a baobab or [Z]...                                       [mango]
573  [an aircraft or [Z] is a [MASK]., an aircraft ...     [helicopter, ship, vehicle, boat, rocket]
574  [a gean or [Z] is a [MASK]., a gean or [Z] is ...                 [human, man, ge, gan, person]
575  [a luge or [Z] is a [MASK]., a luge or [Z] is ...          [knife, drills, needle, sword, john]

[576 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as graver and [Z]., [MASK], inclu...         [shovels, digger, deeper, hammers, harder]
1    [[MASK] such as smallmouths and [Z]., [MASK], ...               [catfish, carp, basses, frogs, eels]
2    [[MASK] such as pelican and [Z]., [MASK], incl...            [dolphin, whales, birds, herons, ducks]
3    [[MASK] such as sapsuckers and [Z]., [MASK], i...      [snakes, spiders, vampires, lizards, zombies]
4    [[MASK] such as mako and [Z]., [MASK], includi...                 [human, dogs, birds, men, animals]
..                                                 ...                                                ...
571  [[MASK] such as biplanes and [Z]., [MASK], inc...  [fighters, bombers, scouts, aircrafts, airplanes]
572  [[MASK] such as baobab and [Z]., [MASK], inclu...                                            [mango]
573  [[MASK] such as aircrafts and [Z]., [MASK], in...     [helicopters, ships, vehicles, boats, rockets]
574  [[MASK] such as gean and [Z]., [MASK], includi...                    [human, men, ge, gans, persons]
575  [[MASK] such as luges and [Z]., [MASK], includ...            [knives, drills, needles, swords, john]

[576 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/576 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 67%|██████▋   | 385/576 [01:00<00:29,  6.40it/s] 67%|██████▋   | 385/576 [01:20<00:29,  6.40it/s]100%|██████████| 576/576 [01:30<00:00,  6.34it/s]
  0%|          | 0/576 [00:00<?, ?it/s] 34%|███▍      | 195/576 [01:00<01:57,  3.25it/s] 34%|███▍      | 195/576 [01:19<01:57,  3.25it/s] 67%|██████▋   | 386/576 [02:00<00:59,  3.20it/s] 67%|██████▋   | 386/576 [02:19<00:59,  3.20it/s]100%|█████████▉| 575/576 [03:00<00:00,  3.17it/s]100%|██████████| 576/576 [03:01<00:00,  3.18it/s]
              masked_sentences obj_label    sub_label sub_label_pl relation                                         sub_sister  uuid  sub_position sub_label_sg                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                      sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                         subj_anchors_wordnet_score                   subj_anchors_wordnet_sg                        subj_anchors_wordnet_pl  \
0      [A graver is a [MASK].]    [tool]       graver       graver      IsA  [bevel, dibber, spreader, hammer, crank, float...     1             2       graver  [a graver is a [MASK]., a graver is a type of ...  [a graver or [Z] is a [MASK]., a graver or [Z]...  [[MASK] such as graver., [MASK], including gra...  [[MASK] such as graver and [Z]., [MASK], inclu...  [such as graver and [MASK]., such as graver or...                graver graver graver            1  [digger, shovel, tool, grave, coffin, person, ...  {'digger': -8.93893395450476, 'shovel': -8.996...  [shovel, tool, coffin, digger, grave, oven, to...  {'shovel': -7.8714093588212215, 'tool': -8.745...  [tool, story, poems, thing, book, works, digge...  {'tool': -8.670671149942246, 'stories': -9.270...  [shovel, digger, deeper, hammer, harder, john,...  {'shovel': 0.05705932136625051, 'digger': 0.05...  [shovel, digger, deeper, hammer, harder]     [shovels, digger, deeper, hammers, harder]   
1  [A smallmouth is a [MASK].]    [fish]  smallmouths  smallmouths      IsA                                       [largemouth]     2             2   smallmouth  [a smallmouth is a [MASK]., a smallmouth is a ...  [a smallmouth or [Z] is a [MASK]., a smallmout...  [[MASK] such as smallmouths., [MASK], includin...  [[MASK] such as smallmouths and [Z]., [MASK], ...  [such as smallmouths and [MASK]., such as smal...  smallmouths smallmouth smallmouths            1  [fish, catfish, salmon, shark, trout, swimmer,...  {'fish': -4.648060742066287, 'catfish': -6.835...  [fish, catfish, shark, swimmer, salmon, carp, ...  {'fish': -4.852696385096972, 'catfish': -6.629...  [fish, catfish, species, reptile, thing, preda...  {'fish': -6.019906277942945, 'catfish': -7.293...  [catfish, carp, bass, frogs, eels, cerambycida...  {'catfish': 0.6535254202105782, 'carp': 0.1299...          [catfish, carp, bass, frog, eel]           [catfish, carp, basses, frogs, eels]   
2     [A pelican is a [MASK].]    [bird]      pelican      pelican      IsA  [cormorant, snakebird, tropicbird, darter, anh...     3             2      pelican  [a pelican is a [MASK]., a pelican is a type o...  [a pelican or [Z] is a [MASK]., a pelican or [...  [[MASK] such as pelican., [MASK], including pe...  [[MASK] such as pelican and [Z]., [MASK], incl...  [such as pelican and [MASK]., such as pelican ...             pelican pelican pelican            1  [bird, parrot, penguin, dolphin, fish, dog, pi...  {'bird': -5.553109751033401, 'parrot': -7.7402...  [bird, parrot, dolphin, fish, dog, turtle, ani...  {'bird': -5.434608383702077, 'parrot': -8.5271...  [story, fish, dolphin, animal, bird, ship, poe...  {'stories': -8.638846115876778, 'fish': -8.785...  [dolphin, whale, bird, heron, duck, fish, peng...  {'dolphin': 0.07245542225427926, 'whale': 0.03...       [dolphin, whale, bird, heron, duck]        [dolphin, whales, birds, herons, ducks]   
3   [A sapsucker is a [MASK].]    [bird]   sapsuckers   sapsuckers      IsA    [wryneck, redhead, piculet, ivorybill, flicker]     4             2    sapsucker  [a sapsucker is a [MASK]., a sapsucker is a ty...  [a sapsucker or [Z] is a [MASK]., a sapsucker ...  [[MASK] such as sapsuckers., [MASK], including...  [[MASK] such as sapsuckers and [Z]., [MASK], i...  [such as sapsuckers and [MASK]., such as sapsu...     sapsuckers sapsucker sapsuckers            1  [snake, worm, spider, bug, lizard, predator, t...  {'snake': -7.64518889675958, 'worm': -8.365534...  [insect, snake, spider, lizard, animal, worm, ...  {'insect': -7.6130040846174385, 'snake': -8.26...  [snake, reptile, animal, insect, predator, cre...  {'snakes': -6.653929158976036, 'reptiles': -7....  [snakes, spiders, vampires, lizards, zombies, ...  {'snakes': 0.23924588378180156, 'spiders': 0.0...  [snake, spider, vampire, lizard, zombie]  [snakes, spiders, vampires, lizards, zombies]   
4        [A mako is a [MASK].]    [fish]         mako         mako      IsA                                        [porbeagle]     5             2         mako  [a mako is a [MASK]., a mako is a type of [MAS...  [a mako or [Z] is a [MASK]., a mako or [Z] is ...  [[MASK] such as mako., [MASK], including mako....  [[MASK] such as mako and [Z]., [MASK], includi...  [such as mako and [MASK]., such as mako or [MA...                      mako mako mako            1  [fish, canoe, drum, dog, boat, drummer, bird, ...  {'fish': -9.140592458399126, 'canoe': -9.49322...  [drum, fish, boat, canoe, bird, umbrella, flut...  {'drum': -8.934197447070298, 'fish': -9.539210...  [story, poems, fish, yes, artist, thing, peopl...  {'stories': -7.7291837518064845, 'poems': -9.2...  [human, dog, bird, man, animal, tuna, fish, wh...  {'human': 0.183084174990654, 'dog': 0.06033814...           [human, dog, bird, man, animal]             [human, dogs, birds, men, animals]   

                            subj_anchors_wordnet_all               subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [shovel, digger, deeper, hammer, harder, john,...                graver graver graver          10  [a graver or a shovel is a [MASK]., a graver o...  [[MASK] such as graver and shovels., [MASK] su...  [shovel, tool, digger, coffin, hammer, grave, ...  {'shovel': -7.267846614764853, 'tool': -7.6816...  [tool, thing, term, implement, yes, digger, sh...  {'tools': -7.066422549340426, 'things': -10.95...  
1  [catfish, carp, bass, frog, eel, cerambycidae,...  smallmouths smallmouth smallmouths          10  [a smallmouth or a catfish is a [MASK]., a sma...  [[MASK] such as smallmouths and catfish., [MAS...  [fish, catfish, mammal, frog, eel, toad, shark...  {'fish': -4.791638882592223, 'catfish': -8.175...  [fish, species, catfish, reptile, animal, bass...  {'fish': -6.020565090118574, 'species': -8.825...  
2  [dolphin, whale, bird, heron, duck, fish, peng...             pelican pelican pelican          10  [a pelican or a dolphin is a [MASK]., a pelica...  [[MASK] such as pelican and dolphin., [MASK] s...  [bird, dolphin, animal, fish, parrot, whale, b...  {'bird': -5.80281784715625, 'dolphin': -8.9196...  [bird, animal, species, fish, wildlife, mammal...  {'birds': -7.329673326729677, 'animals': -7.81...  
3  [snake, spider, vampire, lizard, zombie, beetl...     sapsuckers sapsucker sapsuckers          10  [a sapsucker or a snake is a [MASK]., a sapsuc...  [[MASK] such as sapsuckers and snakes., [MASK]...  [vampire, lizard, animal, insect, zombie, snak...  {'vampire': -8.462607530305084, 'lizard': -9.0...  [animal, reptile, snake, insect, demon, predat...  {'animals': -8.66370044212829, 'reptiles': -8....  
4  [human, dog, bird, man, animal, tuna, fish, wh...                      mako mako mako          10  [a mako or a human is a [MASK]., a mako or a d...  [[MASK] such as mako and human., [MASK] such a...  [animal, bird, person, dog, fish, human, creat...  {'animal': -7.602114597701367, 'bird': -8.3862...  [animal, thing, creature, dog, pet, bird, woma...  {'animals': -6.774860107420795, 'things': -9.9...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  10.4 	  16.8 	   16.8 	  12.9 
  1 	 subj_anchors_wordnet_all 	  10.4 	  16.8 	   18   	  13.1 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  32.5 	  56.6 	   66.8 	  42.6 	              1 
  2 	 lsp_sap     	  30.7 	  51.2 	   59.9 	  39   	              3 
  3 	 def_dap     	  35.4 	  58.9 	   68.6 	  45.7 	              2 
  4 	 lsp_dap     	  32.6 	  53.5 	   62.7 	  42.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.DIAG.tsv
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.DIAG.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/lm_diagnostic_extended/singular/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': True, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'DIAG'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/lm_diagnostic_extended/singular//IsA.jsonl
#All Instances: 576
#Valid Instances: 576 in DIAG (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                       subj_anchors_wordnet_sg
0    [a graver or [Z] is a [MASK]., a graver or [Z]...      [shovel, digger, deeper, hammer, harder]
1    [a smallmouth or [Z] is a [MASK]., a smallmout...              [catfish, carp, bass, frog, eel]
2    [a pelican or [Z] is a [MASK]., a pelican or [...           [dolphin, whale, bird, heron, duck]
3    [a sapsucker or [Z] is a [MASK]., a sapsucker ...      [snake, spider, vampire, lizard, zombie]
4    [a mako or [Z] is a [MASK]., a mako or [Z] is ...               [human, dog, bird, man, animal]
..                                                 ...                                           ...
571  [a biplane or [Z] is a [MASK]., a biplane or [...  [fighter, bomber, scout, aircraft, airplane]
572  [a baobab or [Z] is a [MASK]., a baobab or [Z]...                                       [mango]
573  [an aircraft or [Z] is a [MASK]., an aircraft ...     [helicopter, ship, vehicle, boat, rocket]
574  [a gean or [Z] is a [MASK]., a gean or [Z] is ...                 [human, man, ge, gan, person]
575  [a luge or [Z] is a [MASK]., a luge or [Z] is ...          [knife, drills, needle, sword, john]

[576 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as graver and [Z]., [MASK], inclu...         [shovels, digger, deeper, hammers, harder]
1    [[MASK] such as smallmouths and [Z]., [MASK], ...               [catfish, carp, basses, frogs, eels]
2    [[MASK] such as pelican and [Z]., [MASK], incl...            [dolphin, whales, birds, herons, ducks]
3    [[MASK] such as sapsuckers and [Z]., [MASK], i...      [snakes, spiders, vampires, lizards, zombies]
4    [[MASK] such as mako and [Z]., [MASK], includi...                 [human, dogs, birds, men, animals]
..                                                 ...                                                ...
571  [[MASK] such as biplanes and [Z]., [MASK], inc...  [fighters, bombers, scouts, aircrafts, airplanes]
572  [[MASK] such as baobab and [Z]., [MASK], inclu...                                            [mango]
573  [[MASK] such as aircrafts and [Z]., [MASK], in...     [helicopters, ships, vehicles, boats, rockets]
574  [[MASK] such as gean and [Z]., [MASK], includi...                    [human, men, ge, gans, persons]
575  [[MASK] such as luges and [Z]., [MASK], includ...            [knives, drills, needles, swords, john]

[576 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/576 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 59%|█████▉    | 339/576 [01:00<00:42,  5.64it/s] 59%|█████▉    | 339/576 [01:20<00:42,  5.64it/s]100%|██████████| 576/576 [01:39<00:00,  5.81it/s]
  0%|          | 0/576 [00:00<?, ?it/s] 35%|███▌      | 204/576 [01:00<01:49,  3.40it/s] 35%|███▌      | 204/576 [01:10<01:49,  3.40it/s] 69%|██████▉   | 398/576 [02:00<00:53,  3.30it/s] 69%|██████▉   | 398/576 [02:10<00:53,  3.30it/s]100%|██████████| 576/576 [02:58<00:00,  3.23it/s]
              masked_sentences obj_label    sub_label sub_label_pl relation                                         sub_sister  uuid  sub_position sub_label_sg                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                      sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                         subj_anchors_wordnet_score                   subj_anchors_wordnet_sg                        subj_anchors_wordnet_pl  \
0      [A graver is a [MASK].]    [tool]       graver       graver      IsA  [bevel, dibber, spreader, hammer, crank, float...     1             2       graver  [a graver is a [MASK]., a graver is a type of ...  [a graver or [Z] is a [MASK]., a graver or [Z]...  [[MASK] such as graver., [MASK], including gra...  [[MASK] such as graver and [Z]., [MASK], inclu...  [such as graver and [MASK]., such as graver or...                graver graver graver            1  [digger, shovel, tool, grave, coffin, person, ...  {'digger': -8.93893395450476, 'shovel': -8.996...  [shovel, tool, coffin, digger, grave, oven, to...  {'shovel': -7.8714093588212215, 'tool': -8.745...  [tool, story, poems, thing, book, works, digge...  {'tool': -8.670671149942246, 'stories': -9.270...  [shovel, digger, deeper, hammer, harder, john,...  {'shovel': 0.05705932136625051, 'digger': 0.05...  [shovel, digger, deeper, hammer, harder]     [shovels, digger, deeper, hammers, harder]   
1  [A smallmouth is a [MASK].]    [fish]  smallmouths  smallmouths      IsA                                       [largemouth]     2             2   smallmouth  [a smallmouth is a [MASK]., a smallmouth is a ...  [a smallmouth or [Z] is a [MASK]., a smallmout...  [[MASK] such as smallmouths., [MASK], includin...  [[MASK] such as smallmouths and [Z]., [MASK], ...  [such as smallmouths and [MASK]., such as smal...  smallmouths smallmouth smallmouths            1  [fish, catfish, salmon, shark, trout, swimmer,...  {'fish': -4.648060742066287, 'catfish': -6.835...  [fish, catfish, shark, swimmer, salmon, carp, ...  {'fish': -4.852696385096972, 'catfish': -6.629...  [fish, catfish, species, reptile, thing, preda...  {'fish': -6.019906277942945, 'catfish': -7.293...  [catfish, carp, bass, frogs, eels, cerambycida...  {'catfish': 0.6535254202105782, 'carp': 0.1299...          [catfish, carp, bass, frog, eel]           [catfish, carp, basses, frogs, eels]   
2     [A pelican is a [MASK].]    [bird]      pelican      pelican      IsA  [cormorant, snakebird, tropicbird, darter, anh...     3             2      pelican  [a pelican is a [MASK]., a pelican is a type o...  [a pelican or [Z] is a [MASK]., a pelican or [...  [[MASK] such as pelican., [MASK], including pe...  [[MASK] such as pelican and [Z]., [MASK], incl...  [such as pelican and [MASK]., such as pelican ...             pelican pelican pelican            1  [bird, parrot, penguin, dolphin, fish, dog, pi...  {'bird': -5.553109751033401, 'parrot': -7.7402...  [bird, parrot, dolphin, fish, dog, turtle, ani...  {'bird': -5.434608383702077, 'parrot': -8.5271...  [story, fish, dolphin, animal, bird, ship, poe...  {'stories': -8.638846115876778, 'fish': -8.785...  [dolphin, whale, bird, heron, duck, fish, peng...  {'dolphin': 0.07245542225427926, 'whale': 0.03...       [dolphin, whale, bird, heron, duck]        [dolphin, whales, birds, herons, ducks]   
3   [A sapsucker is a [MASK].]    [bird]   sapsuckers   sapsuckers      IsA    [wryneck, redhead, piculet, ivorybill, flicker]     4             2    sapsucker  [a sapsucker is a [MASK]., a sapsucker is a ty...  [a sapsucker or [Z] is a [MASK]., a sapsucker ...  [[MASK] such as sapsuckers., [MASK], including...  [[MASK] such as sapsuckers and [Z]., [MASK], i...  [such as sapsuckers and [MASK]., such as sapsu...     sapsuckers sapsucker sapsuckers            1  [snake, worm, spider, bug, lizard, predator, t...  {'snake': -7.64518889675958, 'worm': -8.365534...  [insect, snake, spider, lizard, animal, worm, ...  {'insect': -7.6130040846174385, 'snake': -8.26...  [snake, reptile, animal, insect, predator, cre...  {'snakes': -6.653929158976036, 'reptiles': -7....  [snakes, spiders, vampires, lizards, zombies, ...  {'snakes': 0.23924588378180156, 'spiders': 0.0...  [snake, spider, vampire, lizard, zombie]  [snakes, spiders, vampires, lizards, zombies]   
4        [A mako is a [MASK].]    [fish]         mako         mako      IsA                                        [porbeagle]     5             2         mako  [a mako is a [MASK]., a mako is a type of [MAS...  [a mako or [Z] is a [MASK]., a mako or [Z] is ...  [[MASK] such as mako., [MASK], including mako....  [[MASK] such as mako and [Z]., [MASK], includi...  [such as mako and [MASK]., such as mako or [MA...                      mako mako mako            1  [fish, canoe, drum, dog, boat, drummer, bird, ...  {'fish': -9.140592458399126, 'canoe': -9.49322...  [drum, fish, boat, canoe, bird, umbrella, flut...  {'drum': -8.934197447070298, 'fish': -9.539210...  [story, poems, fish, yes, artist, thing, peopl...  {'stories': -7.7291837518064845, 'poems': -9.2...  [human, dog, bird, man, animal, tuna, fish, wh...  {'human': 0.183084174990654, 'dog': 0.06033814...           [human, dog, bird, man, animal]             [human, dogs, birds, men, animals]   

                            subj_anchors_wordnet_all               subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [shovel, digger, deeper, hammer, harder, john,...                graver graver graver          10  [a graver or a shovel is a [MASK]., a graver o...  [[MASK] such as graver and shovels., [MASK] su...  [shovel, tool, digger, coffin, hammer, grave, ...  {'shovel': -7.267846614764853, 'tool': -7.6816...  [tool, thing, term, implement, yes, digger, sh...  {'tools': -7.066422549340426, 'things': -10.95...  
1  [catfish, carp, bass, frog, eel, cerambycidae,...  smallmouths smallmouth smallmouths          10  [a smallmouth or a catfish is a [MASK]., a sma...  [[MASK] such as smallmouths and catfish., [MAS...  [fish, catfish, mammal, frog, eel, toad, shark...  {'fish': -4.791638882592223, 'catfish': -8.175...  [fish, species, catfish, reptile, animal, bass...  {'fish': -6.020565090118574, 'species': -8.825...  
2  [dolphin, whale, bird, heron, duck, fish, peng...             pelican pelican pelican          10  [a pelican or a dolphin is a [MASK]., a pelica...  [[MASK] such as pelican and dolphin., [MASK] s...  [bird, dolphin, animal, fish, parrot, whale, b...  {'bird': -5.80281784715625, 'dolphin': -8.9196...  [bird, animal, species, fish, wildlife, mammal...  {'birds': -7.329673326729677, 'animals': -7.81...  
3  [snake, spider, vampire, lizard, zombie, beetl...     sapsuckers sapsucker sapsuckers          10  [a sapsucker or a snake is a [MASK]., a sapsuc...  [[MASK] such as sapsuckers and snakes., [MASK]...  [vampire, lizard, animal, insect, zombie, snak...  {'vampire': -8.462607530305084, 'lizard': -9.0...  [animal, reptile, snake, insect, demon, predat...  {'animals': -8.66370044212829, 'reptiles': -8....  
4  [human, dog, bird, man, animal, tuna, fish, wh...                      mako mako mako          10  [a mako or a human is a [MASK]., a mako or a d...  [[MASK] such as mako and human., [MASK] such a...  [animal, bird, person, dog, fish, human, creat...  {'animal': -7.602114597701367, 'bird': -8.3862...  [animal, thing, creature, dog, pet, bird, woma...  {'animals': -6.774860107420795, 'things': -9.9...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	    10 	  16.8 	   16.8 	  12.7 
  1 	 subj_anchors_wordnet_all 	    10 	  16.8 	   18   	  12.8 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  32.5 	  56.6 	   66.8 	  42.6 	              1 
  2 	 lsp_sap     	  30.7 	  51.2 	   59.9 	  39   	              3 
  3 	 def_dap     	  35.4 	  58.9 	   68.6 	  45.7 	              2 
  4 	 lsp_dap     	  32.6 	  53.8 	   62.7 	  42.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.DIAG.tsv
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.DIAG.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/lm_diagnostic_extended/singular/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': False, 'add_wordnet_path_score': False, 'add_wordnet_filter': True, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': False, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'DIAG'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/lm_diagnostic_extended/singular//IsA.jsonl
#All Instances: 576
#Valid Instances: 576 in DIAG (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                       subj_anchors_wordnet_sg
0    [a graver or [Z] is a [MASK]., a graver or [Z]...      [shovel, digger, deeper, hammer, harder]
1    [a smallmouth or [Z] is a [MASK]., a smallmout...              [catfish, carp, bass, frog, eel]
2    [a pelican or [Z] is a [MASK]., a pelican or [...           [dolphin, whale, bird, heron, duck]
3    [a sapsucker or [Z] is a [MASK]., a sapsucker ...      [snake, spider, vampire, lizard, zombie]
4    [a mako or [Z] is a [MASK]., a mako or [Z] is ...               [human, dog, bird, man, animal]
..                                                 ...                                           ...
571  [a biplane or [Z] is a [MASK]., a biplane or [...  [fighter, bomber, scout, aircraft, airplane]
572  [a baobab or [Z] is a [MASK]., a baobab or [Z]...                                       [mango]
573  [an aircraft or [Z] is a [MASK]., an aircraft ...     [helicopter, ship, vehicle, boat, rocket]
574  [a gean or [Z] is a [MASK]., a gean or [Z] is ...                 [human, man, ge, gan, person]
575  [a luge or [Z] is a [MASK]., a luge or [Z] is ...          [knife, drills, needle, sword, john]

[576 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as graver and [Z]., [MASK], inclu...         [shovels, digger, deeper, hammers, harder]
1    [[MASK] such as smallmouths and [Z]., [MASK], ...               [catfish, carp, basses, frogs, eels]
2    [[MASK] such as pelican and [Z]., [MASK], incl...            [dolphin, whales, birds, herons, ducks]
3    [[MASK] such as sapsuckers and [Z]., [MASK], i...      [snakes, spiders, vampires, lizards, zombies]
4    [[MASK] such as mako and [Z]., [MASK], includi...                 [human, dogs, birds, men, animals]
..                                                 ...                                                ...
571  [[MASK] such as biplanes and [Z]., [MASK], inc...  [fighters, bombers, scouts, aircrafts, airplanes]
572  [[MASK] such as baobab and [Z]., [MASK], inclu...                                            [mango]
573  [[MASK] such as aircrafts and [Z]., [MASK], in...     [helicopters, ships, vehicles, boats, rockets]
574  [[MASK] such as gean and [Z]., [MASK], includi...                    [human, men, ge, gans, persons]
575  [[MASK] such as luges and [Z]., [MASK], includ...            [knives, drills, needles, swords, john]

[576 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/576 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 55%|█████▍    | 316/576 [01:00<00:49,  5.26it/s] 55%|█████▍    | 316/576 [01:20<00:49,  5.26it/s]100%|██████████| 576/576 [01:45<00:00,  5.44it/s]
  0%|          | 0/576 [00:00<?, ?it/s] 31%|███       | 177/576 [01:00<02:16,  2.93it/s] 31%|███       | 177/576 [01:14<02:16,  2.93it/s] 61%|██████    | 349/576 [02:00<01:18,  2.89it/s] 61%|██████    | 349/576 [02:14<01:18,  2.89it/s] 88%|████████▊ | 508/576 [03:00<00:24,  2.78it/s] 88%|████████▊ | 508/576 [03:14<00:24,  2.78it/s]100%|██████████| 576/576 [03:23<00:00,  2.83it/s]
              masked_sentences obj_label    sub_label sub_label_pl relation                                         sub_sister  uuid  sub_position sub_label_sg                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                      sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                         subj_anchors_wordnet_score                   subj_anchors_wordnet_sg                        subj_anchors_wordnet_pl  \
0      [A graver is a [MASK].]    [tool]       graver       graver      IsA  [bevel, dibber, spreader, hammer, crank, float...     1             2       graver  [a graver is a [MASK]., a graver is a type of ...  [a graver or [Z] is a [MASK]., a graver or [Z]...  [[MASK] such as graver., [MASK], including gra...  [[MASK] such as graver and [Z]., [MASK], inclu...  [such as graver and [MASK]., such as graver or...                graver graver graver            1  [digger, shovel, tool, grave, coffin, person, ...  {'digger': -8.93893395450476, 'shovel': -8.996...  [shovel, tool, coffin, digger, grave, oven, to...  {'shovel': -7.8714093588212215, 'tool': -8.745...  [tool, story, poems, thing, book, works, digge...  {'tool': -8.670671149942246, 'stories': -9.270...  [shovel, digger, deeper, hammer, harder, john,...  {'shovel': 0.05705932136625051, 'digger': 0.05...  [shovel, digger, deeper, hammer, harder]     [shovels, digger, deeper, hammers, harder]   
1  [A smallmouth is a [MASK].]    [fish]  smallmouths  smallmouths      IsA                                       [largemouth]     2             2   smallmouth  [a smallmouth is a [MASK]., a smallmouth is a ...  [a smallmouth or [Z] is a [MASK]., a smallmout...  [[MASK] such as smallmouths., [MASK], includin...  [[MASK] such as smallmouths and [Z]., [MASK], ...  [such as smallmouths and [MASK]., such as smal...  smallmouths smallmouth smallmouths            1  [fish, catfish, salmon, shark, trout, swimmer,...  {'fish': -4.648060742066287, 'catfish': -6.835...  [fish, catfish, shark, swimmer, salmon, carp, ...  {'fish': -4.852696385096972, 'catfish': -6.629...  [fish, catfish, species, reptile, thing, preda...  {'fish': -6.019906277942945, 'catfish': -7.293...  [catfish, carp, bass, frogs, eels, cerambycida...  {'catfish': 0.6535254202105782, 'carp': 0.1299...          [catfish, carp, bass, frog, eel]           [catfish, carp, basses, frogs, eels]   
2     [A pelican is a [MASK].]    [bird]      pelican      pelican      IsA  [cormorant, snakebird, tropicbird, darter, anh...     3             2      pelican  [a pelican is a [MASK]., a pelican is a type o...  [a pelican or [Z] is a [MASK]., a pelican or [...  [[MASK] such as pelican., [MASK], including pe...  [[MASK] such as pelican and [Z]., [MASK], incl...  [such as pelican and [MASK]., such as pelican ...             pelican pelican pelican            1  [bird, parrot, penguin, dolphin, fish, dog, pi...  {'bird': -5.553109751033401, 'parrot': -7.7402...  [bird, parrot, dolphin, fish, dog, turtle, ani...  {'bird': -5.434608383702077, 'parrot': -8.5271...  [story, fish, dolphin, animal, bird, ship, poe...  {'stories': -8.638846115876778, 'fish': -8.785...  [dolphin, whale, bird, heron, duck, fish, peng...  {'dolphin': 0.07245542225427926, 'whale': 0.03...       [dolphin, whale, bird, heron, duck]        [dolphin, whales, birds, herons, ducks]   
3   [A sapsucker is a [MASK].]    [bird]   sapsuckers   sapsuckers      IsA    [wryneck, redhead, piculet, ivorybill, flicker]     4             2    sapsucker  [a sapsucker is a [MASK]., a sapsucker is a ty...  [a sapsucker or [Z] is a [MASK]., a sapsucker ...  [[MASK] such as sapsuckers., [MASK], including...  [[MASK] such as sapsuckers and [Z]., [MASK], i...  [such as sapsuckers and [MASK]., such as sapsu...     sapsuckers sapsucker sapsuckers            1  [snake, worm, spider, bug, lizard, predator, t...  {'snake': -7.64518889675958, 'worm': -8.365534...  [insect, snake, spider, lizard, animal, worm, ...  {'insect': -7.6130040846174385, 'snake': -8.26...  [snake, reptile, animal, insect, predator, cre...  {'snakes': -6.653929158976036, 'reptiles': -7....  [snakes, spiders, vampires, lizards, zombies, ...  {'snakes': 0.23924588378180156, 'spiders': 0.0...  [snake, spider, vampire, lizard, zombie]  [snakes, spiders, vampires, lizards, zombies]   
4        [A mako is a [MASK].]    [fish]         mako         mako      IsA                                        [porbeagle]     5             2         mako  [a mako is a [MASK]., a mako is a type of [MAS...  [a mako or [Z] is a [MASK]., a mako or [Z] is ...  [[MASK] such as mako., [MASK], including mako....  [[MASK] such as mako and [Z]., [MASK], includi...  [such as mako and [MASK]., such as mako or [MA...                      mako mako mako            1  [fish, canoe, drum, dog, boat, drummer, bird, ...  {'fish': -9.140592458399126, 'canoe': -9.49322...  [drum, fish, boat, canoe, bird, umbrella, flut...  {'drum': -8.934197447070298, 'fish': -9.539210...  [story, poems, fish, yes, artist, thing, peopl...  {'stories': -7.7291837518064845, 'poems': -9.2...  [human, dog, bird, man, animal, tuna, fish, wh...  {'human': 0.183084174990654, 'dog': 0.06033814...           [human, dog, bird, man, animal]             [human, dogs, birds, men, animals]   

                            subj_anchors_wordnet_all               subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [shovel, digger, deeper, hammer, harder, john,...                graver graver graver          10  [a graver or a shovel is a [MASK]., a graver o...  [[MASK] such as graver and shovels., [MASK] su...  [shovel, tool, digger, coffin, hammer, grave, ...  {'shovel': -7.267846614764853, 'tool': -7.6816...  [tool, thing, term, implement, yes, digger, sh...  {'tools': -7.066422549340426, 'things': -10.95...  
1  [catfish, carp, bass, frog, eel, cerambycidae,...  smallmouths smallmouth smallmouths          10  [a smallmouth or a catfish is a [MASK]., a sma...  [[MASK] such as smallmouths and catfish., [MAS...  [fish, catfish, mammal, frog, eel, toad, shark...  {'fish': -4.791638882592223, 'catfish': -8.175...  [fish, species, catfish, reptile, animal, bass...  {'fish': -6.020565090118574, 'species': -8.825...  
2  [dolphin, whale, bird, heron, duck, fish, peng...             pelican pelican pelican          10  [a pelican or a dolphin is a [MASK]., a pelica...  [[MASK] such as pelican and dolphin., [MASK] s...  [bird, dolphin, animal, fish, parrot, whale, b...  {'bird': -5.80281784715625, 'dolphin': -8.9196...  [bird, animal, species, fish, wildlife, mammal...  {'birds': -7.329673326729677, 'animals': -7.81...  
3  [snake, spider, vampire, lizard, zombie, beetl...     sapsuckers sapsucker sapsuckers          10  [a sapsucker or a snake is a [MASK]., a sapsuc...  [[MASK] such as sapsuckers and snakes., [MASK]...  [vampire, lizard, animal, insect, zombie, snak...  {'vampire': -8.462607530305084, 'lizard': -9.0...  [animal, reptile, snake, insect, demon, predat...  {'animals': -8.66370044212829, 'reptiles': -8....  
4  [human, dog, bird, man, animal, tuna, fish, wh...                      mako mako mako          10  [a mako or a human is a [MASK]., a mako or a d...  [[MASK] such as mako and human., [MASK] such a...  [animal, bird, person, dog, fish, human, creat...  {'animal': -7.602114597701367, 'bird': -8.3862...  [animal, thing, creature, dog, pet, bird, woma...  {'animals': -6.774860107420795, 'things': -9.9...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	   9.1 	    17 	     17 	  12.2 
  1 	 subj_anchors_wordnet_all 	   9.1 	    17 	     18 	  12.4 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  32.5 	  56.6 	   66.8 	  42.6 	              1 
  2 	 lsp_sap     	  30.7 	  51.2 	   59.9 	  39   	              3 
  3 	 def_dap     	  35.4 	  58.9 	   68.8 	  45.7 	              2 
  4 	 lsp_dap     	  32.6 	  53.6 	   62.7 	  42.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.DIAG.tsv
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_True_swow_score_source_None.DIAG.csv
