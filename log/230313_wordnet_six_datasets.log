debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/BLESS/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'BLESS'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/BLESS//IsA.jsonl
#All Instances: 1337
#Valid Instances: 935 in BLESS (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                            subj_anchors_wordnet_sg
0    [a catfish or [Z] is a [MASK]., a catfish or [...    [mudcat, wolffish, blennioid, whitefish, bream]
1    [a musket or [Z] is a [MASK]., a musket or [Z]...  [culverin, blunderbuss, fusil, matchlock, arqu...
2    [a lemon or [Z] is a [MASK]., a lemon or [Z] i...       [maize, gamboge, yellowness, citrus, yellow]
3    [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [turtleneck, jersey, chelonian, terrapin, redb...
4    [a bag or [Z] is a [MASK]., a bag or [Z] is a ...    [packsack, sandbag, pannier, backpack, beanbag]
..                                                 ...                                                ...
930  [a wrench or [Z] is a [MASK]., a wrench or [Z]...              [hurt, trauma, sprain, harms, injury]
931  [a squirrel or [Z] is a [MASK]., a squirrel or...    [baronduki, chipmunks, gopher, burunduki, pelt]
932  [a cello or [Z] is a [MASK]., a cello or [Z] i...  [violoncello, string, contrabasses, violin, viol]
933  [a glove or [Z] is a [MASK]., a glove or [Z] i...        [mitt, gauntlet, gantlet, mitten, handwear]
934  [a stereo or [Z] is a [MASK]., a stereo or [Z]...                                          [MISSING]

[921 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as catfish and [Z]., [MASK], incl...  [mudcat, wolffish, blennioids, whitefish, breams]
1    [[MASK] such as muskets and [Z]., [MASK], incl...  [culverins, blunderbuss, fusils, matchlock, ar...
2    [[MASK] such as lemon and [Z]., [MASK], includ...   [maize, gamboge, yellownesses, citruses, yellow]
3    [[MASK] such as turtles and [Z]., [MASK], incl...  [turtlenecks, jersey, chelonian, terrapin, red...
4    [[MASK] such as bags and [Z]., [MASK], includi...  [packsack, sandbag, pannier, backpacks, beanbags]
..                                                 ...                                                ...
930  [[MASK] such as wrenches and [Z]., [MASK], inc...           [hurt, traumas, sprain, harms, injuries]
931  [[MASK] such as squirrel and [Z]., [MASK], inc...  [baronduki, chipmunks, gophers, burundukis, pe...
932  [[MASK] such as cellos and [Z]., [MASK], inclu...  [violoncello, strings, contrabasses, violins, ...
933  [[MASK] such as glove and [Z]., [MASK], includ...      [mitt, gauntlets, gantlet, mitten, handwears]
934  [[MASK] such as stereos and [Z]., [MASK], incl...                                          [MISSING]

[921 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/921 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 35%|███▍      | 322/921 [01:00<01:51,  5.36it/s] 35%|███▍      | 322/921 [01:20<01:51,  5.36it/s] 71%|███████   | 654/921 [02:00<00:48,  5.46it/s] 71%|███████   | 654/921 [02:20<00:48,  5.46it/s]100%|██████████| 921/921 [02:48<00:00,  5.46it/s]
  0%|          | 0/921 [00:00<?, ?it/s] 17%|█▋        | 161/921 [01:00<04:44,  2.67it/s] 17%|█▋        | 161/921 [01:11<04:44,  2.67it/s] 35%|███▌      | 325/921 [02:00<03:40,  2.70it/s] 35%|███▌      | 325/921 [02:11<03:40,  2.70it/s] 54%|█████▎    | 494/921 [03:00<02:35,  2.75it/s] 54%|█████▎    | 494/921 [03:11<02:35,  2.75it/s] 72%|███████▏  | 659/921 [04:00<01:35,  2.75it/s] 72%|███████▏  | 659/921 [04:11<01:35,  2.75it/s] 90%|████████▉ | 828/921 [05:01<00:33,  2.77it/s] 90%|████████▉ | 828/921 [05:11<00:33,  2.77it/s]100%|██████████| 921/921 [05:35<00:00,  2.75it/s]
  sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
0   catfish     [fish]      IsA  [A catfish is a [MASK]., A catfish is an [MASK].]  [sandfish, wolffish, eel, greeneye, ghostfish,...     2             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish            1  [animal, fish, insect, eel, oyster, organism, ...  {'animal': -5.884246700948145, 'fish': -7.3868...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...  [mudcat, wolffish, blennioids, whitefish, breams]    [mudcat, wolffish, blennioid, whitefish, bream]  [mudcat, wolffish, blennioids, whitefish, breams]    [mudcat, wolffish, blennioid, whitefish, bream]   
1   muskets  [firearm]      IsA    [A musket is a [MASK]., A musket is an [MASK].]  [flintlock, hackbut, harquebus, firelock, arqu...     3             2       musket      muskets  [a musket is a [MASK]., a musket is a type of ...  [a musket or [Z] is a [MASK]., a musket or [Z]...  [[MASK] such as muskets., [MASK], including mu...  [[MASK] such as muskets and [Z]., [MASK], incl...  [such as muskets and [MASK]., such as muskets ...   muskets musket muskets            1  [artillery, firearm, gun, cannon, arrow, instr...  {'artillery': -6.829809756901031, 'firearm': -...  [firearm, cannon, gun, weapon, rifle, pistol, ...  {'firearm': -5.349813407088699, 'cannon': -7.0...  [weapon, firearm, gun, artillery, arm, impleme...  {'weapons': -6.112329372878857, 'firearms': -6...  [culverins, blunderbuss, fusils, matchlock, ar...  [culverin, blunderbuss, fusil, matchlock, arqu...  [culverins, blunderbuss, fusils, matchlock, ar...  [culverin, blunderbuss, fusil, matchlock, arqu...   
2     lemon  [produce]      IsA      [A lemon is a [MASK]., A lemon is an [MASK].]  [lemanderin, grapefruit, good, insert, button,...     4             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon            1  [apple, orange, object, adjective, olive, almo...  {'apple': -6.533058511601689, 'orange': -7.425...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...     [maize, gamboge, yellowness, citruses, yellow]       [maize, gamboge, yellowness, citrus, yellow]   [maize, gamboge, yellownesses, citruses, yellow]       [maize, gamboge, yellowness, citrus, yellow]   
3   turtles    [beast]      IsA    [A turtle is a [MASK]., A turtle is an [MASK].]         [turtleneck, pullover, slipover, cardigan]     6             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles            1  [animal, bird, fish, person, human, object, cr...  {'animal': -5.460504933765254, 'bird': -8.7831...  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [turtleneck, jersey, chelonian, terrapin, redb...  [turtleneck, jersey, chelonian, terrapin, redb...  [turtlenecks, jersey, chelonian, terrapin, red...  [turtleneck, jersey, chelonian, terrapin, redb...   
4      bags  [luggage]      IsA          [A bag is a [MASK]., A bag is an [MASK].]  [box, job, knocker, barrowful, measure, desser...     7             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags            1  [object, envelope, umbrella, item, accessory, ...  {'object': -7.057799467734983, 'envelope': -8....  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...   [packsack, sandbag, pannier, backpacks, beanbag]    [packsack, sandbag, pannier, backpack, beanbag]  [packsack, sandbag, pannier, backpacks, beanbags]    [packsack, sandbag, pannier, backpack, beanbag]   

     subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  catfish catfish catfish           5  [a catfish or a mudcat is a [MASK]., a catfish...  [[MASK] such as catfish and mudcat., [MASK] su...  [fish, predator, species, shark, shrimp, mollu...  {'fish': -4.512118065364479, 'predator': -13.0...  [fish, species, animal, invertebrates, fishery...  {'fish': -5.070587096878286, 'fishes': -8.6450...  
1   muskets musket muskets           5  [a musket or a culverin is a [MASK]., a musket...  [[MASK] such as muskets and culverins., [MASK]...  [firearm, cannon, weapon, gun, pistol, rifle, ...  {'firearm': -5.5695662609690695, 'cannon': -7....  [weapon, firearm, gun, artillery, arm, thing, ...  {'weapons': -5.828232415295086, 'firearms': -6...  
2        lemon lemon lemon           5  [a lemon or a maize is a [MASK]., a lemon or a...  [[MASK] such as lemon and maize., [MASK] such ...  [fruit, drink, color, colour, wine, orange, fl...  {'fruit': -6.81126683305999, 'drink': -10.0206...  [fruit, color, colour, citrus, thing, grain, c...  {'fruits': -7.61857376836028, 'colors': -8.617...  
3   turtles turtle turtles           5  [a turtle or a turtleneck is a [MASK]., a turt...  [[MASK] such as turtles and turtlenecks., [MAS...  [bird, jacket, fish, costume, animal, garment,...  {'bird': -7.624336495446805, 'jacket': -8.5524...  [reptile, animal, bird, island, fish, creature...  {'reptiles': -6.917641572092762, 'animals': -8...  
4            bags bag bags           5  [a bag or a packsack is a [MASK]., a bag or a ...  [[MASK] such as bags and packsack., [MASK] suc...  [backpack, container, luggage, sack, suitcase,...  {'backpack': -7.07982347117534, 'container': -...  [luggage, item, thing, container, accessory, o...  {'luggage': -8.476053798102438, 'items': -8.50...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  35.7 	  67.9 	   67.9 	  46.8 
  1 	 subj_anchors_wordnet_all 	  35.7 	  67.9 	   67.9 	  46.8 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  16.3 	  32.4 	   42.1 	  23.5 	              1 
  2 	 lsp_sap     	  16.3 	  36.4 	   49.4 	  25.1 	              3 
  3 	 def_dap     	  16.2 	  32.9 	   41.7 	  23.5 	              2 
  4 	 lsp_dap     	  17.6 	  37.7 	   49.7 	  26.3 	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.BLESS.tsv
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.BLESS.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/BLESS/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'BLESS'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/BLESS//IsA.jsonl
#All Instances: 1337
#Valid Instances: 935 in BLESS (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                            subj_anchors_wordnet_sg
0    [a catfish or [Z] is a [MASK]., a catfish or [...     [wolffish, mudcat, blennioid, pout, whitefish]
1    [a musket or [Z] is a [MASK]., a musket or [Z]...  [matchlock, fusil, blunderbuss, culverin, hagbut]
2    [a lemon or [Z] is a [MASK]., a lemon or [Z] i...       [gamboge, maize, yellow, citrus, yellowness]
3    [a turtle or [Z] is a [MASK]., a turtle or [Z]...    [turtleneck, sweater, cooter, jersey, redbelly]
4    [a bag or [Z] is a [MASK]., a bag or [Z] is a ...      [backpack, sandbag, sickbag, gunnysack, sack]
..                                                 ...                                                ...
930  [a wrench or [Z] is a [MASK]., a wrench or [Z]...              [harms, trauma, hurt, sprain, injury]
931  [a squirrel or [Z] is a [MASK]., a squirrel or...  [barunduki, chipmunks, pelt, spermophiles, gna...
932  [a cello or [Z] is a [MASK]., a cello or [Z] i...        [violoncello, string, viol, fiddle, violin]
933  [a glove or [Z] is a [MASK]., a glove or [Z] i...        [mitt, gauntlet, gantlet, mitten, handwear]
934  [a stereo or [Z] is a [MASK]., a stereo or [Z]...                                          [MISSING]

[921 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as catfish and [Z]., [MASK], incl...   [wolffish, mudcat, blennioids, pouts, whitefish]
1    [[MASK] such as muskets and [Z]., [MASK], incl...  [matchlock, fusils, blunderbuss, culverins, ha...
2    [[MASK] such as lemon and [Z]., [MASK], includ...   [gamboge, maize, yellow, citruses, yellownesses]
3    [[MASK] such as turtles and [Z]., [MASK], incl...  [turtlenecks, sweaters, cooters, jersey, redbe...
4    [[MASK] such as bags and [Z]., [MASK], includi...   [backpacks, sandbag, sickbags, gunnysacks, sack]
..                                                 ...                                                ...
930  [[MASK] such as wrenches and [Z]., [MASK], inc...           [harms, traumas, hurt, sprain, injuries]
931  [[MASK] such as squirrel and [Z]., [MASK], inc...  [barundukis, chipmunks, pelts, spermophiles, g...
932  [[MASK] such as cellos and [Z]., [MASK], inclu...     [violoncello, strings, viols, fiddle, violins]
933  [[MASK] such as glove and [Z]., [MASK], includ...      [mitt, gauntlets, gantlet, mitten, handwears]
934  [[MASK] such as stereos and [Z]., [MASK], incl...                                          [MISSING]

[921 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/921 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 35%|███▌      | 325/921 [01:00<01:50,  5.41it/s] 35%|███▌      | 325/921 [01:20<01:50,  5.41it/s] 72%|███████▏  | 661/921 [02:00<00:47,  5.51it/s] 72%|███████▏  | 661/921 [02:20<00:47,  5.51it/s]100%|██████████| 921/921 [02:46<00:00,  5.52it/s]
  0%|          | 0/921 [00:00<?, ?it/s] 18%|█▊        | 162/921 [01:00<04:41,  2.69it/s] 18%|█▊        | 162/921 [01:13<04:41,  2.69it/s] 36%|███▌      | 327/921 [02:00<03:38,  2.72it/s] 36%|███▌      | 327/921 [02:13<03:38,  2.72it/s] 54%|█████▍    | 498/921 [03:00<02:32,  2.77it/s] 54%|█████▍    | 498/921 [03:13<02:32,  2.77it/s] 72%|███████▏  | 665/921 [04:00<01:32,  2.77it/s] 72%|███████▏  | 665/921 [04:13<01:32,  2.77it/s] 91%|█████████ | 835/921 [05:01<00:30,  2.79it/s] 91%|█████████ | 835/921 [05:13<00:30,  2.79it/s]100%|██████████| 921/921 [05:32<00:00,  2.77it/s]
  sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
0   catfish     [fish]      IsA  [A catfish is a [MASK]., A catfish is an [MASK].]  [sandfish, wolffish, eel, greeneye, ghostfish,...     2             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish            1  [animal, fish, insect, eel, oyster, organism, ...  {'animal': -5.884246700948145, 'fish': -7.3868...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...   [wolffish, mudcat, blennioids, pouts, whitefish]     [wolffish, mudcat, blennioid, pout, whitefish]   [wolffish, mudcat, blennioids, pouts, whitefish]     [wolffish, mudcat, blennioid, pout, whitefish]   
1   muskets  [firearm]      IsA    [A musket is a [MASK]., A musket is an [MASK].]  [flintlock, hackbut, harquebus, firelock, arqu...     3             2       musket      muskets  [a musket is a [MASK]., a musket is a type of ...  [a musket or [Z] is a [MASK]., a musket or [Z]...  [[MASK] such as muskets., [MASK], including mu...  [[MASK] such as muskets and [Z]., [MASK], incl...  [such as muskets and [MASK]., such as muskets ...   muskets musket muskets            1  [artillery, firearm, gun, cannon, arrow, instr...  {'artillery': -6.829809756901031, 'firearm': -...  [firearm, cannon, gun, weapon, rifle, pistol, ...  {'firearm': -5.349813407088699, 'cannon': -7.0...  [weapon, firearm, gun, artillery, arm, impleme...  {'weapons': -6.112329372878857, 'firearms': -6...  [matchlock, fusils, blunderbuss, culverins, ha...  [matchlock, fusil, blunderbuss, culverin, hagbut]  [matchlock, fusils, blunderbuss, culverins, ha...  [matchlock, fusil, blunderbuss, culverin, hagbut]   
2     lemon  [produce]      IsA      [A lemon is a [MASK]., A lemon is an [MASK].]  [lemanderin, grapefruit, good, insert, button,...     4             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon            1  [apple, orange, object, adjective, olive, almo...  {'apple': -6.533058511601689, 'orange': -7.425...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...     [gamboge, maize, yellow, citruses, yellowness]       [gamboge, maize, yellow, citrus, yellowness]   [gamboge, maize, yellow, citruses, yellownesses]       [gamboge, maize, yellow, citrus, yellowness]   
3   turtles    [beast]      IsA    [A turtle is a [MASK]., A turtle is an [MASK].]         [turtleneck, pullover, slipover, cardigan]     6             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles            1  [animal, bird, fish, person, human, object, cr...  {'animal': -5.460504933765254, 'bird': -8.7831...  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....   [turtleneck, sweaters, cooter, jersey, redbelly]    [turtleneck, sweater, cooter, jersey, redbelly]  [turtlenecks, sweaters, cooters, jersey, redbe...    [turtleneck, sweater, cooter, jersey, redbelly]   
4      bags  [luggage]      IsA          [A bag is a [MASK]., A bag is an [MASK].]  [box, job, knocker, barrowful, measure, desser...     7             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags            1  [object, envelope, umbrella, item, accessory, ...  {'object': -7.057799467734983, 'envelope': -8....  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...    [backpacks, sandbag, sickbag, gunnysacks, sack]      [backpack, sandbag, sickbag, gunnysack, sack]   [backpacks, sandbag, sickbags, gunnysacks, sack]      [backpack, sandbag, sickbag, gunnysack, sack]   

     subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  catfish catfish catfish           5  [a catfish or a wolffish is a [MASK]., a catfi...  [[MASK] such as catfish and wolffish., [MASK] ...  [fish, predator, shrimp, species, mouth, shark...  {'fish': -4.605781195335295, 'predator': -13.2...  [fish, species, seafood, thing, animal, fisher...  {'fish': -5.187382514966632, 'fishes': -9.2042...  
1   muskets musket muskets           5  [a musket or a matchlock is a [MASK]., a muske...  [[MASK] such as muskets and matchlock., [MASK]...  [firearm, cannon, weapon, gun, pistol, rifle, ...  {'firearm': -5.609922925425875, 'cannon': -7.2...  [weapon, firearm, gun, artillery, arm, thing, ...  {'weapons': -5.755414357414009, 'firearms': -6...  
2        lemon lemon lemon           5  [a lemon or a gamboge is a [MASK]., a lemon or...  [[MASK] such as lemon and gamboge., [MASK] suc...  [fruit, drink, color, colour, wine, orange, fl...  {'fruit': -6.81126683305999, 'drink': -10.0206...  [fruit, color, colour, citrus, thing, grain, c...  {'fruits': -7.61857376836028, 'colors': -8.617...  
3   turtles turtle turtles           5  [a turtle or a turtleneck is a [MASK]., a turt...  [[MASK] such as turtles and turtlenecks., [MAS...  [bird, jacket, sweater, costume, garment, fish...  {'bird': -7.971312926847371, 'jacket': -8.0731...  [reptile, animal, bird, thing, clothing, islan...  {'reptiles': -7.775558133260551, 'animals': -8...  
4            bags bag bags           5  [a bag or a backpack is a [MASK]., a bag or a ...  [[MASK] such as bags and backpacks., [MASK] su...  [backpack, container, luggage, sack, suitcase,...  {'backpack': -7.20542344856778, 'container': -...  [thing, item, luggage, container, accessory, o...  {'things': -8.496447613995494, 'items': -8.894...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  35.4 	  67.9 	   67.9 	  46.8 
  1 	 subj_anchors_wordnet_all 	  35.4 	  67.9 	   67.9 	  46.8 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  16.3 	  32.4 	   42.1 	  23.5 	              1 
  2 	 lsp_sap     	  16.3 	  36.4 	   49.4 	  25.1 	              3 
  3 	 def_dap     	  16.9 	  33.1 	   41.8 	  24.1 	              2 
  4 	 lsp_dap     	  17.2 	  37.6 	   49.4 	  26.2 	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.BLESS.tsv
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.BLESS.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/BLESS/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'BLESS'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/BLESS//IsA.jsonl
#All Instances: 1337
#Valid Instances: 935 in BLESS (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                            subj_anchors_wordnet_sg
0    [a catfish or [Z] is a [MASK]., a catfish or [...       [wolffish, mudcat, blennioid, pout, sunfish]
1    [a musket or [Z] is a [MASK]., a musket or [Z]...  [culverin, fusil, blunderbuss, matchlock, arqu...
2    [a lemon or [Z] is a [MASK]., a lemon or [Z] i...       [gamboge, maize, yellow, citrus, yellowness]
3    [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [turtleneck, tortoise, cooter, redbelly, terra...
4    [a bag or [Z] is a [MASK]., a bag or [Z] is a ...        [sack, tuckerbag, bladder, pannier, ragbag]
..                                                 ...                                                ...
930  [a wrench or [Z] is a [MASK]., a wrench or [Z]...              [hurt, trauma, harms, sprain, injury]
931  [a squirrel or [Z] is a [MASK]., a squirrel or...        [rodent, fur, gopher, spermophiles, gnawer]
932  [a cello or [Z] is a [MASK]., a cello or [Z] i...  [violoncello, string, fiddle, contrabasses, viol]
933  [a glove or [Z] is a [MASK]., a glove or [Z] i...        [mitt, gauntlet, handwear, gantlet, mitten]
934  [a stereo or [Z] is a [MASK]., a stereo or [Z]...                                          [MISSING]

[921 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as catfish and [Z]., [MASK], incl...     [wolffish, mudcat, blennioids, pouts, sunfish]
1    [[MASK] such as muskets and [Z]., [MASK], incl...  [culverins, fusils, blunderbuss, matchlock, ar...
2    [[MASK] such as lemon and [Z]., [MASK], includ...   [gamboge, maize, yellow, citruses, yellownesses]
3    [[MASK] such as turtles and [Z]., [MASK], incl...  [turtlenecks, tortoises, cooters, redbelly, te...
4    [[MASK] such as bags and [Z]., [MASK], includi...      [sack, tuckerbags, bladders, pannier, ragbag]
..                                                 ...                                                ...
930  [[MASK] such as wrenches and [Z]., [MASK], inc...           [hurt, traumas, harms, sprain, injuries]
931  [[MASK] such as squirrel and [Z]., [MASK], inc...     [rodents, furs, gophers, spermophiles, gnawer]
932  [[MASK] such as cellos and [Z]., [MASK], inclu...  [violoncello, strings, fiddle, contrabasses, v...
933  [[MASK] such as glove and [Z]., [MASK], includ...      [mitt, gauntlets, handwears, gantlet, mitten]
934  [[MASK] such as stereos and [Z]., [MASK], incl...                                          [MISSING]

[921 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/921 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 36%|███▌      | 330/921 [01:00<01:47,  5.49it/s] 36%|███▌      | 330/921 [01:20<01:47,  5.49it/s] 73%|███████▎  | 670/921 [02:00<00:44,  5.59it/s] 73%|███████▎  | 670/921 [02:20<00:44,  5.59it/s]100%|██████████| 921/921 [02:44<00:00,  5.60it/s]
  0%|          | 0/921 [00:00<?, ?it/s] 18%|█▊        | 165/921 [01:00<04:36,  2.74it/s] 18%|█▊        | 165/921 [01:15<04:36,  2.74it/s] 36%|███▌      | 333/921 [02:00<03:32,  2.76it/s] 36%|███▌      | 333/921 [02:15<03:32,  2.76it/s] 55%|█████▌    | 507/921 [03:00<02:26,  2.82it/s] 55%|█████▌    | 507/921 [03:15<02:26,  2.82it/s] 73%|███████▎  | 675/921 [04:00<01:27,  2.81it/s] 73%|███████▎  | 675/921 [04:15<01:27,  2.81it/s] 92%|█████████▏| 846/921 [05:00<00:26,  2.83it/s] 92%|█████████▏| 846/921 [05:15<00:26,  2.83it/s]100%|██████████| 921/921 [05:27<00:00,  2.81it/s]
  sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap           sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
0   catfish     [fish]      IsA  [A catfish is a [MASK]., A catfish is an [MASK].]  [sandfish, wolffish, eel, greeneye, ghostfish,...     2             2      catfish      catfish  [a catfish is a [MASK]., a catfish is a type o...  [a catfish or [Z] is a [MASK]., a catfish or [...  [[MASK] such as catfish., [MASK], including ca...  [[MASK] such as catfish and [Z]., [MASK], incl...  [such as catfish and [MASK]., such as catfish ...  catfish catfish catfish            1  [animal, fish, insect, eel, oyster, organism, ...  {'animal': -5.884246700948145, 'fish': -7.3868...  [fish, shrimp, mollusk, swimmer, salmon, bird,...  {'fish': -4.442973047064299, 'shrimp': -12.345...  [fish, species, animal, seafood, reptile, inve...  {'fish': -4.942579534624883, 'species': -9.299...     [wolffish, mudcat, blennioids, pouts, sunfish]       [wolffish, mudcat, blennioid, pout, sunfish]     [wolffish, mudcat, blennioids, pouts, sunfish]       [wolffish, mudcat, blennioid, pout, sunfish]   
1   muskets  [firearm]      IsA    [A musket is a [MASK]., A musket is an [MASK].]  [flintlock, hackbut, harquebus, firelock, arqu...     3             2       musket      muskets  [a musket is a [MASK]., a musket is a type of ...  [a musket or [Z] is a [MASK]., a musket or [Z]...  [[MASK] such as muskets., [MASK], including mu...  [[MASK] such as muskets and [Z]., [MASK], incl...  [such as muskets and [MASK]., such as muskets ...   muskets musket muskets            1  [artillery, firearm, gun, cannon, arrow, instr...  {'artillery': -6.829809756901031, 'firearm': -...  [firearm, cannon, gun, weapon, rifle, pistol, ...  {'firearm': -5.349813407088699, 'cannon': -7.0...  [weapon, firearm, gun, artillery, arm, impleme...  {'weapons': -6.112329372878857, 'firearms': -6...  [culverins, fusils, blunderbuss, matchlock, ar...  [culverin, fusil, blunderbuss, matchlock, arqu...  [culverins, fusils, blunderbuss, matchlock, ar...  [culverin, fusil, blunderbuss, matchlock, arqu...   
2     lemon  [produce]      IsA      [A lemon is a [MASK]., A lemon is an [MASK].]  [lemanderin, grapefruit, good, insert, button,...     4             2        lemon        lemon  [a lemon is a [MASK]., a lemon is a type of [M...  [a lemon or [Z] is a [MASK]., a lemon or [Z] i...  [[MASK] such as lemon., [MASK], including lemo...  [[MASK] such as lemon and [Z]., [MASK], includ...  [such as lemon and [MASK]., such as lemon or [...        lemon lemon lemon            1  [apple, orange, object, adjective, olive, almo...  {'apple': -6.533058511601689, 'orange': -7.425...  [fruit, drink, lime, candy, apple, orange, ber...  {'fruit': -7.934486012665629, 'drink': -10.454...  [fruit, citrus, apple, thing, orange, lime, wa...  {'fruit': -7.175187479938773, 'fruits': -7.897...     [gamboge, maize, yellow, citruses, yellowness]       [gamboge, maize, yellow, citrus, yellowness]   [gamboge, maize, yellow, citruses, yellownesses]       [gamboge, maize, yellow, citrus, yellowness]   
3   turtles    [beast]      IsA    [A turtle is a [MASK]., A turtle is an [MASK].]         [turtleneck, pullover, slipover, cardigan]     6             2       turtle      turtles  [a turtle is a [MASK]., a turtle is a type of ...  [a turtle or [Z] is a [MASK]., a turtle or [Z]...  [[MASK] such as turtles., [MASK], including tu...  [[MASK] such as turtles and [Z]., [MASK], incl...  [such as turtles and [MASK]., such as turtles ...   turtles turtle turtles            1  [animal, bird, fish, person, human, object, cr...  {'animal': -5.460504933765254, 'bird': -8.7831...  [bird, animal, fish, mammal, creature, lizard,...  {'bird': -6.983079495727402, 'animal': -7.2181...  [reptile, animal, bird, creature, wildlife, in...  {'reptiles': -6.12624919356388, 'animals': -6....  [turtleneck, tortoise, cooter, redbelly, terra...  [turtleneck, tortoise, cooter, redbelly, terra...  [turtlenecks, tortoises, cooters, redbelly, te...  [turtleneck, tortoise, cooter, redbelly, terra...   
4      bags  [luggage]      IsA          [A bag is a [MASK]., A bag is an [MASK].]  [box, job, knocker, barrowful, measure, desser...     7             2          bag         bags  [a bag is a [MASK]., a bag is a type of [MASK]...  [a bag or [Z] is a [MASK]., a bag or [Z] is a ...  [[MASK] such as bags., [MASK], including bags....  [[MASK] such as bags and [Z]., [MASK], includi...  [such as bags and [MASK]., such as bags or [MA...            bags bag bags            1  [object, envelope, umbrella, item, accessory, ...  {'object': -7.057799467734983, 'envelope': -8....  [container, luggage, backpack, suitcase, sack,...  {'container': -8.861242617076943, 'luggage': -...  [thing, item, object, luggage, belongings, acc...  {'things': -7.206912668513597, 'items': -8.137...      [sack, tuckerbags, bladders, pannier, ragbag]        [sack, tuckerbag, bladder, pannier, ragbag]      [sack, tuckerbags, bladders, pannier, ragbag]        [sack, tuckerbag, bladder, pannier, ragbag]   

     subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  catfish catfish catfish           5  [a catfish or a wolffish is a [MASK]., a catfi...  [[MASK] such as catfish and wolffish., [MASK] ...  [fish, shrimp, predator, shark, species, mouth...  {'fish': -4.605540385468112, 'shrimp': -13.155...  [fish, species, seafood, animal, thing, fisher...  {'fish': -5.188235938800091, 'fishes': -9.1974...  
1   muskets musket muskets           5  [a musket or a culverin is a [MASK]., a musket...  [[MASK] such as muskets and culverins., [MASK]...  [firearm, cannon, weapon, gun, pistol, rifle, ...  {'firearm': -5.5695662609690695, 'cannon': -7....  [weapon, firearm, gun, artillery, arm, thing, ...  {'weapons': -5.828232415295086, 'firearms': -6...  
2        lemon lemon lemon           5  [a lemon or a gamboge is a [MASK]., a lemon or...  [[MASK] such as lemon and gamboge., [MASK] suc...  [fruit, drink, color, colour, wine, orange, fl...  {'fruit': -6.81126683305999, 'drink': -10.0206...  [fruit, color, colour, citrus, thing, grain, c...  {'fruits': -7.61857376836028, 'colors': -8.617...  
3   turtles turtle turtles           5  [a turtle or a turtleneck is a [MASK]., a turt...  [[MASK] such as turtles and turtlenecks., [MAS...  [bird, jacket, fish, animal, garment, costume,...  {'bird': -7.4397187152523285, 'jacket': -7.890...  [reptile, animal, bird, wildlife, snake, creat...  {'reptiles': -6.783160810591714, 'animals': -7...  
4            bags bag bags           5  [a bag or a sack is a [MASK]., a bag or a tuck...  [[MASK] such as bags and sack., [MASK] such as...  [container, sack, bladder, backpack, luggage, ...  {'container': -7.888473854949007, 'sack': -7.9...  [thing, item, luggage, accessory, object, cont...  {'things': -8.143703405918831, 'items': -8.541...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  36.6 	  68.5 	   68.5 	  47.8 
  1 	 subj_anchors_wordnet_all 	  36.6 	  68.5 	   68.5 	  47.8 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  16.3 	  32.4 	   42.1 	  23.5 	              1 
  2 	 lsp_sap     	  16.3 	  36.4 	   49.4 	  25.1 	              3 
  3 	 def_dap     	  16.8 	  33.7 	   42.1 	  24.2 	              2 
  4 	 lsp_dap     	  17.2 	  38.2 	   49.8 	  26.1 	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.BLESS.tsv
save log/bert-large-uncased/hypernymsuite/BLESS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.BLESS.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/lm_diagnostic_extended/singular/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'DIAG'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/lm_diagnostic_extended/singular//IsA.jsonl
#All Instances: 576
#Valid Instances: 576 in DIAG (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                            subj_anchors_wordnet_sg
0    [a graver or [Z] is a [MASK]., a graver or [Z]...  [pointel, pointrel, scorper, scauper, screwdri...
1    [a smallmouth or [Z] is a [MASK]., a smallmout...  [largemouth, crappie, pumpkinseed, bluegill, s...
2    [a pelican or [Z] is a [MASK]., a pelican or [...  [anhinga, tropicbird, cormorant, gannet, snake...
3    [a sapsucker or [Z] is a [MASK]., a sapsucker ...  [peckers, woodpecker, peckerwood, wryneck, ivo...
4    [a mako or [Z] is a [MASK]., a mako or [Z] is ...  [porbeagle, dogfish, thresher, soupfin, shovel...
..                                                 ...                                                ...
571  [a biplane or [Z] is a [MASK]., a biplane or [...                                          [MISSING]
572  [a baobab or [Z] is a [MASK]., a baobab or [Z]...  [trumpetwood, terebinth, dogwoods, titi, bocco...
573  [an aircraft or [Z] is a [MASK]., an aircraft ...                                          [MISSING]
574  [a gean or [Z] is a [MASK]., a gean or [Z] is ...  [mazzard, oxheart, capulin, chokecherry, morello]
575  [a luge or [Z] is a [MASK]., a luge or [Z] is ...          [sled, sledge, sleighs, bobsled, dogsled]

[574 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as graver and [Z]., [MASK], inclu...  [pointels, pointrels, scorpers, scaupers, scre...
1    [[MASK] such as smallmouths and [Z]., [MASK], ...  [largemouths, crappie, pumpkinseeds, bluegills...
2    [[MASK] such as pelican and [Z]., [MASK], incl...  [anhingas, tropicbirds, cormorants, gannets, s...
3    [[MASK] such as sapsuckers and [Z]., [MASK], i...  [peckers, woodpeckers, peckerwoods, wrynecks, ...
4    [[MASK] such as mako and [Z]., [MASK], includi...  [porbeagle, dogfish, thresher, soupfins, shove...
..                                                 ...                                                ...
571  [[MASK] such as biplanes and [Z]., [MASK], inc...                                          [MISSING]
572  [[MASK] such as baobab and [Z]., [MASK], inclu...  [trumpetwoods, terebinth, dogwoods, titi, bocc...
573  [[MASK] such as aircrafts and [Z]., [MASK], in...                                          [MISSING]
574  [[MASK] such as gean and [Z]., [MASK], includi...  [mazzards, oxheart, capulins, chokecherry, mor...
575  [[MASK] such as luges and [Z]., [MASK], includ...         [sled, sledges, sleighs, bobsled, dogsled]

[574 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/574 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 60%|██████    | 345/574 [01:00<00:39,  5.74it/s] 60%|██████    | 345/574 [01:20<00:39,  5.74it/s]100%|██████████| 574/574 [01:36<00:00,  5.92it/s]
  0%|          | 0/574 [00:00<?, ?it/s] 30%|██▉       | 171/574 [01:00<02:21,  2.84it/s] 30%|██▉       | 171/574 [01:13<02:21,  2.84it/s] 60%|██████    | 346/574 [02:00<01:19,  2.88it/s] 60%|██████    | 346/574 [02:13<01:19,  2.88it/s] 93%|█████████▎| 532/574 [03:00<00:14,  2.98it/s] 93%|█████████▎| 532/574 [03:13<00:14,  2.98it/s]100%|██████████| 574/574 [03:13<00:00,  2.97it/s]
              masked_sentences obj_label    sub_label sub_label_pl relation                                         sub_sister  uuid  sub_position sub_label_sg                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                      sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
0      [A graver is a [MASK].]    [tool]       graver       graver      IsA  [bevel, dibber, spreader, hammer, crank, float...     1             2       graver  [a graver is a [MASK]., a graver is a type of ...  [a graver or [Z] is a [MASK]., a graver or [Z]...  [[MASK] such as graver., [MASK], including gra...  [[MASK] such as graver and [Z]., [MASK], inclu...  [such as graver and [MASK]., such as graver or...                graver graver graver            1  [digger, shovel, tool, grave, coffin, person, ...  {'digger': -8.93893395450476, 'shovel': -8.996...  [shovel, tool, coffin, digger, grave, oven, to...  {'shovel': -7.8714093588212215, 'tool': -8.745...  [tool, story, poems, thing, book, works, digge...  {'tool': -8.670671149942246, 'stories': -9.270...  [pointels, pointrel, scorpers, scaupers, screw...  [pointel, pointrel, scorper, scauper, screwdri...  [pointels, pointrels, scorpers, scaupers, scre...  [pointel, pointrel, scorper, scauper, screwdri...   
1  [A smallmouth is a [MASK].]    [fish]  smallmouths  smallmouths      IsA                                       [largemouth]     2             2   smallmouth  [a smallmouth is a [MASK]., a smallmouth is a ...  [a smallmouth or [Z] is a [MASK]., a smallmout...  [[MASK] such as smallmouths., [MASK], includin...  [[MASK] such as smallmouths and [Z]., [MASK], ...  [such as smallmouths and [MASK]., such as smal...  smallmouths smallmouth smallmouths            1  [fish, catfish, salmon, shark, trout, swimmer,...  {'fish': -4.648060742066287, 'catfish': -6.835...  [fish, catfish, shark, swimmer, salmon, carp, ...  {'fish': -4.852696385096972, 'catfish': -6.629...  [fish, catfish, species, reptile, thing, preda...  {'fish': -6.019906277942945, 'catfish': -7.293...  [largemouths, crappie, pumpkinseed, bluegills,...  [largemouth, crappie, pumpkinseed, bluegill, s...  [largemouths, crappie, pumpkinseeds, bluegills...  [largemouth, crappie, pumpkinseed, bluegill, s...   
2     [A pelican is a [MASK].]    [bird]      pelican      pelican      IsA  [cormorant, snakebird, tropicbird, darter, anh...     3             2      pelican  [a pelican is a [MASK]., a pelican is a type o...  [a pelican or [Z] is a [MASK]., a pelican or [...  [[MASK] such as pelican., [MASK], including pe...  [[MASK] such as pelican and [Z]., [MASK], incl...  [such as pelican and [MASK]., such as pelican ...             pelican pelican pelican            1  [bird, parrot, penguin, dolphin, fish, dog, pi...  {'bird': -5.553109751033401, 'parrot': -7.7402...  [bird, parrot, dolphin, fish, dog, turtle, ani...  {'bird': -5.434608383702077, 'parrot': -8.5271...  [story, fish, dolphin, animal, bird, ship, poe...  {'stories': -8.638846115876778, 'fish': -8.785...  [anhinga, tropicbirds, cormorants, gannets, sn...  [anhinga, tropicbird, cormorant, gannet, snake...  [anhingas, tropicbirds, cormorants, gannets, s...  [anhinga, tropicbird, cormorant, gannet, snake...   
3   [A sapsucker is a [MASK].]    [bird]   sapsuckers   sapsuckers      IsA    [wryneck, redhead, piculet, ivorybill, flicker]     4             2    sapsucker  [a sapsucker is a [MASK]., a sapsucker is a ty...  [a sapsucker or [Z] is a [MASK]., a sapsucker ...  [[MASK] such as sapsuckers., [MASK], including...  [[MASK] such as sapsuckers and [Z]., [MASK], i...  [such as sapsuckers and [MASK]., such as sapsu...     sapsuckers sapsucker sapsuckers            1  [snake, worm, spider, bug, lizard, predator, t...  {'snake': -7.64518889675958, 'worm': -8.365534...  [insect, snake, spider, lizard, animal, worm, ...  {'insect': -7.6130040846174385, 'snake': -8.26...  [snake, reptile, animal, insect, predator, cre...  {'snakes': -6.653929158976036, 'reptiles': -7....  [peckers, woodpeckers, peckerwoods, wrynecks, ...  [peckers, woodpecker, peckerwood, wryneck, ivo...  [peckers, woodpeckers, peckerwoods, wrynecks, ...  [peckers, woodpecker, peckerwood, wryneck, ivo...   
4        [A mako is a [MASK].]    [fish]         mako         mako      IsA                                        [porbeagle]     5             2         mako  [a mako is a [MASK]., a mako is a type of [MAS...  [a mako or [Z] is a [MASK]., a mako or [Z] is ...  [[MASK] such as mako., [MASK], including mako....  [[MASK] such as mako and [Z]., [MASK], includi...  [such as mako and [MASK]., such as mako or [MA...                      mako mako mako            1  [fish, canoe, drum, dog, boat, drummer, bird, ...  {'fish': -9.140592458399126, 'canoe': -9.49322...  [drum, fish, boat, canoe, bird, umbrella, flut...  {'drum': -8.934197447070298, 'fish': -9.539210...  [story, poems, fish, yes, artist, thing, peopl...  {'stories': -7.7291837518064845, 'poems': -9.2...  [porbeagle, dogfish, thresher, soupfins, shove...  [porbeagle, dogfish, thresher, soupfin, shovel...  [porbeagle, dogfish, thresher, soupfins, shove...  [porbeagle, dogfish, thresher, soupfin, shovel...   

                subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0                graver graver graver           5  [a graver or a pointel is a [MASK]., a graver ...  [[MASK] such as graver and pointels., [MASK] s...  [tool, knife, hammer, shovel, digger, marker, ...  {'tool': -7.729654807014176, 'knife': -8.52671...  [tool, thing, instrument, implement, dog, hamm...  {'tools': -8.084081038683347, 'things': -10.89...  
1  smallmouths smallmouth smallmouths           5  [a smallmouth or a largemouth is a [MASK]., a ...  [[MASK] such as smallmouths and largemouths., ...  [fish, catfish, shark, salmon, bass, turtle, t...  {'fish': -5.09653802407856, 'catfish': -6.6257...  [fish, catfish, species, snake, reptile, carp,...  {'fish': -6.017343194756843, 'catfish': -7.720...  
2             pelican pelican pelican           5  [a pelican or an anhinga is a [MASK]., a pelic...  [[MASK] such as pelican and anhingas., [MASK] ...  [bird, parrot, dolphin, fish, penguin, turtle,...  {'bird': -4.7386807455398925, 'parrot': -8.939...  [bird, species, animal, fish, dolphin, duck, m...  {'birds': -5.598045896602234, 'species': -8.62...  
3     sapsuckers sapsucker sapsuckers           5  [a sapsucker or a peckers is a [MASK]., a saps...  [[MASK] such as sapsuckers and peckers., [MASK...  [tree, bird, snake, lizard, insect, fish, spid...  {'tree': -7.010057755041778, 'bird': -8.398667...  [bird, snake, insect, reptile, animal, predato...  {'birds': -7.963052312293091, 'snakes': -8.347...  
4                      mako mako mako           5  [a mako or a porbeagle is a [MASK]., a mako or...  [[MASK] such as mako and porbeagle., [MASK] su...  [fish, soup, machine, drum, canoe, tool, imple...  {'fish': -8.169779720600754, 'soup': -8.547062...  [fish, animal, bird, species, thing, instrumen...  {'fish': -7.350701446569807, 'animals': -10.04...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  34.3 	  81.4 	   81.4 	  53.8 
  1 	 subj_anchors_wordnet_all 	  34.3 	  81.4 	   81.4 	  53.8 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  32.6 	  56.6 	   66.7 	  42.6 	              1 
  2 	 lsp_sap     	  30.7 	  51   	   59.8 	  38.9 	              3 
  3 	 def_dap     	  56.4 	  78.9 	   84.7 	  65.8 	              2 
  4 	 lsp_dap     	  56.4 	  77.5 	   84.5 	  65.8 	              4 
hline
end{tabular}
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.DIAG.tsv
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.DIAG.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/lm_diagnostic_extended/singular/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'DIAG'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/lm_diagnostic_extended/singular//IsA.jsonl
#All Instances: 576
#Valid Instances: 576 in DIAG (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                            subj_anchors_wordnet_sg
0    [a graver or [Z] is a [MASK]., a graver or [Z]...    [pointel, pointrel, scorper, scauper, threader]
1    [a smallmouth or [Z] is a [MASK]., a smallmout...  [largemouth, crappie, pumpkinseed, bluegill, s...
2    [a pelican or [Z] is a [MASK]., a pelican or [...  [tropicbird, anhinga, darter, snakebird, cormo...
3    [a sapsucker or [Z] is a [MASK]., a sapsucker ...  [peckerwood, woodpecker, peckers, wryneck, pic...
4    [a mako or [Z] is a [MASK]., a mako or [Z] is ...  [porbeagle, dogfish, thresher, bonnetheads, so...
..                                                 ...                                                ...
571  [a biplane or [Z] is a [MASK]., a biplane or [...                                          [MISSING]
572  [a baobab or [Z] is a [MASK]., a baobab or [Z]...  [sterculia, dogwoods, cornel, balsas, trumpetw...
573  [an aircraft or [Z] is a [MASK]., an aircraft ...                                          [MISSING]
574  [a gean or [Z] is a [MASK]., a gean or [Z] is ...     [mazzard, oxheart, capulin, chokecherry, fuji]
575  [a luge or [Z] is a [MASK]., a luge or [Z] is ...       [sledge, sled, sleighs, toboggan, bobsleigh]

[574 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as graver and [Z]., [MASK], inclu...  [pointels, pointrels, scorpers, scaupers, thre...
1    [[MASK] such as smallmouths and [Z]., [MASK], ...  [largemouths, crappie, pumpkinseeds, bluegills...
2    [[MASK] such as pelican and [Z]., [MASK], incl...  [tropicbirds, anhingas, darters, snakebirds, c...
3    [[MASK] such as sapsuckers and [Z]., [MASK], i...  [peckerwoods, woodpeckers, peckers, wrynecks, ...
4    [[MASK] such as mako and [Z]., [MASK], includi...  [porbeagle, dogfish, thresher, bonnetheads, so...
..                                                 ...                                                ...
571  [[MASK] such as biplanes and [Z]., [MASK], inc...                                          [MISSING]
572  [[MASK] such as baobab and [Z]., [MASK], inclu...  [sterculias, dogwoods, cornels, balsas, trumpe...
573  [[MASK] such as aircrafts and [Z]., [MASK], in...                                          [MISSING]
574  [[MASK] such as gean and [Z]., [MASK], includi...   [mazzards, oxheart, capulins, chokecherry, fuji]
575  [[MASK] such as luges and [Z]., [MASK], includ...     [sledges, sled, sleighs, toboggans, bobsleigh]

[574 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/574 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 49%|████▉     | 280/574 [01:00<01:03,  4.65it/s] 49%|████▉     | 280/574 [01:20<01:03,  4.65it/s]100%|██████████| 574/574 [01:58<00:00,  4.84it/s]
  0%|          | 0/574 [00:00<?, ?it/s] 25%|██▍       | 141/574 [01:00<03:05,  2.34it/s] 25%|██▍       | 141/574 [01:11<03:05,  2.34it/s] 49%|████▉     | 282/574 [02:00<02:04,  2.34it/s] 49%|████▉     | 282/574 [02:11<02:04,  2.34it/s] 75%|███████▍  | 430/574 [03:00<01:00,  2.39it/s] 75%|███████▍  | 430/574 [03:11<01:00,  2.39it/s]100%|██████████| 574/574 [03:56<00:00,  2.43it/s]
              masked_sentences obj_label    sub_label sub_label_pl relation                                         sub_sister  uuid  sub_position sub_label_sg                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                      sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
0      [A graver is a [MASK].]    [tool]       graver       graver      IsA  [bevel, dibber, spreader, hammer, crank, float...     1             2       graver  [a graver is a [MASK]., a graver is a type of ...  [a graver or [Z] is a [MASK]., a graver or [Z]...  [[MASK] such as graver., [MASK], including gra...  [[MASK] such as graver and [Z]., [MASK], inclu...  [such as graver and [MASK]., such as graver or...                graver graver graver            1  [digger, shovel, tool, grave, coffin, person, ...  {'digger': -8.93893395450476, 'shovel': -8.996...  [shovel, tool, coffin, digger, grave, oven, to...  {'shovel': -7.8714093588212215, 'tool': -8.745...  [tool, story, poems, thing, book, works, digge...  {'tool': -8.670671149942246, 'stories': -9.270...  [pointels, pointrel, scorpers, scaupers, threa...    [pointel, pointrel, scorper, scauper, threader]  [pointels, pointrels, scorpers, scaupers, thre...    [pointel, pointrel, scorper, scauper, threader]   
1  [A smallmouth is a [MASK].]    [fish]  smallmouths  smallmouths      IsA                                       [largemouth]     2             2   smallmouth  [a smallmouth is a [MASK]., a smallmouth is a ...  [a smallmouth or [Z] is a [MASK]., a smallmout...  [[MASK] such as smallmouths., [MASK], includin...  [[MASK] such as smallmouths and [Z]., [MASK], ...  [such as smallmouths and [MASK]., such as smal...  smallmouths smallmouth smallmouths            1  [fish, catfish, salmon, shark, trout, swimmer,...  {'fish': -4.648060742066287, 'catfish': -6.835...  [fish, catfish, shark, swimmer, salmon, carp, ...  {'fish': -4.852696385096972, 'catfish': -6.629...  [fish, catfish, species, reptile, thing, preda...  {'fish': -6.019906277942945, 'catfish': -7.293...  [largemouths, crappie, pumpkinseed, bluegills,...  [largemouth, crappie, pumpkinseed, bluegill, s...  [largemouths, crappie, pumpkinseeds, bluegills...  [largemouth, crappie, pumpkinseed, bluegill, s...   
2     [A pelican is a [MASK].]    [bird]      pelican      pelican      IsA  [cormorant, snakebird, tropicbird, darter, anh...     3             2      pelican  [a pelican is a [MASK]., a pelican is a type o...  [a pelican or [Z] is a [MASK]., a pelican or [...  [[MASK] such as pelican., [MASK], including pe...  [[MASK] such as pelican and [Z]., [MASK], incl...  [such as pelican and [MASK]., such as pelican ...             pelican pelican pelican            1  [bird, parrot, penguin, dolphin, fish, dog, pi...  {'bird': -5.553109751033401, 'parrot': -7.7402...  [bird, parrot, dolphin, fish, dog, turtle, ani...  {'bird': -5.434608383702077, 'parrot': -8.5271...  [story, fish, dolphin, animal, bird, ship, poe...  {'stories': -8.638846115876778, 'fish': -8.785...  [tropicbirds, anhinga, darters, snakebird, cor...  [tropicbird, anhinga, darter, snakebird, cormo...  [tropicbirds, anhingas, darters, snakebirds, c...  [tropicbird, anhinga, darter, snakebird, cormo...   
3   [A sapsucker is a [MASK].]    [bird]   sapsuckers   sapsuckers      IsA    [wryneck, redhead, piculet, ivorybill, flicker]     4             2    sapsucker  [a sapsucker is a [MASK]., a sapsucker is a ty...  [a sapsucker or [Z] is a [MASK]., a sapsucker ...  [[MASK] such as sapsuckers., [MASK], including...  [[MASK] such as sapsuckers and [Z]., [MASK], i...  [such as sapsuckers and [MASK]., such as sapsu...     sapsuckers sapsucker sapsuckers            1  [snake, worm, spider, bug, lizard, predator, t...  {'snake': -7.64518889675958, 'worm': -8.365534...  [insect, snake, spider, lizard, animal, worm, ...  {'insect': -7.6130040846174385, 'snake': -8.26...  [snake, reptile, animal, insect, predator, cre...  {'snakes': -6.653929158976036, 'reptiles': -7....  [peckerwoods, woodpeckers, peckers, wrynecks, ...  [peckerwood, woodpecker, peckers, wryneck, pic...  [peckerwoods, woodpeckers, peckers, wrynecks, ...  [peckerwood, woodpecker, peckers, wryneck, pic...   
4        [A mako is a [MASK].]    [fish]         mako         mako      IsA                                        [porbeagle]     5             2         mako  [a mako is a [MASK]., a mako is a type of [MAS...  [a mako or [Z] is a [MASK]., a mako or [Z] is ...  [[MASK] such as mako., [MASK], including mako....  [[MASK] such as mako and [Z]., [MASK], includi...  [such as mako and [MASK]., such as mako or [MA...                      mako mako mako            1  [fish, canoe, drum, dog, boat, drummer, bird, ...  {'fish': -9.140592458399126, 'canoe': -9.49322...  [drum, fish, boat, canoe, bird, umbrella, flut...  {'drum': -8.934197447070298, 'fish': -9.539210...  [story, poems, fish, yes, artist, thing, peopl...  {'stories': -7.7291837518064845, 'poems': -9.2...  [porbeagle, dogfish, thresher, bonnetheads, so...  [porbeagle, dogfish, thresher, bonnetheads, so...  [porbeagle, dogfish, thresher, bonnetheads, so...  [porbeagle, dogfish, thresher, bonnetheads, so...   

                subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0                graver graver graver           5  [a graver or a pointel is a [MASK]., a graver ...  [[MASK] such as graver and pointels., [MASK] s...  [tool, knife, shovel, hammer, digger, nail, mo...  {'tool': -8.061954233871656, 'knife': -8.52111...  [tool, thing, instrument, implement, type, ite...  {'tools': -8.219945549846395, 'things': -10.40...  
1  smallmouths smallmouth smallmouths           5  [a smallmouth or a largemouth is a [MASK]., a ...  [[MASK] such as smallmouths and largemouths., ...  [fish, catfish, shark, salmon, bass, turtle, t...  {'fish': -5.09653802407856, 'catfish': -6.6257...  [fish, catfish, species, snake, reptile, carp,...  {'fish': -6.017343194756843, 'catfish': -7.720...  
2             pelican pelican pelican           5  [a pelican or a tropicbird is a [MASK]., a pel...  [[MASK] such as pelican and tropicbirds., [MAS...  [bird, parrot, dolphin, fish, turtle, boat, pe...  {'bird': -5.045558414547793, 'parrot': -8.7977...  [bird, species, fish, animal, dolphin, reptile...  {'birds': -5.8600775194938794, 'species': -8.8...  
3     sapsuckers sapsucker sapsuckers           5  [a sapsucker or a peckerwood is a [MASK]., a s...  [[MASK] such as sapsuckers and peckerwoods., [...  [tree, bird, snake, spider, insect, shotgun, l...  {'tree': -7.010057755041778, 'bird': -9.040551...  [snake, insect, bird, animal, reptile, predato...  {'snakes': -8.321892379798104, 'insects': -8.3...  
4                      mako mako mako           5  [a mako or a porbeagle is a [MASK]., a mako or...  [[MASK] such as mako and porbeagle., [MASK] su...  [fish, soup, machine, drum, canoe, boat, vesse...  {'fish': -8.264687702136847, 'soup': -8.547062...  [fish, instrument, animal, bird, thing, specie...  {'fish': -7.87970727151397, 'instruments': -10...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  34.9 	  81.2 	   81.2 	    54 
  1 	 subj_anchors_wordnet_all 	  34.9 	  81.2 	   81.2 	    54 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  32.6 	  56.6 	   66.7 	  42.6 	              1 
  2 	 lsp_sap     	  30.7 	  51   	   59.8 	  38.9 	              3 
  3 	 def_dap     	  55.7 	  78.9 	   85   	  65.6 	              2 
  4 	 lsp_dap     	  55.1 	  77.2 	   86.1 	  64.9 	              4 
hline
end{tabular}
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.DIAG.tsv
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.DIAG.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/lm_diagnostic_extended/singular/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'DIAG'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/lm_diagnostic_extended/singular//IsA.jsonl
#All Instances: 576
#Valid Instances: 576 in DIAG (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                            subj_anchors_wordnet_sg
0    [a graver or [Z] is a [MASK]., a graver or [Z]...   [pointel, pointrel, scauper, scorper, pitchfork]
1    [a smallmouth or [Z] is a [MASK]., a smallmout...  [largemouth, crappie, pumpkinseed, stumpknocke...
2    [a pelican or [Z] is a [MASK]., a pelican or [...  [darter, cormorant, snakebird, gannet, tropicb...
3    [a sapsucker or [Z] is a [MASK]., a sapsucker ...  [peckers, peckerwood, woodpecker, ivorybills, ...
4    [a mako or [Z] is a [MASK]., a mako or [Z] is ...  [porbeagle, thresher, dogfish, shovelhead, sou...
..                                                 ...                                                ...
571  [a biplane or [Z] is a [MASK]., a biplane or [...                                          [MISSING]
572  [a baobab or [Z] is a [MASK]., a baobab or [Z]...        [magnolia, mangrove, titi, holly, dogwoods]
573  [an aircraft or [Z] is a [MASK]., an aircraft ...                                          [MISSING]
574  [a gean or [Z] is a [MASK]., a gean or [Z] is ...  [mazzard, oxheart, chokecherry, capulin, morello]
575  [a luge or [Z] is a [MASK]., a luge or [Z] is ...        [sledge, sleighs, sled, dogsled, bobsleigh]

[574 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as graver and [Z]., [MASK], inclu...  [pointels, pointrels, scaupers, scorpers, pitc...
1    [[MASK] such as smallmouths and [Z]., [MASK], ...  [largemouths, crappie, pumpkinseeds, stumpknoc...
2    [[MASK] such as pelican and [Z]., [MASK], incl...  [darters, cormorants, snakebirds, gannets, tro...
3    [[MASK] such as sapsuckers and [Z]., [MASK], i...  [peckers, peckerwoods, woodpeckers, ivorybills...
4    [[MASK] such as mako and [Z]., [MASK], includi...  [porbeagle, thresher, dogfish, shovelheads, so...
..                                                 ...                                                ...
571  [[MASK] such as biplanes and [Z]., [MASK], inc...                                          [MISSING]
572  [[MASK] such as baobab and [Z]., [MASK], inclu...        [magnolia, mangrove, titi, holly, dogwoods]
573  [[MASK] such as aircrafts and [Z]., [MASK], in...                                          [MISSING]
574  [[MASK] such as gean and [Z]., [MASK], includi...  [mazzards, oxheart, chokecherry, capulins, mor...
575  [[MASK] such as luges and [Z]., [MASK], includ...       [sledges, sleighs, sled, dogsled, bobsleigh]

[574 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/574 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 49%|████▉     | 280/574 [01:00<01:03,  4.66it/s] 49%|████▉     | 280/574 [01:20<01:03,  4.66it/s]100%|██████████| 574/574 [01:58<00:00,  4.86it/s]
  0%|          | 0/574 [00:00<?, ?it/s] 25%|██▍       | 141/574 [01:00<03:04,  2.35it/s] 25%|██▍       | 141/574 [01:11<03:04,  2.35it/s] 49%|████▉     | 283/574 [02:00<02:03,  2.35it/s] 49%|████▉     | 283/574 [02:11<02:03,  2.35it/s] 75%|███████▌  | 431/574 [03:00<00:59,  2.40it/s] 75%|███████▌  | 431/574 [03:11<00:59,  2.40it/s]100%|██████████| 574/574 [03:55<00:00,  2.44it/s]
              masked_sentences obj_label    sub_label sub_label_pl relation                                         sub_sister  uuid  sub_position sub_label_sg                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                      sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
0      [A graver is a [MASK].]    [tool]       graver       graver      IsA  [bevel, dibber, spreader, hammer, crank, float...     1             2       graver  [a graver is a [MASK]., a graver is a type of ...  [a graver or [Z] is a [MASK]., a graver or [Z]...  [[MASK] such as graver., [MASK], including gra...  [[MASK] such as graver and [Z]., [MASK], inclu...  [such as graver and [MASK]., such as graver or...                graver graver graver            1  [digger, shovel, tool, grave, coffin, person, ...  {'digger': -8.93893395450476, 'shovel': -8.996...  [shovel, tool, coffin, digger, grave, oven, to...  {'shovel': -7.8714093588212215, 'tool': -8.745...  [tool, story, poems, thing, book, works, digge...  {'tool': -8.670671149942246, 'stories': -9.270...  [pointels, pointrel, scaupers, scorpers, pitch...   [pointel, pointrel, scauper, scorper, pitchfork]  [pointels, pointrels, scaupers, scorpers, pitc...   [pointel, pointrel, scauper, scorper, pitchfork]   
1  [A smallmouth is a [MASK].]    [fish]  smallmouths  smallmouths      IsA                                       [largemouth]     2             2   smallmouth  [a smallmouth is a [MASK]., a smallmouth is a ...  [a smallmouth or [Z] is a [MASK]., a smallmout...  [[MASK] such as smallmouths., [MASK], includin...  [[MASK] such as smallmouths and [Z]., [MASK], ...  [such as smallmouths and [MASK]., such as smal...  smallmouths smallmouth smallmouths            1  [fish, catfish, salmon, shark, trout, swimmer,...  {'fish': -4.648060742066287, 'catfish': -6.835...  [fish, catfish, shark, swimmer, salmon, carp, ...  {'fish': -4.852696385096972, 'catfish': -6.629...  [fish, catfish, species, reptile, thing, preda...  {'fish': -6.019906277942945, 'catfish': -7.293...  [largemouths, crappie, pumpkinseed, stumpknock...  [largemouth, crappie, pumpkinseed, stumpknocke...  [largemouths, crappie, pumpkinseeds, stumpknoc...  [largemouth, crappie, pumpkinseed, stumpknocke...   
2     [A pelican is a [MASK].]    [bird]      pelican      pelican      IsA  [cormorant, snakebird, tropicbird, darter, anh...     3             2      pelican  [a pelican is a [MASK]., a pelican is a type o...  [a pelican or [Z] is a [MASK]., a pelican or [...  [[MASK] such as pelican., [MASK], including pe...  [[MASK] such as pelican and [Z]., [MASK], incl...  [such as pelican and [MASK]., such as pelican ...             pelican pelican pelican            1  [bird, parrot, penguin, dolphin, fish, dog, pi...  {'bird': -5.553109751033401, 'parrot': -7.7402...  [bird, parrot, dolphin, fish, dog, turtle, ani...  {'bird': -5.434608383702077, 'parrot': -8.5271...  [story, fish, dolphin, animal, bird, ship, poe...  {'stories': -8.638846115876778, 'fish': -8.785...  [darters, cormorants, snakebird, gannets, trop...  [darter, cormorant, snakebird, gannet, tropicb...  [darters, cormorants, snakebirds, gannets, tro...  [darter, cormorant, snakebird, gannet, tropicb...   
3   [A sapsucker is a [MASK].]    [bird]   sapsuckers   sapsuckers      IsA    [wryneck, redhead, piculet, ivorybill, flicker]     4             2    sapsucker  [a sapsucker is a [MASK]., a sapsucker is a ty...  [a sapsucker or [Z] is a [MASK]., a sapsucker ...  [[MASK] such as sapsuckers., [MASK], including...  [[MASK] such as sapsuckers and [Z]., [MASK], i...  [such as sapsuckers and [MASK]., such as sapsu...     sapsuckers sapsucker sapsuckers            1  [snake, worm, spider, bug, lizard, predator, t...  {'snake': -7.64518889675958, 'worm': -8.365534...  [insect, snake, spider, lizard, animal, worm, ...  {'insect': -7.6130040846174385, 'snake': -8.26...  [snake, reptile, animal, insect, predator, cre...  {'snakes': -6.653929158976036, 'reptiles': -7....  [peckers, peckerwoods, woodpeckers, ivorybills...  [peckers, peckerwood, woodpecker, ivorybills, ...  [peckers, peckerwoods, woodpeckers, ivorybills...  [peckers, peckerwood, woodpecker, ivorybills, ...   
4        [A mako is a [MASK].]    [fish]         mako         mako      IsA                                        [porbeagle]     5             2         mako  [a mako is a [MASK]., a mako is a type of [MAS...  [a mako or [Z] is a [MASK]., a mako or [Z] is ...  [[MASK] such as mako., [MASK], including mako....  [[MASK] such as mako and [Z]., [MASK], includi...  [such as mako and [MASK]., such as mako or [MA...                      mako mako mako            1  [fish, canoe, drum, dog, boat, drummer, bird, ...  {'fish': -9.140592458399126, 'canoe': -9.49322...  [drum, fish, boat, canoe, bird, umbrella, flut...  {'drum': -8.934197447070298, 'fish': -9.539210...  [story, poems, fish, yes, artist, thing, peopl...  {'stories': -7.7291837518064845, 'poems': -9.2...  [porbeagle, thresher, dogfish, shovelheads, so...  [porbeagle, thresher, dogfish, shovelhead, sou...  [porbeagle, thresher, dogfish, shovelheads, so...  [porbeagle, thresher, dogfish, shovelhead, sou...   

                subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0                graver graver graver           5  [a graver or a pointel is a [MASK]., a graver ...  [[MASK] such as graver and pointels., [MASK] s...  [shovel, tool, knife, hammer, digger, pitchfor...  {'shovel': -7.944777764018204, 'tool': -8.2584...  [tool, instrument, thing, implement, item, typ...  {'tools': -8.114816614192053, 'instruments': -...  
1  smallmouths smallmouth smallmouths           5  [a smallmouth or a largemouth is a [MASK]., a ...  [[MASK] such as smallmouths and largemouths., ...  [fish, catfish, shark, salmon, bass, turtle, t...  {'fish': -5.09653802407856, 'catfish': -6.6257...  [fish, catfish, species, snake, reptile, carp,...  {'fish': -6.017343194756844, 'catfish': -7.720...  
2             pelican pelican pelican           5  [a pelican or a darter is a [MASK]., a pelican...  [[MASK] such as pelican and darters., [MASK] s...  [bird, dolphin, parrot, fish, turtle, boat, pe...  {'bird': -4.967916716253329, 'dolphin': -9.178...  [bird, species, fish, animal, dolphin, duck, w...  {'birds': -5.688889519514211, 'species': -8.63...  
3     sapsuckers sapsucker sapsuckers           5  [a sapsucker or a peckers is a [MASK]., a saps...  [[MASK] such as sapsuckers and peckers., [MASK...  [tree, bird, insect, snake, lizard, fish, spid...  {'tree': -7.010057755041778, 'bird': -8.287354...  [bird, insect, snake, reptile, species, animal...  {'birds': -7.774438289015079, 'insects': -8.08...  
4                      mako mako mako           5  [a mako or a porbeagle is a [MASK]., a mako or...  [[MASK] such as mako and porbeagle., [MASK] su...  [fish, soup, machine, drum, canoe, tool, imple...  {'fish': -8.169779720600754, 'soup': -8.547062...  [fish, animal, bird, species, thing, instrumen...  {'fish': -7.350701446569808, 'animals': -10.04...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  34.9 	  81.2 	   81.2 	  54.3 
  1 	 subj_anchors_wordnet_all 	  34.9 	  81.2 	   81.2 	  54.3 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  32.6 	  56.6 	   66.7 	  42.6 	              1 
  2 	 lsp_sap     	  30.7 	  51   	   59.8 	  38.9 	              3 
  3 	 def_dap     	  54   	  79.1 	   84   	  64.8 	              2 
  4 	 lsp_dap     	  56.6 	  77.9 	   86.8 	  66.2 	              4 
hline
end{tabular}
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.DIAG.tsv
save log/bert-large-uncased/lm_diagnostic_extended/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.DIAG.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/clsb/singular/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'CLSB'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/clsb/singular//IsA.jsonl
#All Instances: 1310
#Valid Instances: 1079 in CLSB (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                           subj_anchors_wordnet_sg
0     [an aeroplane or [Z] is a [MASK]., an aeroplan...       [airplane, plane, jet, biplane, hydroplane]
1     [an alligator or [Z] is a [MASK]., an alligato...  [gator, leather, crocodilian, horsehide, caiman]
2     [an alligator or [Z] is a [MASK]., an alligato...   [gator, leather, crocodilian, mochas, doeskins]
3     [an ambulance or [Z] is a [MASK]., an ambulanc...        [car, automobile, auto, motorcar, phaeton]
4     [an ambulance or [Z] is a [MASK]., an ambulanc...        [car, auto, automobile, motorcar, cruiser]
...                                                 ...                                               ...
1073  [a yoghurt or [Z] is a [MASK]., a yoghurt or [...         [yogurt, yoghourt, cheeses, creams, whey]
1074  [a yoghurt or [Z] is a [MASK]., a yoghurt or [...          [yogurt, yoghourt, curd, cheeses, milks]
1075  [a yoghurt or [Z] is a [MASK]., a yoghurt or [...           [yogurt, yoghourt, whey, curd, cheeses]
1077  [a zebra or [Z] is a [MASK]., a zebra or [Z] i...                                         [MISSING]
1078  [a zebra or [Z] is a [MASK]., a zebra or [Z] i...                                         [MISSING]

[1023 rows x 2 columns]
                                                lsp_dap                            subj_anchors_wordnet_pl
0     [[MASK] such as aeroplanes and [Z]., [MASK], i...    [airplanes, planes, jets, biplanes, hydroplane]
1     [[MASK] such as alligators and [Z]., [MASK], i...  [gators, leathers, crocodilian, horsehides, ca...
2     [[MASK] such as alligators and [Z]., [MASK], i...  [gators, leathers, crocodilian, mochas, doeskins]
3     [[MASK] such as ambulances and [Z]., [MASK], i...    [cars, automobiles, autos, motorcars, phaetons]
4     [[MASK] such as ambulances and [Z]., [MASK], i...    [cars, autos, automobiles, motorcars, cruisers]
...                                                 ...                                                ...
1073  [[MASK] such as yoghurt and [Z]., [MASK], incl...          [yogurt, yoghourt, cheeses, creams, whey]
1074  [[MASK] such as yoghurt and [Z]., [MASK], incl...          [yogurt, yoghourt, curds, cheeses, milks]
1075  [[MASK] such as yoghurt and [Z]., [MASK], incl...           [yogurt, yoghourt, whey, curds, cheeses]
1077  [[MASK] such as zebras and [Z]., [MASK], inclu...                                          [MISSING]
1078  [[MASK] such as zebras and [Z]., [MASK], inclu...                                          [MISSING]

[1023 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/1023 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 34%|███▍      | 350/1023 [01:00<01:55,  5.83it/s] 34%|███▍      | 350/1023 [01:20<01:55,  5.83it/s] 70%|███████   | 718/1023 [02:00<00:50,  6.00it/s] 70%|███████   | 718/1023 [02:20<00:50,  6.00it/s]100%|██████████| 1023/1023 [02:52<00:00,  5.94it/s]
  0%|          | 0/1023 [00:00<?, ?it/s] 17%|█▋        | 179/1023 [01:00<04:43,  2.98it/s] 17%|█▋        | 179/1023 [01:17<04:43,  2.98it/s] 34%|███▍      | 352/1023 [02:00<03:49,  2.92it/s] 34%|███▍      | 352/1023 [02:17<03:49,  2.92it/s] 52%|█████▏    | 528/1023 [03:00<02:49,  2.93it/s] 52%|█████▏    | 528/1023 [03:17<02:49,  2.93it/s] 70%|███████   | 721/1023 [04:00<01:39,  3.03it/s] 70%|███████   | 721/1023 [04:17<01:39,  3.03it/s] 88%|████████▊ | 896/1023 [05:00<00:42,  2.99it/s] 88%|████████▊ | 896/1023 [05:17<00:42,  2.99it/s]100%|██████████| 1023/1023 [05:43<00:00,  2.98it/s]
    sub_label   obj_label              masked_sentences relation  weight feature_type obj_label_single                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                   sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                           subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl  \
0  aeroplanes   [vehicle]   [An aeroplane is a [MASK].]      IsA       2    taxonomic          vehicle  [drone, airplane, whirlybird, ornithopter, war...     0             3    aeroplane   aeroplanes  [an aeroplane is a [MASK]., an aeroplane is a ...  [an aeroplane or [Z] is a [MASK]., an aeroplan...  [[MASK] such as aeroplanes., [MASK], including...  [[MASK] such as aeroplanes and [Z]., [MASK], i...  [such as aeroplanes and [MASK]., such as aerop...  aeroplanes aeroplane aeroplanes            1  [plane, biplane, glider, aircraft, helicopter,...  {'plane': -5.430296225218525, 'biplane': -7.54...  [aircraft, plane, airplane, glider, airship, b...  {'aircraft': -5.844922140009729, 'plane': -8.0...  [aircraft, thing, airplane, vehicle, plane, av...  {'aircraft': -5.754823951878233, 'things': -8....     [airplanes, planes, jets, biplane, hydroplane]       [airplane, plane, jet, biplane, hydroplane]    [airplanes, planes, jets, biplanes, hydroplane]   
1  alligators    [animal]  [An alligator is an [MASK].]      IsA      11    taxonomic           animal  [deerskin, calfskin, buff, fleece, crocodile, ...     2             3    alligator   alligators  [an alligator is a [MASK]., an alligator is a ...  [an alligator or [Z] is a [MASK]., an alligato...  [[MASK] such as alligators., [MASK], including...  [[MASK] such as alligators and [Z]., [MASK], i...  [such as alligators and [MASK]., such as allig...  alligators alligator alligators            1  [animal, insect, eel, alien, idiot, elephant, ...  {'animal': -5.75346447751135, 'insect': -10.19...  [fish, animal, turtle, crocodile, snake, lizar...  {'fish': -7.438471333835193, 'animal': -7.6710...  [reptile, animal, snake, thing, wildlife, fish...  {'reptiles': -5.7917639368590335, 'animals': -...  [gators, leathers, crocodilian, horsehides, ca...  [gator, leather, crocodilian, horsehide, caiman]  [gators, leathers, crocodilian, horsehides, ca...   
2  alligators  [predator]   [An alligator is a [MASK].]      IsA       6    taxonomic         predator  [deerskin, calfskin, buff, fleece, crocodile, ...     4             3    alligator   alligators  [an alligator is a [MASK]., an alligator is a ...  [an alligator or [Z] is a [MASK]., an alligato...  [[MASK] such as alligators., [MASK], including...  [[MASK] such as alligators and [Z]., [MASK], i...  [such as alligators and [MASK]., such as allig...  alligators alligator alligators            1  [fish, monster, snake, crocodile, turtle, huma...  {'fish': -7.292829009024019, 'monster': -8.504...  [fish, animal, turtle, crocodile, snake, lizar...  {'fish': -7.438471333835193, 'animal': -7.6710...  [reptile, animal, snake, thing, wildlife, fish...  {'reptiles': -5.7917639368590335, 'animals': -...  [gators, leathers, crocodilian, mochas, doeskins]   [gator, leather, crocodilian, mochas, doeskins]  [gators, leathers, crocodilian, mochas, doeskins]   
3  ambulances   [vehicle]   [An ambulance is a [MASK].]      IsA      21    taxonomic          vehicle  [loaner, racer, coupe, hatchback, wagon, cab, ...     6             3    ambulance   ambulances  [an ambulance is a [MASK]., an ambulance is a ...  [an ambulance or [Z] is a [MASK]., an ambulanc...  [[MASK] such as ambulances., [MASK], including...  [[MASK] such as ambulances and [Z]., [MASK], i...  [such as ambulances and [MASK]., such as ambul...  ambulances ambulance ambulances            1  [car, helicopter, hospital, vehicle, machine, ...  {'car': -8.0740543058224, 'helicopter': -8.913...  [vehicle, car, helicopter, machine, hospital, ...  {'vehicle': -8.574327708667136, 'car': -8.7382...  [vehicle, service, transportation, police, thi...  {'vehicles': -6.803935043970365, 'services': -...    [cars, automobiles, autos, motorcars, phaetons]        [car, automobile, auto, motorcar, phaeton]    [cars, automobiles, autos, motorcars, phaetons]   
4  ambulances       [van]   [An ambulance is a [MASK].]      IsA       2    taxonomic              van  [loaner, racer, coupe, hatchback, wagon, cab, ...     7             3    ambulance   ambulances  [an ambulance is a [MASK]., an ambulance is a ...  [an ambulance or [Z] is a [MASK]., an ambulanc...  [[MASK] such as ambulances., [MASK], including...  [[MASK] such as ambulances and [Z]., [MASK], i...  [such as ambulances and [MASK]., such as ambul...  ambulances ambulance ambulances            1  [car, helicopter, hospital, vehicle, machine, ...  {'car': -8.0740543058224, 'helicopter': -8.913...  [vehicle, car, helicopter, machine, hospital, ...  {'vehicle': -8.574327708667136, 'car': -8.7382...  [vehicle, service, transportation, police, thi...  {'vehicles': -6.803935043970365, 'services': -...    [cars, autos, automobiles, motorcars, cruisers]        [car, auto, automobile, motorcar, cruiser]    [cars, autos, automobiles, motorcars, cruisers]   

                           subj_anchors_wordnet_all            subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0       [airplane, plane, jet, biplane, hydroplane]  aeroplanes aeroplane aeroplanes           5  [an aeroplane or an airplane is a [MASK]., an ...  [[MASK] such as aeroplanes and airplanes., [MA...  [aircraft, plane, airplane, airship, vehicle, ...  {'aircraft': -5.784963745041031, 'plane': -8.3...  [aircraft, airplane, thing, plane, vehicle, av...  {'aircraft': -5.611183718936292, 'airplanes': ...  
1  [gator, leather, crocodilian, horsehide, caiman]  alligators alligator alligators           5  [an alligator or a gator is a [MASK]., an alli...  [[MASK] such as alligators and gators., [MASK]...  [fish, animal, mammal, turtle, lizard, crocodi...  {'fish': -7.890569853187058, 'animal': -8.0678...  [reptile, animal, snake, thing, fish, pet, ite...  {'reptiles': -6.555053877484769, 'animals': -7...  
2   [gator, leather, crocodilian, mochas, doeskins]  alligators alligator alligators           5  [an alligator or a gator is a [MASK]., an alli...  [[MASK] such as alligators and gators., [MASK]...  [fish, turtle, lizard, animal, mammal, crocodi...  {'fish': -7.38591907037723, 'turtle': -8.27661...  [reptile, animal, snake, thing, fish, pet, wil...  {'reptiles': -5.930561586088103, 'animals': -7...  
3        [car, automobile, auto, motorcar, phaeton]  ambulances ambulance ambulances           5  [an ambulance or a car is a [MASK]., an ambula...  [[MASK] such as ambulances and cars., [MASK] s...  [vehicle, car, transport, automobile, carriage...  {'vehicle': -6.062661421056876, 'car': -8.6560...  [vehicle, transportation, transport, car, thin...  {'vehicles': -5.559529114600508, 'transportati...  
4        [car, auto, automobile, motorcar, cruiser]  ambulances ambulance ambulances           5  [an ambulance or a car is a [MASK]., an ambula...  [[MASK] such as ambulances and cars., [MASK] s...  [vehicle, car, automobile, transport, bus, tru...  {'vehicle': -5.652310524908928, 'car': -8.1718...  [vehicle, transportation, car, transport, thin...  {'vehicles': -5.391790380069088, 'transportati...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  38.8 	  72.8 	   72.8 	  51.5 
  1 	 subj_anchors_wordnet_all 	  38.8 	  72.8 	   72.8 	  51.5 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  28.1 	  57.7 	   68.5 	  40.5 	              1 
  2 	 lsp_sap     	  26.8 	  53   	   64.3 	  38.1 	              3 
  3 	 def_dap     	  29.1 	  58.5 	   68.3 	  41.3 	              2 
  4 	 lsp_dap     	  29.3 	  58.7 	   68.4 	  41.8 	              4 
hline
end{tabular}
save log/bert-large-uncased/clsb/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.CLSB.tsv
save log/bert-large-uncased/clsb/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.CLSB.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/clsb/singular/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'CLSB'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/clsb/singular//IsA.jsonl
#All Instances: 1310
#Valid Instances: 1079 in CLSB (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                          subj_anchors_wordnet_sg
0     [an aeroplane or [Z] is a [MASK]., an aeroplan...        [plane, airplane, seaplane, fighter, jet]
1     [an alligator or [Z] is a [MASK]., an alligato...  [gator, leather, crocodilian, mochas, doeskins]
2     [an alligator or [Z] is a [MASK]., an alligato...  [gator, leather, crocodilian, buckskin, shammy]
3     [an ambulance or [Z] is a [MASK]., an ambulanc...     [motorcar, automobile, car, auto, limousine]
4     [an ambulance or [Z] is a [MASK]., an ambulanc...   [car, motorcar, automobile, auto, convertible]
...                                                 ...                                              ...
1073  [a yoghurt or [Z] is a [MASK]., a yoghurt or [...            [yoghourt, yogurt, curd, milks, whey]
1074  [a yoghurt or [Z] is a [MASK]., a yoghurt or [...         [yogurt, yoghourt, creams, butter, whey]
1075  [a yoghurt or [Z] is a [MASK]., a yoghurt or [...          [yogurt, yoghourt, curd, clabber, whey]
1077  [a zebra or [Z] is a [MASK]., a zebra or [Z] i...                                        [MISSING]
1078  [a zebra or [Z] is a [MASK]., a zebra or [Z] i...                                        [MISSING]

[1023 rows x 2 columns]
                                                lsp_dap                            subj_anchors_wordnet_pl
0     [[MASK] such as aeroplanes and [Z]., [MASK], i...     [planes, airplanes, seaplanes, fighters, jets]
1     [[MASK] such as alligators and [Z]., [MASK], i...  [gators, leathers, crocodilian, mochas, doeskins]
2     [[MASK] such as alligators and [Z]., [MASK], i...  [gators, leathers, crocodilian, buckskin, sham...
3     [[MASK] such as ambulances and [Z]., [MASK], i...  [motorcars, automobiles, cars, autos, limousines]
4     [[MASK] such as ambulances and [Z]., [MASK], i...  [cars, motorcars, automobiles, autos, converti...
...                                                 ...                                                ...
1073  [[MASK] such as yoghurt and [Z]., [MASK], incl...             [yoghourt, yogurt, curds, milks, whey]
1074  [[MASK] such as yoghurt and [Z]., [MASK], incl...          [yogurt, yoghourt, creams, butters, whey]
1075  [[MASK] such as yoghurt and [Z]., [MASK], incl...          [yogurt, yoghourt, curds, clabbers, whey]
1077  [[MASK] such as zebras and [Z]., [MASK], inclu...                                          [MISSING]
1078  [[MASK] such as zebras and [Z]., [MASK], inclu...                                          [MISSING]

[1023 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/1023 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 35%|███▍      | 355/1023 [01:00<01:52,  5.91it/s] 35%|███▍      | 355/1023 [01:20<01:52,  5.91it/s] 71%|███████▏  | 729/1023 [02:00<00:48,  6.10it/s] 71%|███████▏  | 729/1023 [02:20<00:48,  6.10it/s]100%|██████████| 1023/1023 [02:49<00:00,  6.02it/s]
  0%|          | 0/1023 [00:00<?, ?it/s] 18%|█▊        | 182/1023 [01:00<04:38,  3.02it/s] 18%|█▊        | 182/1023 [01:20<04:38,  3.02it/s] 35%|███▍      | 358/1023 [02:00<03:44,  2.96it/s] 35%|███▍      | 358/1023 [02:20<03:44,  2.96it/s] 52%|█████▏    | 536/1023 [03:00<02:44,  2.96it/s] 52%|█████▏    | 536/1023 [03:20<02:44,  2.96it/s] 72%|███████▏  | 732/1023 [04:00<01:34,  3.08it/s] 72%|███████▏  | 732/1023 [04:20<01:34,  3.08it/s] 89%|████████▊ | 906/1023 [05:00<00:38,  3.01it/s] 89%|████████▊ | 906/1023 [05:20<00:38,  3.01it/s]100%|██████████| 1023/1023 [05:39<00:00,  3.02it/s]
    sub_label   obj_label              masked_sentences relation  weight feature_type obj_label_single                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                   sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                          subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl  \
0  aeroplanes   [vehicle]   [An aeroplane is a [MASK].]      IsA       2    taxonomic          vehicle  [drone, airplane, whirlybird, ornithopter, war...     0             3    aeroplane   aeroplanes  [an aeroplane is a [MASK]., an aeroplane is a ...  [an aeroplane or [Z] is a [MASK]., an aeroplan...  [[MASK] such as aeroplanes., [MASK], including...  [[MASK] such as aeroplanes and [Z]., [MASK], i...  [such as aeroplanes and [MASK]., such as aerop...  aeroplanes aeroplane aeroplanes            1  [plane, biplane, glider, aircraft, helicopter,...  {'plane': -5.430296225218525, 'biplane': -7.54...  [aircraft, plane, airplane, glider, airship, b...  {'aircraft': -5.844922140009729, 'plane': -8.0...  [aircraft, thing, airplane, vehicle, plane, av...  {'aircraft': -5.754823951878233, 'things': -8....     [planes, airplanes, seaplanes, fighters, jets]        [plane, airplane, seaplane, fighter, jet]     [planes, airplanes, seaplanes, fighters, jets]   
1  alligators    [animal]  [An alligator is an [MASK].]      IsA      11    taxonomic           animal  [deerskin, calfskin, buff, fleece, crocodile, ...     2             3    alligator   alligators  [an alligator is a [MASK]., an alligator is a ...  [an alligator or [Z] is a [MASK]., an alligato...  [[MASK] such as alligators., [MASK], including...  [[MASK] such as alligators and [Z]., [MASK], i...  [such as alligators and [MASK]., such as allig...  alligators alligator alligators            1  [animal, insect, eel, alien, idiot, elephant, ...  {'animal': -5.75346447751135, 'insect': -10.19...  [fish, animal, turtle, crocodile, snake, lizar...  {'fish': -7.438471333835193, 'animal': -7.6710...  [reptile, animal, snake, thing, wildlife, fish...  {'reptiles': -5.7917639368590335, 'animals': -...  [gators, leathers, crocodilian, mochas, doeskins]  [gator, leather, crocodilian, mochas, doeskins]  [gators, leathers, crocodilian, mochas, doeskins]   
2  alligators  [predator]   [An alligator is a [MASK].]      IsA       6    taxonomic         predator  [deerskin, calfskin, buff, fleece, crocodile, ...     4             3    alligator   alligators  [an alligator is a [MASK]., an alligator is a ...  [an alligator or [Z] is a [MASK]., an alligato...  [[MASK] such as alligators., [MASK], including...  [[MASK] such as alligators and [Z]., [MASK], i...  [such as alligators and [MASK]., such as allig...  alligators alligator alligators            1  [fish, monster, snake, crocodile, turtle, huma...  {'fish': -7.292829009024019, 'monster': -8.504...  [fish, animal, turtle, crocodile, snake, lizar...  {'fish': -7.438471333835193, 'animal': -7.6710...  [reptile, animal, snake, thing, wildlife, fish...  {'reptiles': -5.7917639368590335, 'animals': -...  [gators, leathers, crocodilian, buckskin, sham...  [gator, leather, crocodilian, buckskin, shammy]  [gators, leathers, crocodilian, buckskin, sham...   
3  ambulances   [vehicle]   [An ambulance is a [MASK].]      IsA      21    taxonomic          vehicle  [loaner, racer, coupe, hatchback, wagon, cab, ...     6             3    ambulance   ambulances  [an ambulance is a [MASK]., an ambulance is a ...  [an ambulance or [Z] is a [MASK]., an ambulanc...  [[MASK] such as ambulances., [MASK], including...  [[MASK] such as ambulances and [Z]., [MASK], i...  [such as ambulances and [MASK]., such as ambul...  ambulances ambulance ambulances            1  [car, helicopter, hospital, vehicle, machine, ...  {'car': -8.0740543058224, 'helicopter': -8.913...  [vehicle, car, helicopter, machine, hospital, ...  {'vehicle': -8.574327708667136, 'car': -8.7382...  [vehicle, service, transportation, police, thi...  {'vehicles': -6.803935043970365, 'services': -...  [motorcars, automobiles, cars, autos, limousines]     [motorcar, automobile, car, auto, limousine]  [motorcars, automobiles, cars, autos, limousines]   
4  ambulances       [van]   [An ambulance is a [MASK].]      IsA       2    taxonomic              van  [loaner, racer, coupe, hatchback, wagon, cab, ...     7             3    ambulance   ambulances  [an ambulance is a [MASK]., an ambulance is a ...  [an ambulance or [Z] is a [MASK]., an ambulanc...  [[MASK] such as ambulances., [MASK], including...  [[MASK] such as ambulances and [Z]., [MASK], i...  [such as ambulances and [MASK]., such as ambul...  ambulances ambulance ambulances            1  [car, helicopter, hospital, vehicle, machine, ...  {'car': -8.0740543058224, 'helicopter': -8.913...  [vehicle, car, helicopter, machine, hospital, ...  {'vehicle': -8.574327708667136, 'car': -8.7382...  [vehicle, service, transportation, police, thi...  {'vehicles': -6.803935043970365, 'services': -...  [cars, motorcars, automobiles, autos, converti...   [car, motorcar, automobile, auto, convertible]  [cars, motorcars, automobiles, autos, converti...   

                          subj_anchors_wordnet_all            subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0        [plane, airplane, seaplane, fighter, jet]  aeroplanes aeroplane aeroplanes           5  [an aeroplane or a plane is a [MASK]., an aero...  [[MASK] such as aeroplanes and planes., [MASK]...  [aircraft, plane, airplane, vehicle, airship, ...  {'aircraft': -5.704144683166165, 'plane': -8.4...  [aircraft, airplane, plane, vehicle, thing, av...  {'aircraft': -5.583514340692504, 'airplanes': ...  
1  [gator, leather, crocodilian, mochas, doeskins]  alligators alligator alligators           5  [an alligator or a gator is a [MASK]., an alli...  [[MASK] such as alligators and gators., [MASK]...  [fish, turtle, lizard, animal, mammal, crocodi...  {'fish': -7.38591907037723, 'turtle': -8.27661...  [reptile, animal, snake, thing, fish, pet, wil...  {'reptiles': -5.930561586088103, 'animals': -7...  
2  [gator, leather, crocodilian, buckskin, shammy]  alligators alligator alligators           5  [an alligator or a gator is a [MASK]., an alli...  [[MASK] such as alligators and gators., [MASK]...  [fish, turtle, animal, lizard, mammal, crocodi...  {'fish': -7.693195311457431, 'turtle': -8.2644...  [reptile, animal, snake, pet, thing, creature,...  {'reptiles': -6.153875129963695, 'animals': -7...  
3     [motorcar, automobile, car, auto, limousine]  ambulances ambulance ambulances           5  [an ambulance or a motorcar is a [MASK]., an a...  [[MASK] such as ambulances and motorcars., [MA...  [vehicle, car, transport, automobile, bus, car...  {'vehicle': -5.538736149678467, 'car': -8.0974...  [vehicle, transportation, transport, car, serv...  {'vehicles': -5.453868526028583, 'transportati...  
4   [car, motorcar, automobile, auto, convertible]  ambulances ambulance ambulances           5  [an ambulance or a car is a [MASK]., an ambula...  [[MASK] such as ambulances and cars., [MASK] s...  [vehicle, car, automobile, transport, bus, tru...  {'vehicle': -5.582291828066086, 'car': -7.9695...  [vehicle, transportation, transport, car, thin...  {'vehicles': -5.655612896522798, 'transportati...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  39.2 	  71.8 	   71.8 	  51.4 
  1 	 subj_anchors_wordnet_all 	  39.2 	  71.8 	   71.8 	  51.4 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  28.1 	  57.7 	   68.5 	  40.5 	              1 
  2 	 lsp_sap     	  26.8 	  53   	   64.3 	  38.1 	              3 
  3 	 def_dap     	  29.2 	  58.3 	   68.3 	  41.6 	              2 
  4 	 lsp_dap     	  29.6 	  58   	   68.1 	  41.8 	              4 
hline
end{tabular}
save log/bert-large-uncased/clsb/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.CLSB.tsv
save log/bert-large-uncased/clsb/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.CLSB.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/clsb/singular/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'CLSB'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/clsb/singular//IsA.jsonl
#All Instances: 1310
#Valid Instances: 1079 in CLSB (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                          subj_anchors_wordnet_sg
0     [an aeroplane or [Z] is a [MASK]., an aeroplan...  [plane, airplane, seaplane, biplane, monoplane]
1     [an alligator or [Z] is a [MASK]., an alligato...      [gator, crocodilian, leather, kid, chamois]
2     [an alligator or [Z] is a [MASK]., an alligato...     [gator, leather, crocodilian, cayman, suede]
3     [an ambulance or [Z] is a [MASK]., an ambulanc...           [car, automobile, auto, motorcar, suv]
4     [an ambulance or [Z] is a [MASK]., an ambulanc...           [car, auto, motorcar, automobile, suv]
...                                                 ...                                              ...
1073  [a yoghurt or [Z] is a [MASK]., a yoghurt or [...           [yogurt, yoghourt, whey, curd, creams]
1074  [a yoghurt or [Z] is a [MASK]., a yoghurt or [...         [yoghourt, yogurt, milks, cheeses, whey]
1075  [a yoghurt or [Z] is a [MASK]., a yoghurt or [...        [yogurt, yoghourt, milks, butter, creams]
1077  [a zebra or [Z] is a [MASK]., a zebra or [Z] i...                                        [MISSING]
1078  [a zebra or [Z] is a [MASK]., a zebra or [Z] i...                                        [MISSING]

[1023 rows x 2 columns]
                                                lsp_dap                            subj_anchors_wordnet_pl
0     [[MASK] such as aeroplanes and [Z]., [MASK], i...  [planes, airplanes, seaplanes, biplanes, monop...
1     [[MASK] such as alligators and [Z]., [MASK], i...     [gators, crocodilian, leathers, kids, chamois]
2     [[MASK] such as alligators and [Z]., [MASK], i...     [gators, leathers, crocodilian, cayman, suede]
3     [[MASK] such as ambulances and [Z]., [MASK], i...        [cars, automobiles, autos, motorcars, suvs]
4     [[MASK] such as ambulances and [Z]., [MASK], i...        [cars, autos, motorcars, automobiles, suvs]
...                                                 ...                                                ...
1073  [[MASK] such as yoghurt and [Z]., [MASK], incl...            [yogurt, yoghourt, whey, curds, creams]
1074  [[MASK] such as yoghurt and [Z]., [MASK], incl...           [yoghourt, yogurt, milks, cheeses, whey]
1075  [[MASK] such as yoghurt and [Z]., [MASK], incl...         [yogurt, yoghourt, milks, butters, creams]
1077  [[MASK] such as zebras and [Z]., [MASK], inclu...                                          [MISSING]
1078  [[MASK] such as zebras and [Z]., [MASK], inclu...                                          [MISSING]

[1023 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/1023 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 34%|███▍      | 348/1023 [01:00<01:56,  5.80it/s] 34%|███▍      | 348/1023 [01:20<01:56,  5.80it/s] 70%|██████▉   | 714/1023 [02:00<00:51,  5.97it/s] 70%|██████▉   | 714/1023 [02:20<00:51,  5.97it/s]100%|██████████| 1023/1023 [02:52<00:00,  5.92it/s]
  0%|          | 0/1023 [00:00<?, ?it/s] 17%|█▋        | 179/1023 [01:00<04:43,  2.98it/s] 17%|█▋        | 179/1023 [01:17<04:43,  2.98it/s] 34%|███▍      | 352/1023 [02:00<03:49,  2.92it/s] 34%|███▍      | 352/1023 [02:17<03:49,  2.92it/s] 52%|█████▏    | 529/1023 [03:00<02:48,  2.93it/s] 52%|█████▏    | 529/1023 [03:17<02:48,  2.93it/s] 71%|███████   | 722/1023 [04:00<01:38,  3.04it/s] 71%|███████   | 722/1023 [04:17<01:38,  3.04it/s] 88%|████████▊ | 897/1023 [05:00<00:42,  3.00it/s] 88%|████████▊ | 897/1023 [05:17<00:42,  3.00it/s]100%|██████████| 1023/1023 [05:42<00:00,  2.99it/s]
    sub_label   obj_label              masked_sentences relation  weight feature_type obj_label_single                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                   sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                          subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl  \
0  aeroplanes   [vehicle]   [An aeroplane is a [MASK].]      IsA       2    taxonomic          vehicle  [drone, airplane, whirlybird, ornithopter, war...     0             3    aeroplane   aeroplanes  [an aeroplane is a [MASK]., an aeroplane is a ...  [an aeroplane or [Z] is a [MASK]., an aeroplan...  [[MASK] such as aeroplanes., [MASK], including...  [[MASK] such as aeroplanes and [Z]., [MASK], i...  [such as aeroplanes and [MASK]., such as aerop...  aeroplanes aeroplane aeroplanes            1  [plane, biplane, glider, aircraft, helicopter,...  {'plane': -5.430296225218525, 'biplane': -7.54...  [aircraft, plane, airplane, glider, airship, b...  {'aircraft': -5.844922140009729, 'plane': -8.0...  [aircraft, thing, airplane, vehicle, plane, av...  {'aircraft': -5.754823951878233, 'things': -8....  [planes, airplanes, seaplanes, biplane, monopl...  [plane, airplane, seaplane, biplane, monoplane]  [planes, airplanes, seaplanes, biplanes, monop...   
1  alligators    [animal]  [An alligator is an [MASK].]      IsA      11    taxonomic           animal  [deerskin, calfskin, buff, fleece, crocodile, ...     2             3    alligator   alligators  [an alligator is a [MASK]., an alligator is a ...  [an alligator or [Z] is a [MASK]., an alligato...  [[MASK] such as alligators., [MASK], including...  [[MASK] such as alligators and [Z]., [MASK], i...  [such as alligators and [MASK]., such as allig...  alligators alligator alligators            1  [animal, insect, eel, alien, idiot, elephant, ...  {'animal': -5.75346447751135, 'insect': -10.19...  [fish, animal, turtle, crocodile, snake, lizar...  {'fish': -7.438471333835193, 'animal': -7.6710...  [reptile, animal, snake, thing, wildlife, fish...  {'reptiles': -5.7917639368590335, 'animals': -...     [gators, crocodilian, leathers, kids, chamois]      [gator, crocodilian, leather, kid, chamois]     [gators, crocodilian, leathers, kids, chamois]   
2  alligators  [predator]   [An alligator is a [MASK].]      IsA       6    taxonomic         predator  [deerskin, calfskin, buff, fleece, crocodile, ...     4             3    alligator   alligators  [an alligator is a [MASK]., an alligator is a ...  [an alligator or [Z] is a [MASK]., an alligato...  [[MASK] such as alligators., [MASK], including...  [[MASK] such as alligators and [Z]., [MASK], i...  [such as alligators and [MASK]., such as allig...  alligators alligator alligators            1  [fish, monster, snake, crocodile, turtle, huma...  {'fish': -7.292829009024019, 'monster': -8.504...  [fish, animal, turtle, crocodile, snake, lizar...  {'fish': -7.438471333835193, 'animal': -7.6710...  [reptile, animal, snake, thing, wildlife, fish...  {'reptiles': -5.7917639368590335, 'animals': -...     [gators, leathers, crocodilian, cayman, suede]     [gator, leather, crocodilian, cayman, suede]     [gators, leathers, crocodilian, cayman, suede]   
3  ambulances   [vehicle]   [An ambulance is a [MASK].]      IsA      21    taxonomic          vehicle  [loaner, racer, coupe, hatchback, wagon, cab, ...     6             3    ambulance   ambulances  [an ambulance is a [MASK]., an ambulance is a ...  [an ambulance or [Z] is a [MASK]., an ambulanc...  [[MASK] such as ambulances., [MASK], including...  [[MASK] such as ambulances and [Z]., [MASK], i...  [such as ambulances and [MASK]., such as ambul...  ambulances ambulance ambulances            1  [car, helicopter, hospital, vehicle, machine, ...  {'car': -8.0740543058224, 'helicopter': -8.913...  [vehicle, car, helicopter, machine, hospital, ...  {'vehicle': -8.574327708667136, 'car': -8.7382...  [vehicle, service, transportation, police, thi...  {'vehicles': -6.803935043970365, 'services': -...         [cars, automobiles, autos, motorcars, suv]           [car, automobile, auto, motorcar, suv]        [cars, automobiles, autos, motorcars, suvs]   
4  ambulances       [van]   [An ambulance is a [MASK].]      IsA       2    taxonomic              van  [loaner, racer, coupe, hatchback, wagon, cab, ...     7             3    ambulance   ambulances  [an ambulance is a [MASK]., an ambulance is a ...  [an ambulance or [Z] is a [MASK]., an ambulanc...  [[MASK] such as ambulances., [MASK], including...  [[MASK] such as ambulances and [Z]., [MASK], i...  [such as ambulances and [MASK]., such as ambul...  ambulances ambulance ambulances            1  [car, helicopter, hospital, vehicle, machine, ...  {'car': -8.0740543058224, 'helicopter': -8.913...  [vehicle, car, helicopter, machine, hospital, ...  {'vehicle': -8.574327708667136, 'car': -8.7382...  [vehicle, service, transportation, police, thi...  {'vehicles': -6.803935043970365, 'services': -...         [cars, autos, motorcars, automobiles, suv]           [car, auto, motorcar, automobile, suv]        [cars, autos, motorcars, automobiles, suvs]   

                          subj_anchors_wordnet_all            subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0  [plane, airplane, seaplane, biplane, monoplane]  aeroplanes aeroplane aeroplanes           5  [an aeroplane or a plane is a [MASK]., an aero...  [[MASK] such as aeroplanes and planes., [MASK]...  [aircraft, plane, airplane, airship, biplane, ...  {'aircraft': -5.745789502205823, 'plane': -8.3...  [aircraft, airplane, thing, plane, type, vehic...  {'aircraft': -5.526639419491795, 'airplanes': ...  
1      [gator, crocodilian, leather, kid, chamois]  alligators alligator alligators           5  [an alligator or a gator is a [MASK]., an alli...  [[MASK] such as alligators and gators., [MASK]...  [fish, animal, turtle, mammal, lizard, crocodi...  {'fish': -7.713108500817487, 'animal': -8.1853...  [reptile, animal, snake, thing, wildlife, crea...  {'reptiles': -6.664543851206769, 'animals': -7...  
2     [gator, leather, crocodilian, cayman, suede]  alligators alligator alligators           5  [an alligator or a gator is a [MASK]., an alli...  [[MASK] such as alligators and gators., [MASK]...  [fish, animal, turtle, mammal, lizard, crocodi...  {'fish': -7.620092356651469, 'animal': -8.9587...  [reptile, animal, snake, thing, leather, item,...  {'reptiles': -6.550345027169743, 'animals': -8...  
3           [car, automobile, auto, motorcar, suv]  ambulances ambulance ambulances           5  [an ambulance or a car is a [MASK]., an ambula...  [[MASK] such as ambulances and cars., [MASK] s...  [vehicle, car, transport, automobile, bus, tru...  {'vehicle': -5.437938251013105, 'car': -8.1824...  [vehicle, transportation, car, transport, thin...  {'vehicles': -5.332520111708175, 'transportati...  
4           [car, auto, motorcar, automobile, suv]  ambulances ambulance ambulances           5  [an ambulance or a car is a [MASK]., an ambula...  [[MASK] such as ambulances and cars., [MASK] s...  [vehicle, car, transport, automobile, bus, tru...  {'vehicle': -5.437938251013105, 'car': -8.1824...  [vehicle, transportation, car, transport, thin...  {'vehicles': -5.332520111708175, 'transportati...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  38.7 	  71.7 	   71.7 	  51.3 
  1 	 subj_anchors_wordnet_all 	  38.7 	  71.7 	   71.7 	  51.3 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  28.1 	  57.7 	   68.5 	  40.5 	              1 
  2 	 lsp_sap     	  26.8 	  53   	   64.3 	  38.1 	              3 
  3 	 def_dap     	  28.5 	  57.3 	   68   	  40.8 	              2 
  4 	 lsp_dap     	  29.9 	  57.6 	   68.4 	  42   	              4 
hline
end{tabular}
save log/bert-large-uncased/clsb/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.CLSB.tsv
save log/bert-large-uncased/clsb/singular/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.CLSB.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/EVAL/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'EVAL'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/EVAL//IsA.jsonl
#All Instances: 957
#Valid Instances: 953 in EVAL (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                            subj_anchors_wordnet_sg
0    [an accident or [Z] is a [MASK]., an accident ...       [mishaps, collision, crashes, wreck, injury]
1    [an accident or [Z] is a [MASK]., an accident ...  [mishaps, collision, crashes, wreck, misadvent...
5    [an adult or [Z] is a [MASK]., an adult or [Z]...  [thoroughbred, herbivore, survivor, wiggler, b...
6    [an adult or [Z] is a [MASK]., an adult or [Z]...  [thoroughbred, purebred, orphan, scorpion, sur...
7    [an adventure or [Z] is a [MASK]., an adventur...  [escapade, undertaking, project, task, enterpr...
..                                                 ...                                                ...
944  [a word or [Z] is a [MASK]., a word or [Z] is ...       [lyric, language, speech, lipograms, stanza]
945  [a work or [Z] is a [MASK]., a work or [Z] is ...  [laceworks, polychrome, masterpiece, publicati...
946  [a work or [Z] is a [MASK]., a work or [Z] is ...  [woodworks, handicraft, laceworks, handworks, ...
950  [a worm or [Z] is a [MASK]., a worm or [Z] is ...   [lice, insect, nemertean, pogonophoran, annelid]
952  [a yard or [Z] is a [MASK]., a yard or [Z] is ...  [curtilage, ground, dooryard, backyard, playgr...

[649 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as accidents and [Z]., [MASK], in...   [mishaps, collisions, crashes, wrecks, injuries]
1    [[MASK] such as accidents and [Z]., [MASK], in...  [mishaps, collisions, crashes, wrecks, misadve...
5    [[MASK] such as adults and [Z]., [MASK], inclu...  [thoroughbred, herbivores, survivors, wiggler,...
6    [[MASK] such as adults and [Z]., [MASK], inclu...  [thoroughbred, purebred, orphans, scorpions, s...
7    [[MASK] such as adventure and [Z]., [MASK], in...  [escapades, undertakings, projects, tasks, ent...
..                                                 ...                                                ...
944  [[MASK] such as words and [Z]., [MASK], includ...   [lyrics, languages, speeches, lipograms, stanza]
945  [[MASK] such as work and [Z]., [MASK], includi...  [laceworks, polychromes, masterpieces, publica...
946  [[MASK] such as work and [Z]., [MASK], includi...  [woodworks, handicrafts, laceworks, handworks,...
950  [[MASK] such as worms and [Z]., [MASK], includ...  [lices, insects, nemertean, pogonophoran, anne...
952  [[MASK] such as yard and [Z]., [MASK], includi...  [curtilages, grounds, dooryards, backyards, pl...

[649 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/649 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 52%|█████▏    | 338/649 [01:00<00:55,  5.63it/s] 52%|█████▏    | 338/649 [01:20<00:55,  5.63it/s]100%|██████████| 649/649 [01:54<00:00,  5.68it/s]
  0%|          | 0/649 [00:00<?, ?it/s] 26%|██▌       | 168/649 [01:00<02:52,  2.79it/s] 26%|██▌       | 168/649 [01:15<02:52,  2.79it/s] 53%|█████▎    | 344/649 [02:00<01:46,  2.87it/s] 53%|█████▎    | 344/649 [02:15<01:46,  2.87it/s] 80%|███████▉  | 517/649 [03:00<00:45,  2.87it/s] 80%|███████▉  | 517/649 [03:15<00:45,  2.87it/s]100%|██████████| 649/649 [03:45<00:00,  2.88it/s]
   sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                 sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
0  accidents    [error]      IsA  [An accident is a [MASK]., An accident is an [...  [gravy, convergence, reverse, flash, interrupt...     0             3     accident    accidents  [an accident is a [MASK]., an accident is a ty...  [an accident or [Z] is a [MASK]., an accident ...  [[MASK] such as accidents., [MASK], including ...  [[MASK] such as accidents and [Z]., [MASK], in...  [such as accidents and [MASK]., such as accide...   accidents accident accidents            1  [mistake, disaster, failure, tragedy, crime, c...  {'mistake': -7.604061857774812, 'disaster': -8...  [tragedy, disaster, mistake, catastrophe, crim...  {'tragedy': -8.648991036579575, 'disaster': -8...  [incident, injury, thing, event, causes, disas...  {'incidents': -8.381302205838045, 'injuries': ...   [mishaps, collisions, crashes, wrecks, injuries]       [mishaps, collision, crashes, wreck, injury]   [mishaps, collisions, crashes, wrecks, injuries]       [mishaps, collision, crashes, wreck, injury]   
1  accidents  [mistake]      IsA  [An accident is a [MASK]., An accident is an [...  [gravy, convergence, reverse, flash, interrupt...     1             3     accident    accidents  [an accident is a [MASK]., an accident is a ty...  [an accident or [Z] is a [MASK]., an accident ...  [[MASK] such as accidents., [MASK], including ...  [[MASK] such as accidents and [Z]., [MASK], in...  [such as accidents and [MASK]., such as accide...   accidents accident accidents            1  [mistake, disaster, failure, tragedy, crime, c...  {'mistake': -7.604061857774812, 'disaster': -8...  [tragedy, disaster, mistake, catastrophe, crim...  {'tragedy': -8.648991036579575, 'disaster': -8...  [incident, injury, thing, event, causes, disas...  {'incidents': -8.381302205838045, 'injuries': ...  [mishaps, collisions, crashes, wrecks, misadve...  [mishaps, collision, crashes, wreck, misadvent...  [mishaps, collisions, crashes, wrecks, misadve...  [mishaps, collision, crashes, wreck, misadvent...   
5     adults   [animal]      IsA    [An adult is a [MASK]., An adult is an [MASK].]  [quester, stunt, white, signer, chordate, knoc...     5             3        adult       adults  [an adult is a [MASK]., an adult is a type of ...  [an adult or [Z] is a [MASK]., an adult or [Z]...  [[MASK] such as adults., [MASK], including adu...  [[MASK] such as adults and [Z]., [MASK], inclu...  [such as adults and [MASK]., such as adults or...            adults adult adults            1  [child, person, juvenile, parent, baby, human,...  {'child': -10.102968180126787, 'person': -10.9...  [child, person, human, animal, kid, man, youth...  {'child': -6.099704076686769, 'person': -8.855...  [child, people, animal, student, thing, person...  {'children': -6.207245997857331, 'people': -8....  [thoroughbred, herbivores, survivors, wiggler,...  [thoroughbred, herbivore, survivor, wiggler, b...  [thoroughbred, herbivores, survivors, wiggler,...  [thoroughbred, herbivore, survivor, wiggler, b...   
6     adults   [person]      IsA    [An adult is a [MASK]., An adult is an [MASK].]  [quester, stunt, white, signer, chordate, knoc...     6             3        adult       adults  [an adult is a [MASK]., an adult is a type of ...  [an adult or [Z] is a [MASK]., an adult or [Z]...  [[MASK] such as adults., [MASK], including adu...  [[MASK] such as adults and [Z]., [MASK], inclu...  [such as adults and [MASK]., such as adults or...            adults adult adults            1  [child, person, juvenile, parent, baby, human,...  {'child': -10.102968180126787, 'person': -10.9...  [child, person, human, animal, kid, man, youth...  {'child': -6.099704076686769, 'person': -8.855...  [child, people, animal, student, thing, person...  {'children': -6.207245997857331, 'people': -8....  [thoroughbred, purebred, orphan, scorpions, su...  [thoroughbred, purebred, orphan, scorpion, sur...  [thoroughbred, purebred, orphans, scorpions, s...  [thoroughbred, purebred, orphan, scorpion, sur...   
7  adventure   [action]      IsA  [An adventure is a [MASK]., An adventure is an...  [walkover, picnic, marathon, pushover, endeavo...     7             3    adventure    adventure  [an adventure is a [MASK]., an adventure is a ...  [an adventure or [Z] is a [MASK]., an adventur...  [[MASK] such as adventure., [MASK], including ...  [[MASK] such as adventure and [Z]., [MASK], in...  [such as adventure and [MASK]., such as advent...  adventure adventure adventure            1  [challenge, journey, quest, dream, thrill, mys...  {'challenge': -7.8066466360503775, 'journey': ...  [quest, challenge, journey, game, entertainmen...  {'quest': -8.545373577893876, 'challenge': -8....  [thing, adventure, story, fantasy, game, magaz...  {'things': -8.303719928387679, 'adventures': -...  [escapades, undertakings, projects, tasks, ent...  [escapade, undertaking, project, task, enterpr...  [escapades, undertakings, projects, tasks, ent...  [escapade, undertaking, project, task, enterpr...   

           subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0   accidents accident accidents           5  [an accident or a mishaps is a [MASK]., an acc...  [[MASK] such as accidents and mishaps., [MASK]...  [tragedy, crime, disaster, injury, catastrophe...  {'tragedy': -8.595399548322593, 'crime': -8.67...  [incident, injury, thing, event, causes, probl...  {'incidents': -7.886065404806296, 'injuries': ...  
1   accidents accident accidents           5  [an accident or a mishaps is a [MASK]., an acc...  [[MASK] such as accidents and mishaps., [MASK]...  [tragedy, crime, disaster, injury, catastrophe...  {'tragedy': -8.44555847382159, 'crime': -8.573...  [incident, injury, thing, event, causes, disas...  {'incidents': -7.784174696701734, 'injuries': ...  
5            adults adult adults           5  [an adult or a thoroughbred is a [MASK]., an a...  [[MASK] such as adults and thoroughbred., [MAS...  [animal, person, survivor, horse, human, mamma...  {'animal': -8.40640565706487, 'person': -9.073...  [animal, people, mammal, horse, child, species...  {'animals': -8.434289978597723, 'people': -8.7...  
6            adults adult adults           5  [an adult or a thoroughbred is a [MASK]., an a...  [[MASK] such as adults and thoroughbred., [MAS...  [horse, person, child, scorpion, animal, insec...  {'horse': -6.867847445450454, 'person': -8.654...  [child, people, insect, breed, horse, animal, ...  {'children': -8.193481453393288, 'people': -8....  
7  adventure adventure adventure           5  [an adventure or an escapade is a [MASK]., an ...  [[MASK] such as adventure and escapades., [MAS...  [activity, quest, work, entertainment, journey...  {'activity': -8.091507895003803, 'quest': -9.0...  [activity, adventure, thing, game, theme, topi...  {'activities': -8.742006040969313, 'adventures...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  51.8 	  72.9 	   72.9 	  59.6 
  1 	 subj_anchors_wordnet_all 	  51.8 	  72.9 	   72.9 	  59.6 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  14.3 	  37.6 	   47.8 	  24.2 	              1 
  2 	 lsp_sap     	   8.2 	  29.3 	   40.2 	  17   	              3 
  3 	 def_dap     	  14.6 	  35.7 	   44.8 	  23.5 	              2 
  4 	 lsp_dap     	  10.5 	  29   	   40.4 	  18.8 	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/EVAL/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.EVAL.tsv
save log/bert-large-uncased/hypernymsuite/EVAL/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.EVAL.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/EVAL/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'EVAL'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/EVAL//IsA.jsonl
#All Instances: 957
#Valid Instances: 953 in EVAL (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                            subj_anchors_wordnet_sg
0    [an accident or [Z] is a [MASK]., an accident ...      [wreck, mischances, mishaps, crashes, injury]
1    [an accident or [Z] is a [MASK]., an accident ...  [collision, crashes, wreck, misadventure, mish...
5    [an adult or [Z] is a [MASK]., an adult or [Z]...  [thoroughbred, varmint, migrator, stayer, poik...
6    [an adult or [Z] is a [MASK]., an adult or [Z]...   [thoroughbred, pureblood, embryo, prey, wiggler]
7    [an adventure or [Z] is a [MASK]., an adventur...   [escapade, task, project, undertaking, pushover]
..                                                 ...                                                ...
944  [a word or [Z] is a [MASK]., a word or [Z] is ...       [lyric, speech, language, lipograms, stanza]
945  [a work or [Z] is a [MASK]., a work or [Z] is ...  [lacquerware, laceworks, handcraft, handworks,...
946  [a work or [Z] is a [MASK]., a work or [Z] is ...  [handworks, handiworks, openwork, handicraft, ...
950  [a worm or [Z] is a [MASK]., a worm or [Z] is ...  [lice, insect, platyhelminth, roundworm, helmi...
952  [a yard or [Z] is a [MASK]., a yard or [Z] is ...   [curtilage, ground, field, backyard, playground]

[649 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as accidents and [Z]., [MASK], in...   [wrecks, mischances, mishaps, crashes, injuries]
1    [[MASK] such as accidents and [Z]., [MASK], in...  [collisions, crashes, wrecks, misadventures, m...
5    [[MASK] such as adults and [Z]., [MASK], inclu...  [thoroughbred, varmint, migrators, stayers, po...
6    [[MASK] such as adults and [Z]., [MASK], inclu...  [thoroughbred, purebloods, embryos, preys, wig...
7    [[MASK] such as adventure and [Z]., [MASK], in...  [escapades, tasks, projects, undertakings, pus...
..                                                 ...                                                ...
944  [[MASK] such as words and [Z]., [MASK], includ...   [lyrics, speeches, languages, lipograms, stanza]
945  [[MASK] such as work and [Z]., [MASK], includi...  [lacquerwares, laceworks, handcrafts, handwork...
946  [[MASK] such as work and [Z]., [MASK], includi...  [handworks, handiworks, openworks, handicrafts...
950  [[MASK] such as worms and [Z]., [MASK], includ...  [lices, insects, platyhelminth, roundworms, he...
952  [[MASK] such as yard and [Z]., [MASK], includi...  [curtilages, grounds, fields, backyards, playg...

[649 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/649 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 51%|█████     | 330/649 [01:00<00:58,  5.49it/s] 51%|█████     | 330/649 [01:20<00:58,  5.49it/s]100%|██████████| 649/649 [01:56<00:00,  5.55it/s]
  0%|          | 0/649 [00:00<?, ?it/s] 25%|██▌       | 164/649 [01:00<02:58,  2.72it/s] 25%|██▌       | 164/649 [01:13<02:58,  2.72it/s] 51%|█████▏    | 333/649 [02:00<01:54,  2.77it/s] 51%|█████▏    | 333/649 [02:13<01:54,  2.77it/s] 78%|███████▊  | 504/649 [03:00<00:51,  2.80it/s] 78%|███████▊  | 504/649 [03:13<00:51,  2.80it/s]100%|██████████| 649/649 [03:51<00:00,  2.80it/s]
   sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                 sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
0  accidents    [error]      IsA  [An accident is a [MASK]., An accident is an [...  [gravy, convergence, reverse, flash, interrupt...     0             3     accident    accidents  [an accident is a [MASK]., an accident is a ty...  [an accident or [Z] is a [MASK]., an accident ...  [[MASK] such as accidents., [MASK], including ...  [[MASK] such as accidents and [Z]., [MASK], in...  [such as accidents and [MASK]., such as accide...   accidents accident accidents            1  [mistake, disaster, failure, tragedy, crime, c...  {'mistake': -7.604061857774812, 'disaster': -8...  [tragedy, disaster, mistake, catastrophe, crim...  {'tragedy': -8.648991036579575, 'disaster': -8...  [incident, injury, thing, event, causes, disas...  {'incidents': -8.381302205838045, 'injuries': ...   [wrecks, mischances, mishaps, crashes, injuries]      [wreck, mischances, mishaps, crashes, injury]   [wrecks, mischances, mishaps, crashes, injuries]      [wreck, mischances, mishaps, crashes, injury]   
1  accidents  [mistake]      IsA  [An accident is a [MASK]., An accident is an [...  [gravy, convergence, reverse, flash, interrupt...     1             3     accident    accidents  [an accident is a [MASK]., an accident is a ty...  [an accident or [Z] is a [MASK]., an accident ...  [[MASK] such as accidents., [MASK], including ...  [[MASK] such as accidents and [Z]., [MASK], in...  [such as accidents and [MASK]., such as accide...   accidents accident accidents            1  [mistake, disaster, failure, tragedy, crime, c...  {'mistake': -7.604061857774812, 'disaster': -8...  [tragedy, disaster, mistake, catastrophe, crim...  {'tragedy': -8.648991036579575, 'disaster': -8...  [incident, injury, thing, event, causes, disas...  {'incidents': -8.381302205838045, 'injuries': ...  [collisions, crashes, wrecks, misadventure, mi...  [collision, crashes, wreck, misadventure, mish...  [collisions, crashes, wrecks, misadventures, m...  [collision, crashes, wreck, misadventure, mish...   
5     adults   [animal]      IsA    [An adult is a [MASK]., An adult is an [MASK].]  [quester, stunt, white, signer, chordate, knoc...     5             3        adult       adults  [an adult is a [MASK]., an adult is a type of ...  [an adult or [Z] is a [MASK]., an adult or [Z]...  [[MASK] such as adults., [MASK], including adu...  [[MASK] such as adults and [Z]., [MASK], inclu...  [such as adults and [MASK]., such as adults or...            adults adult adults            1  [child, person, juvenile, parent, baby, human,...  {'child': -10.102968180126787, 'person': -10.9...  [child, person, human, animal, kid, man, youth...  {'child': -6.099704076686769, 'person': -8.855...  [child, people, animal, student, thing, person...  {'children': -6.207245997857331, 'people': -8....  [thoroughbred, varmint, migrator, stayers, poi...  [thoroughbred, varmint, migrator, stayer, poik...  [thoroughbred, varmint, migrators, stayers, po...  [thoroughbred, varmint, migrator, stayer, poik...   
6     adults   [person]      IsA    [An adult is a [MASK]., An adult is an [MASK].]  [quester, stunt, white, signer, chordate, knoc...     6             3        adult       adults  [an adult is a [MASK]., an adult is a type of ...  [an adult or [Z] is a [MASK]., an adult or [Z]...  [[MASK] such as adults., [MASK], including adu...  [[MASK] such as adults and [Z]., [MASK], inclu...  [such as adults and [MASK]., such as adults or...            adults adult adults            1  [child, person, juvenile, parent, baby, human,...  {'child': -10.102968180126787, 'person': -10.9...  [child, person, human, animal, kid, man, youth...  {'child': -6.099704076686769, 'person': -8.855...  [child, people, animal, student, thing, person...  {'children': -6.207245997857331, 'people': -8....  [thoroughbred, purebloods, embryos, preys, wig...   [thoroughbred, pureblood, embryo, prey, wiggler]  [thoroughbred, purebloods, embryos, preys, wig...   [thoroughbred, pureblood, embryo, prey, wiggler]   
7  adventure   [action]      IsA  [An adventure is a [MASK]., An adventure is an...  [walkover, picnic, marathon, pushover, endeavo...     7             3    adventure    adventure  [an adventure is a [MASK]., an adventure is a ...  [an adventure or [Z] is a [MASK]., an adventur...  [[MASK] such as adventure., [MASK], including ...  [[MASK] such as adventure and [Z]., [MASK], in...  [such as adventure and [MASK]., such as advent...  adventure adventure adventure            1  [challenge, journey, quest, dream, thrill, mys...  {'challenge': -7.8066466360503775, 'journey': ...  [quest, challenge, journey, game, entertainmen...  {'quest': -8.545373577893876, 'challenge': -8....  [thing, adventure, story, fantasy, game, magaz...  {'things': -8.303719928387679, 'adventures': -...  [escapades, tasks, projects, undertakings, pus...   [escapade, task, project, undertaking, pushover]  [escapades, tasks, projects, undertakings, pus...   [escapade, task, project, undertaking, pushover]   

           subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0   accidents accident accidents           5  [an accident or a wreck is a [MASK]., an accid...  [[MASK] such as accidents and wrecks., [MASK] ...  [crime, tragedy, disaster, injury, catastrophe...  {'crime': -8.443965850616573, 'tragedy': -8.81...  [incident, injury, thing, causes, event, probl...  {'incidents': -7.986827223649022, 'injuries': ...  
1   accidents accident accidents           5  [an accident or a collision is a [MASK]., an a...  [[MASK] such as accidents and collisions., [MA...  [tragedy, crime, disaster, injury, catastrophe...  {'tragedy': -8.445558473821592, 'crime': -8.57...  [incident, injury, thing, event, causes, disas...  {'incidents': -7.784174696701732, 'injuries': ...  
5            adults adult adults           5  [an adult or a thoroughbred is a [MASK]., an a...  [[MASK] such as adults and thoroughbred., [MAS...  [horse, animal, person, fish, child, human, bi...  {'horse': -8.133008923573597, 'animal': -8.853...  [people, child, animal, breed, horse, inverteb...  {'people': -8.857709324258018, 'children': -8....  
6            adults adult adults           5  [an adult or a thoroughbred is a [MASK]., an a...  [[MASK] such as adults and thoroughbred., [MAS...  [animal, horse, human, vampire, person, child,...  {'animal': -7.665939696943458, 'horse': -8.277...  [animal, people, horse, species, child, human,...  {'animals': -8.118075656175098, 'people': -9.8...  
7  adventure adventure adventure           5  [an adventure or an escapade is a [MASK]., an ...  [[MASK] such as adventure and escapades., [MAS...  [activity, quest, journey, work, entertainment...  {'activity': -8.678390781086868, 'quest': -9.2...  [activity, adventure, thing, theme, game, topi...  {'activities': -8.912361656763006, 'adventures...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  50.7 	  72.9 	   72.9 	  59.1 
  1 	 subj_anchors_wordnet_all 	  50.7 	  72.9 	   72.9 	  59.1 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  14.3 	  37.6 	   47.8 	  24.2 	              1 
  2 	 lsp_sap     	   8.2 	  29.3 	   40.2 	  17   	              3 
  3 	 def_dap     	  14   	  35.9 	   45.5 	  23.4 	              2 
  4 	 lsp_dap     	  10.5 	  29.4 	   41.1 	  18.5 	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/EVAL/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.EVAL.tsv
save log/bert-large-uncased/hypernymsuite/EVAL/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.EVAL.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/EVAL/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'EVAL'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/EVAL//IsA.jsonl
#All Instances: 957
#Valid Instances: 953 in EVAL (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                               def_dap                            subj_anchors_wordnet_sg
0    [an accident or [Z] is a [MASK]., an accident ...       [injury, mishaps, crashes, collision, wreck]
1    [an accident or [Z] is a [MASK]., an accident ...      [wreck, mishaps, injury, mischances, crashes]
5    [an adult or [Z] is a [MASK]., an adult or [Z]...  [thoroughbred, metazoan, conceptus, invertebra...
6    [an adult or [Z] is a [MASK]., an adult or [Z]...  [thoroughbred, wriggler, pureblood, chordate, ...
7    [an adventure or [Z] is a [MASK]., an adventur...   [escapade, project, undertaking, task, marathon]
..                                                 ...                                                ...
944  [a word or [Z] is a [MASK]., a word or [Z] is ...    [lyric, language, speech, soliloquy, lipograms]
945  [a work or [Z] is a [MASK]., a work or [Z] is ...  [lacquerware, wickerwork, laceworks, caning, m...
946  [a work or [Z] is a [MASK]., a work or [Z] is ...  [handcraft, publication, leatherwork, followup...
950  [a worm or [Z] is a [MASK]., a worm or [Z] is ...       [lice, insect, flatworm, woodworm, helminth]
952  [a yard or [Z] is a [MASK]., a yard or [Z] is ...  [curtilage, ground, dooryard, backyard, playgr...

[649 rows x 2 columns]
                                               lsp_dap                            subj_anchors_wordnet_pl
0    [[MASK] such as accidents and [Z]., [MASK], in...   [injuries, mishaps, crashes, collisions, wrecks]
1    [[MASK] such as accidents and [Z]., [MASK], in...   [wrecks, mishaps, injuries, mischances, crashes]
5    [[MASK] such as adults and [Z]., [MASK], inclu...  [thoroughbred, metazoan, conceptus, invertebra...
6    [[MASK] such as adults and [Z]., [MASK], inclu...  [thoroughbred, wriggler, purebloods, chordates...
7    [[MASK] such as adventure and [Z]., [MASK], in...  [escapades, projects, undertakings, tasks, mar...
..                                                 ...                                                ...
944  [[MASK] such as words and [Z]., [MASK], includ...  [lyrics, languages, speeches, soliloquy, lipog...
945  [[MASK] such as work and [Z]., [MASK], includi...  [lacquerwares, wickerworks, laceworks, caning,...
946  [[MASK] such as work and [Z]., [MASK], includi...  [handcrafts, publications, leatherworks, follo...
950  [[MASK] such as worms and [Z]., [MASK], includ...  [lices, insects, flatworms, woodworms, helminths]
952  [[MASK] such as yard and [Z]., [MASK], includi...  [curtilages, grounds, dooryards, backyards, pl...

[649 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/649 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 51%|█████     | 330/649 [01:00<00:58,  5.50it/s] 51%|█████     | 330/649 [01:20<00:58,  5.50it/s]100%|██████████| 649/649 [01:56<00:00,  5.55it/s]
  0%|          | 0/649 [00:00<?, ?it/s] 25%|██▌       | 163/649 [01:00<02:59,  2.71it/s] 25%|██▌       | 163/649 [01:13<02:59,  2.71it/s] 51%|█████     | 332/649 [02:00<01:54,  2.77it/s] 51%|█████     | 332/649 [02:13<01:54,  2.77it/s] 77%|███████▋  | 501/649 [03:00<00:53,  2.79it/s] 77%|███████▋  | 501/649 [03:13<00:53,  2.79it/s]100%|██████████| 649/649 [03:52<00:00,  2.79it/s]
   sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                 sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
0  accidents    [error]      IsA  [An accident is a [MASK]., An accident is an [...  [gravy, convergence, reverse, flash, interrupt...     0             3     accident    accidents  [an accident is a [MASK]., an accident is a ty...  [an accident or [Z] is a [MASK]., an accident ...  [[MASK] such as accidents., [MASK], including ...  [[MASK] such as accidents and [Z]., [MASK], in...  [such as accidents and [MASK]., such as accide...   accidents accident accidents            1  [mistake, disaster, failure, tragedy, crime, c...  {'mistake': -7.604061857774812, 'disaster': -8...  [tragedy, disaster, mistake, catastrophe, crim...  {'tragedy': -8.648991036579575, 'disaster': -8...  [incident, injury, thing, event, causes, disas...  {'incidents': -8.381302205838045, 'injuries': ...   [injuries, mishaps, crashes, collisions, wrecks]       [injury, mishaps, crashes, collision, wreck]   [injuries, mishaps, crashes, collisions, wrecks]       [injury, mishaps, crashes, collision, wreck]   
1  accidents  [mistake]      IsA  [An accident is a [MASK]., An accident is an [...  [gravy, convergence, reverse, flash, interrupt...     1             3     accident    accidents  [an accident is a [MASK]., an accident is a ty...  [an accident or [Z] is a [MASK]., an accident ...  [[MASK] such as accidents., [MASK], including ...  [[MASK] such as accidents and [Z]., [MASK], in...  [such as accidents and [MASK]., such as accide...   accidents accident accidents            1  [mistake, disaster, failure, tragedy, crime, c...  {'mistake': -7.604061857774812, 'disaster': -8...  [tragedy, disaster, mistake, catastrophe, crim...  {'tragedy': -8.648991036579575, 'disaster': -8...  [incident, injury, thing, event, causes, disas...  {'incidents': -8.381302205838045, 'injuries': ...   [wrecks, mishaps, injuries, mischances, crashes]      [wreck, mishaps, injury, mischances, crashes]   [wrecks, mishaps, injuries, mischances, crashes]      [wreck, mishaps, injury, mischances, crashes]   
5     adults   [animal]      IsA    [An adult is a [MASK]., An adult is an [MASK].]  [quester, stunt, white, signer, chordate, knoc...     5             3        adult       adults  [an adult is a [MASK]., an adult is a type of ...  [an adult or [Z] is a [MASK]., an adult or [Z]...  [[MASK] such as adults., [MASK], including adu...  [[MASK] such as adults and [Z]., [MASK], inclu...  [such as adults and [MASK]., such as adults or...            adults adult adults            1  [child, person, juvenile, parent, baby, human,...  {'child': -10.102968180126787, 'person': -10.9...  [child, person, human, animal, kid, man, youth...  {'child': -6.099704076686769, 'person': -8.855...  [child, people, animal, student, thing, person...  {'children': -6.207245997857331, 'people': -8....  [thoroughbred, metazoan, conceptus, invertebra...  [thoroughbred, metazoan, conceptus, invertebra...  [thoroughbred, metazoan, conceptus, invertebra...  [thoroughbred, metazoan, conceptus, invertebra...   
6     adults   [person]      IsA    [An adult is a [MASK]., An adult is an [MASK].]  [quester, stunt, white, signer, chordate, knoc...     6             3        adult       adults  [an adult is a [MASK]., an adult is a type of ...  [an adult or [Z] is a [MASK]., an adult or [Z]...  [[MASK] such as adults., [MASK], including adu...  [[MASK] such as adults and [Z]., [MASK], inclu...  [such as adults and [MASK]., such as adults or...            adults adult adults            1  [child, person, juvenile, parent, baby, human,...  {'child': -10.102968180126787, 'person': -10.9...  [child, person, human, animal, kid, man, youth...  {'child': -6.099704076686769, 'person': -8.855...  [child, people, animal, student, thing, person...  {'children': -6.207245997857331, 'people': -8....  [thoroughbred, wriggler, purebloods, chordates...  [thoroughbred, wriggler, pureblood, chordate, ...  [thoroughbred, wriggler, purebloods, chordates...  [thoroughbred, wriggler, pureblood, chordate, ...   
7  adventure   [action]      IsA  [An adventure is a [MASK]., An adventure is an...  [walkover, picnic, marathon, pushover, endeavo...     7             3    adventure    adventure  [an adventure is a [MASK]., an adventure is a ...  [an adventure or [Z] is a [MASK]., an adventur...  [[MASK] such as adventure., [MASK], including ...  [[MASK] such as adventure and [Z]., [MASK], in...  [such as adventure and [MASK]., such as advent...  adventure adventure adventure            1  [challenge, journey, quest, dream, thrill, mys...  {'challenge': -7.8066466360503775, 'journey': ...  [quest, challenge, journey, game, entertainmen...  {'quest': -8.545373577893876, 'challenge': -8....  [thing, adventure, story, fantasy, game, magaz...  {'things': -8.303719928387679, 'adventures': -...  [escapades, projects, undertakings, tasks, mar...   [escapade, project, undertaking, task, marathon]  [escapades, projects, undertakings, tasks, mar...   [escapade, project, undertaking, task, marathon]   

           subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0   accidents accident accidents           5  [an accident or an injury is a [MASK]., an acc...  [[MASK] such as accidents and injuries., [MASK...  [tragedy, crime, disaster, injury, catastrophe...  {'tragedy': -8.595399548322595, 'crime': -8.67...  [incident, injury, thing, event, causes, probl...  {'incidents': -7.886065404806295, 'injuries': ...  
1   accidents accident accidents           5  [an accident or a wreck is a [MASK]., an accid...  [[MASK] such as accidents and wrecks., [MASK] ...  [crime, tragedy, disaster, injury, catastrophe...  {'crime': -8.443965850616573, 'tragedy': -8.81...  [incident, injury, thing, causes, event, probl...  {'incidents': -7.986827223649022, 'injuries': ...  
5            adults adult adults           5  [an adult or a thoroughbred is a [MASK]., an a...  [[MASK] such as adults and thoroughbred., [MAS...  [animal, horse, organism, child, person, human...  {'animal': -8.651339778281136, 'horse': -8.903...  [animal, invertebrates, breed, organism, horse...  {'animals': -8.464135627614697, 'invertebrates...  
6            adults adult adults           5  [an adult or a thoroughbred is a [MASK]., an a...  [[MASK] such as adults and thoroughbred., [MAS...  [animal, horse, human, vampire, musician, pers...  {'animal': -7.6662251786179825, 'horse': -8.29...  [animal, people, child, horse, species, invert...  {'animals': -8.099917879757532, 'people': -9.1...  
7  adventure adventure adventure           5  [an adventure or an escapade is a [MASK]., an ...  [[MASK] such as adventure and escapades., [MAS...  [activity, journey, quest, work, marathon, cha...  {'activity': -8.384261525316225, 'journey': -9...  [activity, sport, adventure, event, thing, the...  {'activities': -8.484974342156276, 'sports': -...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  51.5 	  73.8 	   73.8 	  59.5 
  1 	 subj_anchors_wordnet_all 	  51.5 	  73.8 	   73.8 	  59.5 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  14.3 	  37.6 	   47.8 	  24.2 	              1 
  2 	 lsp_sap     	   8.2 	  29.3 	   40.2 	  17   	              3 
  3 	 def_dap     	  13.7 	  36.7 	   45.1 	  23.1 	              2 
  4 	 lsp_dap     	  10.9 	  29.9 	   40.1 	  18.9 	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/EVAL/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.EVAL.tsv
save log/bert-large-uncased/hypernymsuite/EVAL/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.EVAL.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/LEDS/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'LEDS'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/LEDS//IsA.jsonl
#All Instances: 1385
#Valid Instances: 1262 in LEDS (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                            subj_anchors_wordnet_sg
0     [an etching or [Z] is a [MASK]., an etching or...   [engraving, aquatint, woodcut, gravure, linecut]
2     [a dinghy or [Z] is a [MASK]., a dinghy or [Z]...         [dory, rowboat, wherry, cockleshell, yawl]
3     [a tie or [Z] is a [MASK]., a tie or [Z] is a ...            [necktie, bolo, neckwear, bola, bowtie]
4     [a batsman or [Z] is a [MASK]., a batsman or [...         [hitter, batter, slugger, bunter, whiffer]
5     [a washer or [Z] is a [MASK]., a washer or [Z]...         [lockring, gasket, zipper, buckle, joggle]
...                                                 ...                                                ...
1257  [a typography or [Z] is a [MASK]., a typograph...  [trade, craft, shoemaking, plumbing, carpentries]
1258  [a tench or [Z] is a [MASK]., a tench or [Z] i...           [cyprinid, goldfish, chub, dace, minnow]
1259  [an army or [Z] is a [MASK]., an army or [Z] i...                [usa, army, office, agency, legion]
1260  [a fresco or [Z] is a [MASK]., a fresco or [Z]...                                          [MISSING]
1261  [a hare or [Z] is a [MASK]., a hare or [Z] is ...   [leporid, jackrabbit, leveret, buffalo, venison]

[1118 rows x 2 columns]
                                                lsp_dap                            subj_anchors_wordnet_pl
0     [[MASK] such as etching and [Z]., [MASK], incl...  [engraving, aquatints, woodcuts, gravures, lin...
2     [[MASK] such as dinghies and [Z]., [MASK], inc...     [dory, rowboats, wherries, cockleshells, yawl]
3     [[MASK] such as tie and [Z]., [MASK], includin...          [neckties, bolo, neckwear, bola, bowties]
4     [[MASK] such as batsmen and [Z]., [MASK], incl...      [hitter, batters, sluggers, bunters, whiffer]
5     [[MASK] such as washers and [Z]., [MASK], incl...     [lockrings, gaskets, zippers, buckle, joggles]
...                                                 ...                                                ...
1257  [[MASK] such as typographies and [Z]., [MASK],...  [trades, crafts, shoemaking, plumbings, carpen...
1258  [[MASK] such as tenches and [Z]., [MASK], incl...          [cyprinid, goldfish, chub, daces, minnow]
1259  [[MASK] such as armies and [Z]., [MASK], inclu...          [usa, armies, offices, agencies, legions]
1260  [[MASK] such as frescoes and [Z]., [MASK], inc...                                          [MISSING]
1261  [[MASK] such as hare and [Z]., [MASK], includi...  [leporids, jackrabbits, leveret, buffalo, veni...

[1118 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/1118 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 25%|██▍       | 278/1118 [01:00<03:01,  4.62it/s] 25%|██▍       | 278/1118 [01:20<03:01,  4.62it/s] 50%|█████     | 560/1118 [02:00<01:59,  4.66it/s] 50%|█████     | 560/1118 [02:20<01:59,  4.66it/s] 75%|███████▌  | 840/1118 [03:00<00:59,  4.66it/s] 75%|███████▌  | 840/1118 [03:20<00:59,  4.66it/s]100%|██████████| 1118/1118 [03:58<00:00,  4.68it/s]
  0%|          | 0/1118 [00:00<?, ?it/s] 13%|█▎        | 140/1118 [01:00<07:02,  2.32it/s] 13%|█▎        | 140/1118 [01:11<07:02,  2.32it/s] 27%|██▋       | 304/1118 [02:00<05:18,  2.56it/s] 27%|██▋       | 304/1118 [02:11<05:18,  2.56it/s] 43%|████▎     | 478/1118 [03:00<03:56,  2.71it/s] 43%|████▎     | 478/1118 [03:11<03:56,  2.71it/s] 58%|█████▊    | 654/1118 [04:01<02:46,  2.79it/s] 58%|█████▊    | 654/1118 [04:21<02:46,  2.79it/s] 74%|███████▎  | 824/1118 [05:01<01:44,  2.80it/s] 74%|███████▎  | 824/1118 [05:21<01:44,  2.80it/s] 90%|████████▉ | 1005/1118 [06:01<00:39,  2.87it/s] 90%|████████▉ | 1005/1118 [06:21<00:39,  2.87it/s]100%|██████████| 1118/1118 [06:42<00:00,  2.78it/s]
  sub_label   obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap            sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                           subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                          subj_anchors_wordnet_all  \
0   etching       [art]      IsA  [An etching is a [MASK]., An etching is an [MA...  [halftone, serigraphy, woodcut, lithography, p...     0             3      etching      etching  [an etching is a [MASK]., an etching is a type...  [an etching or [Z] is a [MASK]., an etching or...  [[MASK] such as etching., [MASK], including et...  [[MASK] such as etching and [Z]., [MASK], incl...  [such as etching and [MASK]., such as etching ...   etching etching etching            1  [drawing, illustration, painting, engraving, p...  {'drawing': -6.798399279520061, 'illustration'...  [drawing, painting, engraving, print, illustra...  {'drawing': -6.167860487330729, 'painting': -6...  [thing, technique, art, drawing, painting, wor...  {'things': -7.88263134598992, 'techniques': -8...  [engraving, aquatints, woodcuts, gravures, lin...  [engraving, aquatint, woodcut, gravure, linecut]  [engraving, aquatints, woodcuts, gravures, lin...  [engraving, aquatint, woodcut, gravure, linecut]   
2  dinghies      [boat]      IsA    [A dinghy is a [MASK]., A dinghy is an [MASK].]  [canoe, cockleshell, gig, rowboat, dory, yawl,...     3             2       dinghy     dinghies  [a dinghy is a [MASK]., a dinghy is a type of ...  [a dinghy or [Z] is a [MASK]., a dinghy or [Z]...  [[MASK] such as dinghies., [MASK], including d...  [[MASK] such as dinghies and [Z]., [MASK], inc...  [such as dinghies and [MASK]., such as dinghie...  dinghies dinghy dinghies            1  [aircraft, airship, yacht, boat, automobile, e...  {'aircraft': -6.9738131185113055, 'airship': -...  [boat, yacht, vessel, sailing, sail, ship, cra...  {'boat': -5.155298464348918, 'yacht': -5.60234...  [boat, thing, ship, sailing, vessel, yacht, cr...  {'boats': -4.961173063122545, 'things': -9.064...      [dory, rowboats, wherries, cockleshell, yawl]        [dory, rowboat, wherry, cockleshell, yawl]     [dory, rowboats, wherries, cockleshells, yawl]        [dory, rowboat, wherry, cockleshell, yawl]   
3       tie  [clothing]      IsA          [A tie is a [MASK]., A tie is an [MASK].]  [lanyard, gusset, eyelet, chenille, balk, stri...     5             2          tie          tie  [a tie is a [MASK]., a tie is a type of [MASK]...  [a tie or [Z] is a [MASK]., a tie or [Z] is a ...  [[MASK] such as tie., [MASK], including tie., ...  [[MASK] such as tie and [Z]., [MASK], includin...  [such as tie and [MASK]., such as tie or [MASK...               tie tie tie            1  [object, knot, order, anchor, agreement, arrow...  {'object': -8.206908354643717, 'knot': -9.0139...  [knot, shirt, belt, ribbon, jacket, clothing, ...  {'knot': -9.035804536093991, 'shirt': -10.4270...  [yes, thing, brand, yeah, tie, wins, problem, ...  {'yes': -8.920535460424064, 'things': -8.96685...            [necktie, bolo, neckwear, bola, bowtie]           [necktie, bolo, neckwear, bola, bowtie]          [neckties, bolo, neckwear, bola, bowties]           [necktie, bolo, neckwear, bola, bowtie]   
4   batsmen   [athlete]      IsA  [A batsman is a [MASK]., A batsman is an [MASK].]  [hurler, hitter, batter, pitcher, fielder, twi...     6             2      batsman      batsmen  [a batsman is a [MASK]., a batsman is a type o...  [a batsman or [Z] is a [MASK]., a batsman or [...  [[MASK] such as batsmen., [MASK], including ba...  [[MASK] such as batsmen and [Z]., [MASK], incl...  [such as batsmen and [MASK]., such as batsmen ...   batsmen batsman batsmen            1  [bowler, opener, outfielder, catcher, batter, ...  {'bowler': -6.232246258775115, 'opener': -7.88...  [cricketer, footballer, player, bowler, athlet...  {'cricketer': -7.3063472463640675, 'footballer...  [player, thing, batting, people, man, team, po...  {'players': -5.269524161883701, 'things': -11....      [hitter, batters, sluggers, bunters, whiffer]        [hitter, batter, slugger, bunter, whiffer]      [hitter, batters, sluggers, bunters, whiffer]        [hitter, batter, slugger, bunter, whiffer]   
5   washers    [worker]      IsA    [A washer is a [MASK]., A washer is an [MASK].]  [splicer, accumulator, sprigger, lamplighter, ...     7             2       washer      washers  [a washer is a [MASK]., a washer is a type of ...  [a washer or [Z] is a [MASK]., a washer or [Z]...  [[MASK] such as washers., [MASK], including wa...  [[MASK] such as washers and [Z]., [MASK], incl...  [such as washers and [MASK]., such as washers ...    washers washer washers            1  [oven, employee, apron, person, object, sink, ...  {'oven': -8.438302036169869, 'employee': -9.33...  [machine, toilet, laundry, sink, robot, person...  {'machine': -7.648520012840529, 'toilet': -8.4...  [woman, maids, assistant, appliance, worker, t...  {'women': -8.803567509180104, 'maids': -8.9984...      [lockrings, gaskets, zippers, buckle, joggle]        [lockring, gasket, zipper, buckle, joggle]     [lockrings, gaskets, zippers, buckle, joggles]        [lockring, gasket, zipper, buckle, joggle]   

      subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0   etching etching etching           5  [an etching or an engraving is a [MASK]., an e...  [[MASK] such as etching and engraving., [MASK]...  [drawing, painting, print, engraving, illustra...  {'drawing': -6.96727475943178, 'painting': -7....  [technique, art, drawing, works, illustration,...  {'techniques': -7.783591898617945, 'art': -8.4...  
2  dinghies dinghy dinghies           5  [a dinghy or a dory is a [MASK]., a dinghy or ...  [[MASK] such as dinghies and dory., [MASK] suc...  [boat, yacht, vessel, sail, ship, craft, saili...  {'boat': -4.889141893287919, 'yacht': -6.31625...  [boat, vessel, ship, craft, yacht, shell, thin...  {'boats': -4.919943704852772, 'vessels': -10.1...  
3               tie tie tie           5  [a tie or a necktie is a [MASK]., a tie or a b...  [[MASK] such as tie and neckties., [MASK] such...  [knot, scarf, dress, belt, cloth, shirt, cloth...  {'knot': -8.802973947485295, 'scarf': -10.9879...  [accessory, thing, clothing, tie, item, suit, ...  {'accessories': -7.500733550068882, 'things': ...  
4   batsmen batsman batsmen           5  [a batsman or a hitter is a [MASK]., a batsman...  [[MASK] such as batsmen and hitter., [MASK] su...  [player, cricketer, bowler, footballer, pitche...  {'player': -7.517684124020566, 'cricketer': -8...  [player, thing, role, people, batting, positio...  {'players': -5.657681981182889, 'things': -10....  
5    washers washer washers           5  [a washer or a lockring is a [MASK]., a washer...  [[MASK] such as washers and lockrings., [MASK]...  [toilet, machine, zipper, tool, handle, device...  {'toilet': -8.7718171257565, 'machine': -8.855...  [accessory, tool, item, thing, device, applian...  {'accessories': -7.527333639333881, 'tools': -...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	    48 	  76.3 	   76.3 	  58.6 
  1 	 subj_anchors_wordnet_all 	    48 	  76.3 	   76.3 	  58.6 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  20.9 	  49.7 	   60.6 	  33.1 	              1 
  2 	 lsp_sap     	  20.3 	  47.7 	   58.4 	  31.7 	              3 
  3 	 def_dap     	  25   	  54.7 	   66.2 	  37.8 	              2 
  4 	 lsp_dap     	  24.2 	  53.8 	   66.9 	  37.2 	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/LEDS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.LEDS.tsv
save log/bert-large-uncased/hypernymsuite/LEDS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.LEDS.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/LEDS/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'LEDS'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/LEDS//IsA.jsonl
#All Instances: 1385
#Valid Instances: 1262 in LEDS (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                            subj_anchors_wordnet_sg
0     [an etching or [Z] is a [MASK]., an etching or...   [engraving, aquatint, gravure, woodcut, linecut]
2     [a dinghy or [Z] is a [MASK]., a dinghy or [Z]...            [dory, rowboat, wherry, skiff, coracle]
3     [a tie or [Z] is a [MASK]., a tie or [Z] is a ...            [necktie, bolo, neckwear, bola, bowtie]
4     [a batsman or [Z] is a [MASK]., a batsman or [...         [batter, slugger, hitter, bunter, whiffer]
5     [a washer or [Z] is a [MASK]., a washer or [Z]...      [lockring, gasket, stopping, bellyband, seal]
...                                                 ...                                                ...
1257  [a typography or [Z] is a [MASK]., a typograph...  [craft, trade, cobbling, goldsmithery, shingling]
1258  [a tench or [Z] is a [MASK]., a tench or [Z] i...           [cyprinid, dace, goldfish, chub, minnow]
1259  [an army or [Z] is a [MASK]., an army or [Z] i...                [usa, army, bureau, legion, agency]
1260  [a fresco or [Z] is a [MASK]., a fresco or [Z]...                                          [MISSING]
1261  [a hare or [Z] is a [MASK]., a hare or [Z] is ...    [leporid, jackrabbit, leveret, rabbit, venison]

[1118 rows x 2 columns]
                                                lsp_dap                            subj_anchors_wordnet_pl
0     [[MASK] such as etching and [Z]., [MASK], incl...  [engraving, aquatints, gravures, woodcuts, lin...
2     [[MASK] such as dinghies and [Z]., [MASK], inc...       [dory, rowboats, wherries, skiffs, coracles]
3     [[MASK] such as tie and [Z]., [MASK], includin...          [neckties, bolo, neckwear, bola, bowties]
4     [[MASK] such as batsmen and [Z]., [MASK], incl...      [batters, sluggers, hitter, bunters, whiffer]
5     [[MASK] such as washers and [Z]., [MASK], incl...   [lockrings, gaskets, stopping, bellyband, seals]
...                                                 ...                                                ...
1257  [[MASK] such as typographies and [Z]., [MASK],...  [crafts, trades, cobbling, goldsmitheries, shi...
1258  [[MASK] such as tenches and [Z]., [MASK], incl...          [cyprinid, daces, goldfish, chub, minnow]
1259  [[MASK] such as armies and [Z]., [MASK], inclu...           [usa, armies, bureau, legions, agencies]
1260  [[MASK] such as frescoes and [Z]., [MASK], inc...                                          [MISSING]
1261  [[MASK] such as hare and [Z]., [MASK], includi...  [leporids, jackrabbits, leveret, rabbits, veni...

[1118 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/1118 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 31%|███       | 345/1118 [01:00<02:14,  5.75it/s] 31%|███       | 345/1118 [01:20<02:14,  5.75it/s] 62%|██████▏   | 692/1118 [02:00<01:13,  5.77it/s] 62%|██████▏   | 692/1118 [02:20<01:13,  5.77it/s] 93%|█████████▎| 1041/1118 [03:00<00:13,  5.78it/s]100%|██████████| 1118/1118 [03:13<00:00,  5.77it/s]
  0%|          | 0/1118 [00:00<?, ?it/s] 15%|█▌        | 173/1118 [01:00<05:28,  2.88it/s] 15%|█▌        | 173/1118 [01:16<05:28,  2.88it/s] 31%|███       | 348/1118 [02:00<04:26,  2.89it/s] 31%|███       | 348/1118 [02:16<04:26,  2.89it/s] 47%|████▋     | 520/1118 [03:00<03:27,  2.88it/s] 47%|████▋     | 520/1118 [03:16<03:27,  2.88it/s] 62%|██████▏   | 698/1118 [04:00<02:24,  2.91it/s] 62%|██████▏   | 698/1118 [04:16<02:24,  2.91it/s] 78%|███████▊  | 869/1118 [05:01<01:26,  2.88it/s] 78%|███████▊  | 869/1118 [05:16<01:26,  2.88it/s] 94%|█████████▍| 1049/1118 [06:01<00:23,  2.92it/s] 94%|█████████▍| 1049/1118 [06:16<00:23,  2.92it/s]100%|██████████| 1118/1118 [06:25<00:00,  2.90it/s]
  sub_label   obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap            sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                           subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                          subj_anchors_wordnet_all  \
0   etching       [art]      IsA  [An etching is a [MASK]., An etching is an [MA...  [halftone, serigraphy, woodcut, lithography, p...     0             3      etching      etching  [an etching is a [MASK]., an etching is a type...  [an etching or [Z] is a [MASK]., an etching or...  [[MASK] such as etching., [MASK], including et...  [[MASK] such as etching and [Z]., [MASK], incl...  [such as etching and [MASK]., such as etching ...   etching etching etching            1  [drawing, illustration, painting, engraving, p...  {'drawing': -6.798399279520061, 'illustration'...  [drawing, painting, engraving, print, illustra...  {'drawing': -6.167860487330729, 'painting': -6...  [thing, technique, art, drawing, painting, wor...  {'things': -7.88263134598992, 'techniques': -8...  [engraving, aquatints, gravures, woodcuts, lin...  [engraving, aquatint, gravure, woodcut, linecut]  [engraving, aquatints, gravures, woodcuts, lin...  [engraving, aquatint, gravure, woodcut, linecut]   
2  dinghies      [boat]      IsA    [A dinghy is a [MASK]., A dinghy is an [MASK].]  [canoe, cockleshell, gig, rowboat, dory, yawl,...     3             2       dinghy     dinghies  [a dinghy is a [MASK]., a dinghy is a type of ...  [a dinghy or [Z] is a [MASK]., a dinghy or [Z]...  [[MASK] such as dinghies., [MASK], including d...  [[MASK] such as dinghies and [Z]., [MASK], inc...  [such as dinghies and [MASK]., such as dinghie...  dinghies dinghy dinghies            1  [aircraft, airship, yacht, boat, automobile, e...  {'aircraft': -6.9738131185113055, 'airship': -...  [boat, yacht, vessel, sailing, sail, ship, cra...  {'boat': -5.155298464348918, 'yacht': -5.60234...  [boat, thing, ship, sailing, vessel, yacht, cr...  {'boats': -4.961173063122545, 'things': -9.064...        [dory, rowboats, wherries, skiff, coracles]           [dory, rowboat, wherry, skiff, coracle]       [dory, rowboats, wherries, skiffs, coracles]           [dory, rowboat, wherry, skiff, coracle]   
3       tie  [clothing]      IsA          [A tie is a [MASK]., A tie is an [MASK].]  [lanyard, gusset, eyelet, chenille, balk, stri...     5             2          tie          tie  [a tie is a [MASK]., a tie is a type of [MASK]...  [a tie or [Z] is a [MASK]., a tie or [Z] is a ...  [[MASK] such as tie., [MASK], including tie., ...  [[MASK] such as tie and [Z]., [MASK], includin...  [such as tie and [MASK]., such as tie or [MASK...               tie tie tie            1  [object, knot, order, anchor, agreement, arrow...  {'object': -8.206908354643717, 'knot': -9.0139...  [knot, shirt, belt, ribbon, jacket, clothing, ...  {'knot': -9.035804536093991, 'shirt': -10.4270...  [yes, thing, brand, yeah, tie, wins, problem, ...  {'yes': -8.920535460424064, 'things': -8.96685...            [necktie, bolo, neckwear, bola, bowtie]           [necktie, bolo, neckwear, bola, bowtie]          [neckties, bolo, neckwear, bola, bowties]           [necktie, bolo, neckwear, bola, bowtie]   
4   batsmen   [athlete]      IsA  [A batsman is a [MASK]., A batsman is an [MASK].]  [hurler, hitter, batter, pitcher, fielder, twi...     6             2      batsman      batsmen  [a batsman is a [MASK]., a batsman is a type o...  [a batsman or [Z] is a [MASK]., a batsman or [...  [[MASK] such as batsmen., [MASK], including ba...  [[MASK] such as batsmen and [Z]., [MASK], incl...  [such as batsmen and [MASK]., such as batsmen ...   batsmen batsman batsmen            1  [bowler, opener, outfielder, catcher, batter, ...  {'bowler': -6.232246258775115, 'opener': -7.88...  [cricketer, footballer, player, bowler, athlet...  {'cricketer': -7.3063472463640675, 'footballer...  [player, thing, batting, people, man, team, po...  {'players': -5.269524161883701, 'things': -11....      [batters, sluggers, hitter, bunters, whiffer]        [batter, slugger, hitter, bunter, whiffer]      [batters, sluggers, hitter, bunters, whiffer]        [batter, slugger, hitter, bunter, whiffer]   
5   washers    [worker]      IsA    [A washer is a [MASK]., A washer is an [MASK].]  [splicer, accumulator, sprigger, lamplighter, ...     7             2       washer      washers  [a washer is a [MASK]., a washer is a type of ...  [a washer or [Z] is a [MASK]., a washer or [Z]...  [[MASK] such as washers., [MASK], including wa...  [[MASK] such as washers and [Z]., [MASK], incl...  [such as washers and [MASK]., such as washers ...    washers washer washers            1  [oven, employee, apron, person, object, sink, ...  {'oven': -8.438302036169869, 'employee': -9.33...  [machine, toilet, laundry, sink, robot, person...  {'machine': -7.648520012840529, 'toilet': -8.4...  [woman, maids, assistant, appliance, worker, t...  {'women': -8.803567509180104, 'maids': -8.9984...   [lockrings, gaskets, stopping, bellyband, seals]     [lockring, gasket, stopping, bellyband, seal]   [lockrings, gaskets, stopping, bellyband, seals]     [lockring, gasket, stopping, bellyband, seal]   

      subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0   etching etching etching           5  [an etching or an engraving is a [MASK]., an e...  [[MASK] such as etching and engraving., [MASK]...  [drawing, painting, print, engraving, illustra...  {'drawing': -6.967274759431782, 'painting': -7...  [technique, art, drawing, works, illustration,...  {'techniques': -7.783591898617945, 'art': -8.4...  
2  dinghies dinghy dinghies           5  [a dinghy or a dory is a [MASK]., a dinghy or ...  [[MASK] such as dinghies and dory., [MASK] suc...  [boat, yacht, vessel, ship, sail, craft, saili...  {'boat': -4.806688835605468, 'yacht': -6.66844...  [boat, vessel, ship, craft, thing, yacht, sail...  {'boats': -4.710274549813193, 'vessels': -9.92...  
3               tie tie tie           5  [a tie or a necktie is a [MASK]., a tie or a b...  [[MASK] such as tie and neckties., [MASK] such...  [knot, scarf, dress, belt, cloth, shirt, cloth...  {'knot': -8.802973947485295, 'scarf': -10.9879...  [accessory, thing, clothing, tie, item, suit, ...  {'accessories': -7.500733550068882, 'things': ...  
4   batsmen batsman batsmen           5  [a batsman or a batter is a [MASK]., a batsman...  [[MASK] such as batsmen and batters., [MASK] s...  [player, cricketer, bowler, footballer, pitche...  {'player': -7.517684124020566, 'cricketer': -8...  [player, thing, role, people, batting, positio...  {'players': -5.657681981182888, 'things': -10....  
5    washers washer washers           5  [a washer or a lockring is a [MASK]., a washer...  [[MASK] such as washers and lockrings., [MASK]...  [machine, toilet, seal, tool, device, garment,...  {'machine': -7.930081575020414, 'toilet': -8.2...  [accessory, tool, appliance, thing, item, devi...  {'accessories': -8.043886801796067, 'tools': -...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	    48 	    77 	     77 	  58.7 
  1 	 subj_anchors_wordnet_all 	    48 	    77 	     77 	  58.7 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  20.9 	  49.7 	   60.6 	  33.1 	              1 
  2 	 lsp_sap     	  20.3 	  47.7 	   58.4 	  31.7 	              3 
  3 	 def_dap     	  24.3 	  55.5 	   66.1 	  37.5 	              2 
  4 	 lsp_dap     	  24.6 	  54.7 	   66   	  37.3 	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/LEDS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.LEDS.tsv
save log/bert-large-uncased/hypernymsuite/LEDS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.LEDS.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/LEDS/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'LEDS'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/LEDS//IsA.jsonl
#All Instances: 1385
#Valid Instances: 1262 in LEDS (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                def_dap                           subj_anchors_wordnet_sg
0     [an etching or [Z] is a [MASK]., an etching or...  [aquatint, engraving, linecut, gravure, woodcut]
2     [a dinghy or [Z] is a [MASK]., a dinghy or [Z]...               [rowboat, dory, wherry, gig, canoe]
3     [a tie or [Z] is a [MASK]., a tie or [Z] is a ...           [necktie, neckwear, bowtie, bolo, bola]
4     [a batsman or [Z] is a [MASK]., a batsman or [...        [slugger, batter, hitter, whiffer, bunter]
5     [a washer or [Z] is a [MASK]., a washer or [Z]...       [lockring, gasket, cottar, cringle, buckle]
...                                                 ...                                               ...
1257  [a typography or [Z] is a [MASK]., a typograph...  [craft, trade, lumbering, dressmaking, drafting]
1258  [a tench or [Z] is a [MASK]., a tench or [Z] i...       [cyprinid, minnow, carp, goldfish, gudgeon]
1259  [an army or [Z] is a [MASK]., an army or [Z] i...               [army, usa, legion, office, agency]
1260  [a fresco or [Z] is a [MASK]., a fresco or [Z]...                                         [MISSING]
1261  [a hare or [Z] is a [MASK]., a hare or [Z] is ...   [leveret, leporid, jackrabbit, rabbit, buffalo]

[1118 rows x 2 columns]
                                                lsp_dap                            subj_anchors_wordnet_pl
0     [[MASK] such as etching and [Z]., [MASK], incl...  [aquatints, engraving, linecut, gravures, wood...
2     [[MASK] such as dinghies and [Z]., [MASK], inc...           [rowboats, dory, wherries, gigs, canoes]
3     [[MASK] such as tie and [Z]., [MASK], includin...          [neckties, neckwear, bowties, bolo, bola]
4     [[MASK] such as batsmen and [Z]., [MASK], incl...      [sluggers, batters, hitter, whiffer, bunters]
5     [[MASK] such as washers and [Z]., [MASK], incl...      [lockrings, gaskets, cottar, cringle, buckle]
...                                                 ...                                                ...
1257  [[MASK] such as typographies and [Z]., [MASK],...  [crafts, trades, lumbering, dressmaking, draft...
1258  [[MASK] such as tenches and [Z]., [MASK], incl...       [cyprinid, minnow, carp, goldfish, gudgeons]
1259  [[MASK] such as armies and [Z]., [MASK], inclu...          [armies, usa, legions, offices, agencies]
1260  [[MASK] such as frescoes and [Z]., [MASK], inc...                                          [MISSING]
1261  [[MASK] such as hare and [Z]., [MASK], includi...  [leveret, leporids, jackrabbits, rabbits, buff...

[1118 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/1118 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
 31%|███       | 342/1118 [01:00<02:16,  5.70it/s] 31%|███       | 342/1118 [01:20<02:16,  5.70it/s] 61%|██████    | 683/1118 [02:00<01:16,  5.69it/s] 61%|██████    | 683/1118 [02:20<01:16,  5.69it/s] 92%|█████████▏| 1032/1118 [03:00<00:14,  5.74it/s]100%|██████████| 1118/1118 [03:15<00:00,  5.72it/s]
  0%|          | 0/1118 [00:00<?, ?it/s] 15%|█▌        | 172/1118 [01:00<05:31,  2.85it/s] 15%|█▌        | 172/1118 [01:14<05:31,  2.85it/s] 31%|███       | 346/1118 [02:00<04:28,  2.87it/s] 31%|███       | 346/1118 [02:14<04:28,  2.87it/s] 46%|████▌     | 517/1118 [03:00<03:30,  2.86it/s] 46%|████▌     | 517/1118 [03:14<03:30,  2.86it/s] 62%|██████▏   | 694/1118 [04:01<02:26,  2.89it/s] 62%|██████▏   | 694/1118 [04:14<02:26,  2.89it/s] 77%|███████▋  | 862/1118 [05:01<01:29,  2.86it/s] 77%|███████▋  | 862/1118 [05:14<01:29,  2.86it/s] 93%|█████████▎| 1041/1118 [06:01<00:26,  2.90it/s] 93%|█████████▎| 1041/1118 [06:14<00:26,  2.90it/s]100%|██████████| 1118/1118 [06:28<00:00,  2.88it/s]
  sub_label   obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap            sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                           subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                          subj_anchors_wordnet_all  \
0   etching       [art]      IsA  [An etching is a [MASK]., An etching is an [MA...  [halftone, serigraphy, woodcut, lithography, p...     0             3      etching      etching  [an etching is a [MASK]., an etching is a type...  [an etching or [Z] is a [MASK]., an etching or...  [[MASK] such as etching., [MASK], including et...  [[MASK] such as etching and [Z]., [MASK], incl...  [such as etching and [MASK]., such as etching ...   etching etching etching            1  [drawing, illustration, painting, engraving, p...  {'drawing': -6.798399279520061, 'illustration'...  [drawing, painting, engraving, print, illustra...  {'drawing': -6.167860487330729, 'painting': -6...  [thing, technique, art, drawing, painting, wor...  {'things': -7.88263134598992, 'techniques': -8...  [aquatints, engraving, linecut, gravures, wood...  [aquatint, engraving, linecut, gravure, woodcut]  [aquatints, engraving, linecut, gravures, wood...  [aquatint, engraving, linecut, gravure, woodcut]   
2  dinghies      [boat]      IsA    [A dinghy is a [MASK]., A dinghy is an [MASK].]  [canoe, cockleshell, gig, rowboat, dory, yawl,...     3             2       dinghy     dinghies  [a dinghy is a [MASK]., a dinghy is a type of ...  [a dinghy or [Z] is a [MASK]., a dinghy or [Z]...  [[MASK] such as dinghies., [MASK], including d...  [[MASK] such as dinghies and [Z]., [MASK], inc...  [such as dinghies and [MASK]., such as dinghie...  dinghies dinghy dinghies            1  [aircraft, airship, yacht, boat, automobile, e...  {'aircraft': -6.9738131185113055, 'airship': -...  [boat, yacht, vessel, sailing, sail, ship, cra...  {'boat': -5.155298464348918, 'yacht': -5.60234...  [boat, thing, ship, sailing, vessel, yacht, cr...  {'boats': -4.961173063122545, 'things': -9.064...            [rowboats, dory, wherries, gigs, canoe]               [rowboat, dory, wherry, gig, canoe]           [rowboats, dory, wherries, gigs, canoes]               [rowboat, dory, wherry, gig, canoe]   
3       tie  [clothing]      IsA          [A tie is a [MASK]., A tie is an [MASK].]  [lanyard, gusset, eyelet, chenille, balk, stri...     5             2          tie          tie  [a tie is a [MASK]., a tie is a type of [MASK]...  [a tie or [Z] is a [MASK]., a tie or [Z] is a ...  [[MASK] such as tie., [MASK], including tie., ...  [[MASK] such as tie and [Z]., [MASK], includin...  [such as tie and [MASK]., such as tie or [MASK...               tie tie tie            1  [object, knot, order, anchor, agreement, arrow...  {'object': -8.206908354643717, 'knot': -9.0139...  [knot, shirt, belt, ribbon, jacket, clothing, ...  {'knot': -9.035804536093991, 'shirt': -10.4270...  [yes, thing, brand, yeah, tie, wins, problem, ...  {'yes': -8.920535460424064, 'things': -8.96685...            [necktie, neckwear, bowtie, bolo, bola]           [necktie, neckwear, bowtie, bolo, bola]          [neckties, neckwear, bowties, bolo, bola]           [necktie, neckwear, bowtie, bolo, bola]   
4   batsmen   [athlete]      IsA  [A batsman is a [MASK]., A batsman is an [MASK].]  [hurler, hitter, batter, pitcher, fielder, twi...     6             2      batsman      batsmen  [a batsman is a [MASK]., a batsman is a type o...  [a batsman or [Z] is a [MASK]., a batsman or [...  [[MASK] such as batsmen., [MASK], including ba...  [[MASK] such as batsmen and [Z]., [MASK], incl...  [such as batsmen and [MASK]., such as batsmen ...   batsmen batsman batsmen            1  [bowler, opener, outfielder, catcher, batter, ...  {'bowler': -6.232246258775115, 'opener': -7.88...  [cricketer, footballer, player, bowler, athlet...  {'cricketer': -7.3063472463640675, 'footballer...  [player, thing, batting, people, man, team, po...  {'players': -5.269524161883701, 'things': -11....      [sluggers, batters, hitter, whiffer, bunters]        [slugger, batter, hitter, whiffer, bunter]      [sluggers, batters, hitter, whiffer, bunters]        [slugger, batter, hitter, whiffer, bunter]   
5   washers    [worker]      IsA    [A washer is a [MASK]., A washer is an [MASK].]  [splicer, accumulator, sprigger, lamplighter, ...     7             2       washer      washers  [a washer is a [MASK]., a washer is a type of ...  [a washer or [Z] is a [MASK]., a washer or [Z]...  [[MASK] such as washers., [MASK], including wa...  [[MASK] such as washers and [Z]., [MASK], incl...  [such as washers and [MASK]., such as washers ...    washers washer washers            1  [oven, employee, apron, person, object, sink, ...  {'oven': -8.438302036169869, 'employee': -9.33...  [machine, toilet, laundry, sink, robot, person...  {'machine': -7.648520012840529, 'toilet': -8.4...  [woman, maids, assistant, appliance, worker, t...  {'women': -8.803567509180104, 'maids': -8.9984...      [lockrings, gaskets, cottar, cringle, buckle]       [lockring, gasket, cottar, cringle, buckle]      [lockrings, gaskets, cottar, cringle, buckle]       [lockring, gasket, cottar, cringle, buckle]   

      subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
0   etching etching etching           5  [an etching or an aquatint is a [MASK]., an et...  [[MASK] such as etching and aquatints., [MASK]...  [drawing, painting, print, engraving, illustra...  {'drawing': -6.967274759431782, 'painting': -7...  [technique, art, drawing, works, illustration,...  {'techniques': -7.783591898617945, 'art': -8.4...  
2  dinghies dinghy dinghies           5  [a dinghy or a rowboat is a [MASK]., a dinghy ...  [[MASK] such as dinghies and rowboats., [MASK]...  [boat, yacht, vessel, ship, sail, craft, saili...  {'boat': -4.756567863565407, 'yacht': -6.94642...  [boat, thing, vessel, ship, craft, venue, even...  {'boats': -5.164361225982595, 'things': -10.53...  
3               tie tie tie           5  [a tie or a necktie is a [MASK]., a tie or a n...  [[MASK] such as tie and neckties., [MASK] such...  [knot, scarf, dress, belt, cloth, shirt, cloth...  {'knot': -8.802973947485295, 'scarf': -10.9879...  [accessory, thing, clothing, tie, item, suit, ...  {'accessories': -7.500733550068882, 'things': ...  
4   batsmen batsman batsmen           5  [a batsman or a slugger is a [MASK]., a batsma...  [[MASK] such as batsmen and sluggers., [MASK] ...  [player, cricketer, bowler, footballer, pitche...  {'player': -7.517684124020566, 'cricketer': -8...  [player, thing, role, people, batting, positio...  {'players': -5.657681981182889, 'things': -10....  
5    washers washer washers           5  [a washer or a lockring is a [MASK]., a washer...  [[MASK] such as washers and lockrings., [MASK]...  [machine, toilet, tool, device, broom, handle,...  {'machine': -8.467693627330457, 'toilet': -8.6...  [accessory, appliance, tool, item, machine, th...  {'accessories': -8.578353010073554, 'appliance...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  47.7 	  76.7 	   76.7 	  58.5 
  1 	 subj_anchors_wordnet_all 	  47.7 	  76.7 	   76.7 	  58.5 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	  20.9 	  49.7 	   60.6 	  33.1 	              1 
  2 	 lsp_sap     	  20.3 	  47.7 	   58.4 	  31.7 	              3 
  3 	 def_dap     	  25.1 	  54.7 	   66.4 	  37.8 	              2 
  4 	 lsp_dap     	  24.1 	  53.6 	   66   	  36.8 	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/LEDS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.LEDS.tsv
save log/bert-large-uncased/hypernymsuite/LEDS/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.LEDS.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/SHWARTZ/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'SHWARTZ'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/SHWARTZ//IsA.jsonl
#All Instances: 12994
#Valid Instances: 12724 in SHWARTZ (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                 def_dap                            subj_anchors_wordnet_sg
4      [a bonehead or [Z] is a [MASK]., a bonehead or...                                          [MISSING]
5      [a nirvana or [Z] is a [MASK]., a nirvana or [...  [enlightenment, beatification, blessedness, be...
7      [a bogolin or [Z] is a [MASK]., a bogolin or [...                                          [MISSING]
8      [a maelstrom or [Z] is a [MASK]., a maelstrom ...  [whirlpool, vortex, charybdi, current, undertide]
10     [a witchery or [Z] is a [MASK]., a witchery or...  [witchcraft, sorcery, necromancy, demonism, sa...
...                                                  ...                                                ...
12717  [a cataract or [Z] is a [MASK]., a cataract or...  [retinopathy, keratonosus, trachoma, leucoma, ...
12719  [a fresco or [Z] is a [MASK]., a fresco or [Z]...                                          [MISSING]
12720  [a mongrel or [Z] is a [MASK]., a mongrel or [...                     [mutt, curs, dog, feist, fice]
12722  [a tronador or [Z] is a [MASK]., a tronador or...                                          [MISSING]
12723  [a repulsion or [Z] is a [MASK]., a repulsion ...  [repugnance, revulsion, abhorrence, torsion, a...

[6557 rows x 2 columns]
                                                 lsp_dap                            subj_anchors_wordnet_pl
4      [[MASK] such as boneheads and [Z]., [MASK], in...                                          [MISSING]
5      [[MASK] such as nirvana and [Z]., [MASK], incl...  [enlightenments, beatifications, blessednesses...
7      [[MASK] such as bogolins and [Z]., [MASK], inc...                                          [MISSING]
8      [[MASK] such as maelstrom and [Z]., [MASK], in...  [whirlpools, vortices, charybdis, current, und...
10     [[MASK] such as witcheries and [Z]., [MASK], i...  [witchcrafts, sorceries, necromancies, demonis...
...                                                  ...                                                ...
12717  [[MASK] such as cataract and [Z]., [MASK], inc...  [retinopathy, keratonosus, trachomas, leucoma,...
12719  [[MASK] such as frescoes and [Z]., [MASK], inc...                                          [MISSING]
12720  [[MASK] such as mongrel and [Z]., [MASK], incl...                 [mutts, curs, dogs, feists, fices]
12722  [[MASK] such as tronadors and [Z]., [MASK], in...                                          [MISSING]
12723  [[MASK] such as repulsions and [Z]., [MASK], i...  [repugnances, revulsions, abhorrence, torsions...

[6557 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/6557 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
  7%|▋         | 461/6557 [01:00<13:13,  7.68it/s]  7%|▋         | 461/6557 [01:10<13:13,  7.68it/s] 15%|█▍        | 965/6557 [02:00<11:30,  8.10it/s] 15%|█▍        | 965/6557 [02:20<11:30,  8.10it/s] 22%|██▏       | 1425/6557 [03:00<10:49,  7.90it/s] 22%|██▏       | 1425/6557 [03:20<10:49,  7.90it/s] 29%|██▉       | 1891/6557 [04:00<09:55,  7.84it/s] 29%|██▉       | 1891/6557 [04:20<09:55,  7.84it/s] 36%|███▌      | 2351/6557 [05:00<09:01,  7.77it/s] 36%|███▌      | 2351/6557 [05:20<09:01,  7.77it/s] 43%|████▎     | 2827/6557 [06:00<07:56,  7.82it/s] 43%|████▎     | 2827/6557 [06:20<07:56,  7.82it/s] 50%|█████     | 3285/6557 [07:00<07:01,  7.76it/s] 50%|█████     | 3285/6557 [07:20<07:01,  7.76it/s] 57%|█████▋    | 3730/6557 [08:00<06:09,  7.64it/s] 57%|█████▋    | 3730/6557 [08:20<06:09,  7.64it/s] 64%|██████▍   | 4190/6557 [09:00<05:09,  7.65it/s] 64%|██████▍   | 4190/6557 [09:20<05:09,  7.65it/s] 71%|███████   | 4646/6557 [10:00<04:10,  7.63it/s] 71%|███████   | 4646/6557 [10:20<04:10,  7.63it/s] 78%|███████▊  | 5095/6557 [11:00<03:12,  7.58it/s] 78%|███████▊  | 5095/6557 [11:20<03:12,  7.58it/s] 85%|████████▍ | 5563/6557 [12:01<02:10,  7.64it/s] 85%|████████▍ | 5563/6557 [12:20<02:10,  7.64it/s] 92%|█████████▏| 6027/6557 [13:01<01:09,  7.67it/s] 92%|█████████▏| 6027/6557 [13:20<01:09,  7.67it/s] 98%|█████████▊| 6458/6557 [14:01<00:13,  7.52it/s]100%|██████████| 6557/6557 [14:14<00:00,  7.67it/s]
  0%|          | 0/6557 [00:00<?, ?it/s]  3%|▎         | 228/6557 [01:00<27:47,  3.80it/s]  3%|▎         | 228/6557 [01:15<27:47,  3.80it/s]  7%|▋         | 460/6557 [02:00<26:34,  3.82it/s]  7%|▋         | 460/6557 [02:15<26:34,  3.82it/s] 11%|█         | 711/6557 [03:00<24:27,  3.98it/s] 11%|█         | 711/6557 [03:15<24:27,  3.98it/s] 15%|█▍        | 961/6557 [04:00<23:01,  4.05it/s] 15%|█▍        | 961/6557 [04:15<23:01,  4.05it/s] 18%|█▊        | 1191/6557 [05:00<22:32,  3.97it/s] 18%|█▊        | 1191/6557 [05:15<22:32,  3.97it/s] 22%|██▏       | 1417/6557 [06:00<21:58,  3.90it/s] 22%|██▏       | 1417/6557 [06:15<21:58,  3.90it/s] 25%|██▌       | 1658/6557 [07:01<20:44,  3.94it/s] 25%|██▌       | 1658/6557 [07:15<20:44,  3.94it/s] 29%|██▊       | 1876/6557 [08:01<20:20,  3.84it/s] 29%|██▊       | 1876/6557 [08:15<20:20,  3.84it/s] 32%|███▏      | 2111/6557 [09:01<19:12,  3.86it/s] 32%|███▏      | 2111/6557 [09:15<19:12,  3.86it/s] 36%|███▌      | 2337/6557 [10:01<18:23,  3.82it/s] 36%|███▌      | 2337/6557 [10:15<18:23,  3.82it/s] 39%|███▉      | 2580/6557 [11:02<17:03,  3.89it/s] 39%|███▉      | 2580/6557 [11:15<17:03,  3.89it/s] 43%|████▎     | 2811/6557 [12:02<16:08,  3.87it/s] 43%|████▎     | 2811/6557 [12:15<16:08,  3.87it/s] 46%|████▋     | 3035/6557 [13:02<15:20,  3.83it/s] 46%|████▋     | 3035/6557 [13:15<15:20,  3.83it/s] 50%|████▉     | 3259/6557 [14:02<14:28,  3.80it/s] 50%|████▉     | 3259/6557 [14:15<14:28,  3.80it/s] 53%|█████▎    | 3491/6557 [15:02<13:24,  3.81it/s] 53%|█████▎    | 3491/6557 [15:15<13:24,  3.81it/s] 57%|█████▋    | 3708/6557 [16:03<12:40,  3.75it/s] 57%|█████▋    | 3708/6557 [16:15<12:40,  3.75it/s] 60%|█████▉    | 3933/6557 [17:03<11:40,  3.74it/s] 60%|█████▉    | 3933/6557 [17:15<11:40,  3.74it/s] 63%|██████▎   | 4161/6557 [18:03<10:37,  3.76it/s] 63%|██████▎   | 4161/6557 [18:15<10:37,  3.76it/s] 67%|██████▋   | 4395/6557 [19:03<09:29,  3.80it/s] 67%|██████▋   | 4395/6557 [19:15<09:29,  3.80it/s] 70%|███████   | 4613/6557 [20:03<08:38,  3.75it/s] 70%|███████   | 4613/6557 [20:15<08:38,  3.75it/s] 74%|███████▍  | 4838/6557 [21:04<07:39,  3.74it/s] 74%|███████▍  | 4838/6557 [21:15<07:39,  3.74it/s] 77%|███████▋  | 5058/6557 [22:04<06:43,  3.72it/s] 77%|███████▋  | 5058/6557 [22:15<06:43,  3.72it/s] 81%|████████  | 5296/6557 [23:04<05:32,  3.79it/s] 81%|████████  | 5296/6557 [23:15<05:32,  3.79it/s] 84%|████████▍ | 5522/6557 [24:04<04:33,  3.78it/s] 84%|████████▍ | 5522/6557 [24:15<04:33,  3.78it/s] 88%|████████▊ | 5754/6557 [25:04<03:31,  3.80it/s] 88%|████████▊ | 5754/6557 [25:15<03:31,  3.80it/s] 91%|█████████▏| 5993/6557 [26:04<02:26,  3.85it/s] 91%|█████████▏| 5993/6557 [26:15<02:26,  3.85it/s] 95%|█████████▍| 6208/6557 [27:04<01:32,  3.77it/s] 95%|█████████▍| 6208/6557 [27:15<01:32,  3.77it/s] 98%|█████████▊| 6425/6557 [28:05<00:35,  3.72it/s] 98%|█████████▊| 6425/6557 [28:15<00:35,  3.72it/s]100%|██████████| 6557/6557 [28:39<00:00,  3.81it/s]
     sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                  sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
4    boneheads     [band]      IsA  [A bonehead is a [MASK]., A bonehead is an [MA...  [knucklehead, hammerhead, loggerhead, dumbass,...     4             2     bonehead    boneheads  [a bonehead is a [MASK]., a bonehead is a type...  [a bonehead or [Z] is a [MASK]., a bonehead or...  [[MASK] such as boneheads., [MASK], including ...  [[MASK] such as boneheads and [Z]., [MASK], in...  [such as boneheads and [MASK]., such as bonehe...    boneheads bonehead boneheads            1  [animal, individual, actor, insect, anchor, el...  {'animal': -7.760352993909391, 'individual': -...  [fish, turtle, bird, bone, animal, catfish, pi...  {'fish': -9.285614179926169, 'turtle': -9.8092...  [yeah, bone, people, thing, animal, band, yes,...  {'yeah': -8.830292573364021, 'bones': -9.55534...                                          [MISSING]                                          [MISSING]                                          [MISSING]                                          [MISSING]   
5      nirvana    [album]      IsA  [A nirvana is a [MASK]., A nirvana is an [MASK].]  [air, inside, zone, top, vacuity, hell, county...     5             2      nirvana      nirvana  [a nirvana is a [MASK]., a nirvana is a type o...  [a nirvana or [Z] is a [MASK]., a nirvana or [...  [[MASK] such as nirvana., [MASK], including ni...  [[MASK] such as nirvana and [Z]., [MASK], incl...  [such as nirvana and [MASK]., such as nirvana ...         nirvana nirvana nirvana            1  [absolute, emptiness, illusion, place, orgasm,...  {'absolute': -9.548287603994723, 'emptiness': ...  [paradise, building, bliss, house, heaven, uto...  {'paradise': -8.991536014932738, 'building': -...  [poems, story, music, thing, place, writings, ...  {'poems': -8.578334052140976, 'stories': -8.68...  [enlightenments, beatifications, blessednesses...  [enlightenment, beatification, blessedness, be...  [enlightenments, beatifications, blessednesses...  [enlightenment, beatification, blessedness, be...   
7     bogolins  [village]      IsA  [A bogolin is a [MASK]., A bogolin is an [MASK].]                                                 []     7             2      bogolin     bogolins  [a bogolin is a [MASK]., a bogolin is a type o...  [a bogolin or [Z] is a [MASK]., a bogolin or [...  [[MASK] such as bogolins., [MASK], including b...  [[MASK] such as bogolins and [Z]., [MASK], inc...  [such as bogolins and [MASK]., such as bogolin...       bogolins bogolin bogolins            1  [animal, elephant, insect, archer, asteroid, e...  {'animal': -8.336883302933115, 'elephant': -10...  [pig, dog, sausage, horse, cannon, fish, log, ...  {'pig': -10.39650824033111, 'dog': -11.0473997...  [thing, animal, bird, dog, fish, species, peop...  {'things': -10.210964390926904, 'animals': -10...                                          [MISSING]                                          [MISSING]                                          [MISSING]                                          [MISSING]   
8    maelstrom     [book]      IsA  [A maelstrom is a [MASK]., A maelstrom is an [...  [whirlpool, vortex, twist, riptide, torrent, u...     8             2    maelstrom    maelstrom  [a maelstrom is a [MASK]., a maelstrom is a ty...  [a maelstrom or [Z] is a [MASK]., a maelstrom ...  [[MASK] such as maelstrom., [MASK], including ...  [[MASK] such as maelstrom and [Z]., [MASK], in...  [such as maelstrom and [MASK]., such as maelst...   maelstrom maelstrom maelstrom            1  [avalanche, illusion, storm, abyss, event, wat...  {'avalanche': -7.353038456850604, 'illusion': ...  [storm, avalanche, waterfall, landslide, disas...  {'storm': -7.503555647031791, 'avalanche': -8....  [hell, yes, story, event, storm, works, film, ...  {'hell': -9.531064860314544, 'yes': -9.5784095...  [whirlpool, vortex, charybdis, current, undert...  [whirlpool, vortex, charybdi, current, undertide]  [whirlpools, vortices, charybdis, current, und...  [whirlpool, vortex, charybdi, current, undertide]   
10  witcheries     [film]      IsA  [A witchery is a [MASK]., A witchery is an [MA...  [diabolism, witchcraft, enchantment, demonism,...    10             2     witchery   witcheries  [a witchery is a [MASK]., a witchery is a type...  [a witchery or [Z] is a [MASK]., a witchery or...  [[MASK] such as witcheries., [MASK], including...  [[MASK] such as witcheries and [Z]., [MASK], i...  [such as witcheries and [MASK]., such as witch...  witcheries witchery witcheries            1  [illusion, witch, evil, coven, art, witchcraft...  {'illusion': -7.40947151763448, 'witch': -7.50...  [witchcraft, witch, coven, magic, shop, bakery...  {'witchcraft': -7.1989752767408035, 'witch': -...  [witch, witchcraft, thing, place, ritual, inst...  {'witches': -7.678177575181099, 'witchcraft': ...  [witchcrafts, sorceries, necromancies, demonis...  [witchcraft, sorcery, necromancy, demonism, sa...  [witchcrafts, sorceries, necromancies, demonis...  [witchcraft, sorcery, necromancy, demonism, sa...   

             subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
4     boneheads bonehead boneheads           1  [a bonehead or [Z] is a [MASK]., a bonehead or...  [[MASK] such as boneheads and [Z]., [MASK], in...  [bone, skull, fish, turtle, nail, rock, bird, ...  {'bone': -6.986862514593536, 'skull': -10.0750...  [band, thing, artist, group, people, punk, ani...  {'bands': -8.74537531909171, 'things': -9.2003...  
5          nirvana nirvana nirvana           5  [a nirvana or an enlightenment is a [MASK]., a...  [[MASK] such as nirvana and enlightenments., [...  [miracle, light, meditation, paradise, prayer,...  {'miracle': -9.26951433548801, 'light': -9.561...  [concept, thing, spirituality, practice, relig...  {'concepts': -8.771203189917266, 'things': -9....  
7        bogolins bogolin bogolins           1  [a bogolin or [Z] is a [MASK]., a bogolin or [...  [[MASK] such as bogolins and [Z]., [MASK], inc...  [grape, horn, string, coin, rock, particle, sa...  {'grape': -10.268551742528098, 'horn': -10.554...  [word, poems, story, name, thing, term, works,...  {'words': -9.280488363218304, 'poems': -9.4037...  
8    maelstrom maelstrom maelstrom           5  [a maelstrom or a whirlpool is a [MASK]., a ma...  [[MASK] such as maelstrom and whirlpools., [MA...  [storm, phenomenon, vortex, tornado, waterfall...  {'storm': -7.392626308129375, 'phenomenon': -9...  [storm, phenomenon, event, tolkien, game, stor...  {'storms': -9.494476394127634, 'phenomena': -9...  
10  witcheries witchery witcheries           5  [a witchery or a witchcraft is a [MASK]., a wi...  [[MASK] such as witcheries and witchcrafts., [...  [witchcraft, magic, religion, witch, spell, cr...  {'witchcraft': -6.2583859711318235, 'magic': -...  [witchcraft, thing, witch, practice, religion,...  {'witchcraft': -7.677477828798978, 'things': -...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  52.2 	  78.2 	   78.2 	  62.2 
  1 	 subj_anchors_wordnet_all 	  52.2 	  78.2 	   78.2 	  62.2 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	   5   	  11.5 	   14.8 	   7.8 	              1 
  2 	 lsp_sap     	   4.6 	  13   	   18.5 	   8.4 	              3 
  3 	 def_dap     	   6.1 	  12.6 	   15.6 	   8.9 	              2 
  4 	 lsp_dap     	   5.3 	  13.7 	   18.8 	   9   	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/SHWARTZ/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.SHWARTZ.tsv
save log/bert-large-uncased/hypernymsuite/SHWARTZ/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.SHWARTZ.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/SHWARTZ/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'SHWARTZ'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/SHWARTZ//IsA.jsonl
#All Instances: 12994
#Valid Instances: 12724 in SHWARTZ (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                 def_dap                            subj_anchors_wordnet_sg
4      [a bonehead or [Z] is a [MASK]., a bonehead or...                                          [MISSING]
5      [a nirvana or [Z] is a [MASK]., a nirvana or [...  [enlightenment, beatification, blessedness, be...
7      [a bogolin or [Z] is a [MASK]., a bogolin or [...                                          [MISSING]
8      [a maelstrom or [Z] is a [MASK]., a maelstrom ...       [whirlpool, vortex, charybdi, current, eddy]
10     [a witchery or [Z] is a [MASK]., a witchery or...  [witchcraft, necromancy, sorcery, demonism, di...
...                                                  ...                                                ...
12717  [a cataract or [Z] is a [MASK]., a cataract or...  [leukoma, drusen, glaucoma, retinopathy, trach...
12719  [a fresco or [Z] is a [MASK]., a fresco or [Z]...                                          [MISSING]
12720  [a mongrel or [Z] is a [MASK]., a mongrel or [...                     [mutt, curs, dog, feist, fice]
12722  [a tronador or [Z] is a [MASK]., a tronador or...                                          [MISSING]
12723  [a repulsion or [Z] is a [MASK]., a repulsion ...  [revulsion, repugnance, nausea, propulsion, at...

[6557 rows x 2 columns]
                                                 lsp_dap                            subj_anchors_wordnet_pl
4      [[MASK] such as boneheads and [Z]., [MASK], in...                                          [MISSING]
5      [[MASK] such as nirvana and [Z]., [MASK], incl...  [enlightenments, beatifications, blessednesses...
7      [[MASK] such as bogolins and [Z]., [MASK], inc...                                          [MISSING]
8      [[MASK] such as maelstrom and [Z]., [MASK], in...  [whirlpools, vortices, charybdis, current, edd...
10     [[MASK] such as witcheries and [Z]., [MASK], i...  [witchcrafts, necromancies, sorceries, demonis...
...                                                  ...                                                ...
12717  [[MASK] such as cataract and [Z]., [MASK], inc...  [leukomas, drusen, glaucoma, retinopathy, trac...
12719  [[MASK] such as frescoes and [Z]., [MASK], inc...                                          [MISSING]
12720  [[MASK] such as mongrel and [Z]., [MASK], incl...                 [mutts, curs, dogs, feists, fices]
12722  [[MASK] such as tronadors and [Z]., [MASK], in...                                          [MISSING]
12723  [[MASK] such as repulsions and [Z]., [MASK], i...  [revulsions, repugnances, nauseas, propulsions...

[6557 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/6557 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
  7%|▋         | 463/6557 [01:00<13:11,  7.70it/s]  7%|▋         | 463/6557 [01:20<13:11,  7.70it/s] 15%|█▍        | 968/6557 [02:00<11:29,  8.11it/s] 15%|█▍        | 968/6557 [02:20<11:29,  8.11it/s] 22%|██▏       | 1427/6557 [03:00<10:49,  7.90it/s] 22%|██▏       | 1427/6557 [03:20<10:49,  7.90it/s] 29%|██▉       | 1892/6557 [04:00<09:55,  7.83it/s] 29%|██▉       | 1892/6557 [04:20<09:55,  7.83it/s] 36%|███▌      | 2351/6557 [05:00<09:01,  7.77it/s] 36%|███▌      | 2351/6557 [05:20<09:01,  7.77it/s] 43%|████▎     | 2827/6557 [06:00<07:56,  7.82it/s] 43%|████▎     | 2827/6557 [06:20<07:56,  7.82it/s] 50%|█████     | 3284/6557 [07:00<07:02,  7.75it/s] 50%|█████     | 3284/6557 [07:20<07:02,  7.75it/s] 57%|█████▋    | 3729/6557 [08:00<06:10,  7.64it/s] 57%|█████▋    | 3729/6557 [08:20<06:10,  7.64it/s] 64%|██████▍   | 4189/6557 [09:00<05:09,  7.65it/s] 64%|██████▍   | 4189/6557 [09:20<05:09,  7.65it/s] 71%|███████   | 4644/6557 [10:00<04:10,  7.62it/s] 71%|███████   | 4644/6557 [10:20<04:10,  7.62it/s] 78%|███████▊  | 5093/6557 [11:00<03:13,  7.58it/s] 78%|███████▊  | 5093/6557 [11:20<03:13,  7.58it/s] 85%|████████▍ | 5560/6557 [12:00<02:10,  7.64it/s] 85%|████████▍ | 5560/6557 [12:20<02:10,  7.64it/s] 92%|█████████▏| 6023/6557 [13:00<01:09,  7.66it/s] 92%|█████████▏| 6023/6557 [13:20<01:09,  7.66it/s] 98%|█████████▊| 6455/6557 [14:01<00:13,  7.52it/s]100%|██████████| 6557/6557 [14:14<00:00,  7.67it/s]
  0%|          | 0/6557 [00:00<?, ?it/s]  3%|▎         | 227/6557 [01:00<28:02,  3.76it/s]  3%|▎         | 227/6557 [01:15<28:02,  3.76it/s]  7%|▋         | 461/6557 [02:00<26:27,  3.84it/s]  7%|▋         | 461/6557 [02:15<26:27,  3.84it/s] 11%|█         | 715/6557 [03:00<24:16,  4.01it/s] 11%|█         | 715/6557 [03:15<24:16,  4.01it/s] 15%|█▍        | 970/6557 [04:00<22:43,  4.10it/s] 15%|█▍        | 970/6557 [04:15<22:43,  4.10it/s] 18%|█▊        | 1200/6557 [05:01<22:21,  3.99it/s] 18%|█▊        | 1200/6557 [05:15<22:21,  3.99it/s] 22%|██▏       | 1433/6557 [06:01<21:35,  3.96it/s] 22%|██▏       | 1433/6557 [06:15<21:35,  3.96it/s] 26%|██▌       | 1678/6557 [07:01<20:21,  3.99it/s] 26%|██▌       | 1678/6557 [07:15<20:21,  3.99it/s] 29%|██▉       | 1898/6557 [08:01<19:59,  3.88it/s] 29%|██▉       | 1898/6557 [08:15<19:59,  3.88it/s] 33%|███▎      | 2133/6557 [09:01<18:57,  3.89it/s] 33%|███▎      | 2133/6557 [09:15<18:57,  3.89it/s] 36%|███▌      | 2364/6557 [10:02<18:02,  3.87it/s] 36%|███▌      | 2364/6557 [10:15<18:02,  3.87it/s] 40%|███▉      | 2605/6557 [11:02<16:49,  3.92it/s] 40%|███▉      | 2605/6557 [11:15<16:49,  3.92it/s] 43%|████▎     | 2839/6557 [12:02<15:50,  3.91it/s] 43%|████▎     | 2839/6557 [12:15<15:50,  3.91it/s] 47%|████▋     | 3066/6557 [13:02<15:02,  3.87it/s] 47%|████▋     | 3066/6557 [13:15<15:02,  3.87it/s] 50%|█████     | 3300/6557 [14:02<14:00,  3.87it/s] 50%|█████     | 3300/6557 [14:15<14:00,  3.87it/s] 54%|█████▍    | 3531/6557 [15:02<13:03,  3.86it/s] 54%|█████▍    | 3531/6557 [15:15<13:03,  3.86it/s] 57%|█████▋    | 3746/6557 [16:03<12:24,  3.78it/s] 57%|█████▋    | 3746/6557 [16:15<12:24,  3.78it/s] 61%|██████    | 3975/6557 [17:03<11:22,  3.79it/s] 61%|██████    | 3975/6557 [17:15<11:22,  3.79it/s] 64%|██████▍   | 4209/6557 [18:03<10:14,  3.82it/s] 64%|██████▍   | 4209/6557 [18:15<10:14,  3.82it/s] 68%|██████▊   | 4439/6557 [19:03<09:14,  3.82it/s] 68%|██████▊   | 4439/6557 [19:15<09:14,  3.82it/s] 71%|███████   | 4663/6557 [20:03<08:19,  3.79it/s] 71%|███████   | 4663/6557 [20:15<08:19,  3.79it/s] 75%|███████▍  | 4893/6557 [21:03<07:17,  3.80it/s] 75%|███████▍  | 4893/6557 [21:15<07:17,  3.80it/s] 78%|███████▊  | 5121/6557 [22:03<06:17,  3.80it/s] 78%|███████▊  | 5121/6557 [22:15<06:17,  3.80it/s] 82%|████████▏ | 5356/6557 [23:03<05:13,  3.83it/s] 82%|████████▏ | 5356/6557 [23:15<05:13,  3.83it/s] 85%|████████▌ | 5595/6557 [24:03<04:08,  3.88it/s] 85%|████████▌ | 5595/6557 [24:15<04:08,  3.88it/s] 89%|████████▉ | 5832/6557 [25:03<03:05,  3.90it/s] 89%|████████▉ | 5832/6557 [25:15<03:05,  3.90it/s] 92%|█████████▏| 6056/6557 [26:04<02:10,  3.84it/s] 92%|█████████▏| 6056/6557 [26:15<02:10,  3.84it/s] 96%|█████████▌| 6281/6557 [27:04<01:12,  3.81it/s] 96%|█████████▌| 6281/6557 [27:15<01:12,  3.81it/s] 99%|█████████▉| 6498/6557 [28:04<00:15,  3.75it/s] 99%|█████████▉| 6498/6557 [28:15<00:15,  3.75it/s]100%|██████████| 6557/6557 [28:19<00:00,  3.86it/s]
     sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                  sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
4    boneheads     [band]      IsA  [A bonehead is a [MASK]., A bonehead is an [MA...  [knucklehead, hammerhead, loggerhead, dumbass,...     4             2     bonehead    boneheads  [a bonehead is a [MASK]., a bonehead is a type...  [a bonehead or [Z] is a [MASK]., a bonehead or...  [[MASK] such as boneheads., [MASK], including ...  [[MASK] such as boneheads and [Z]., [MASK], in...  [such as boneheads and [MASK]., such as bonehe...    boneheads bonehead boneheads            1  [animal, individual, actor, insect, anchor, el...  {'animal': -7.760352993909391, 'individual': -...  [fish, turtle, bird, bone, animal, catfish, pi...  {'fish': -9.285614179926169, 'turtle': -9.8092...  [yeah, bone, people, thing, animal, band, yes,...  {'yeah': -8.830292573364021, 'bones': -9.55534...                                          [MISSING]                                          [MISSING]                                          [MISSING]                                          [MISSING]   
5      nirvana    [album]      IsA  [A nirvana is a [MASK]., A nirvana is an [MASK].]  [air, inside, zone, top, vacuity, hell, county...     5             2      nirvana      nirvana  [a nirvana is a [MASK]., a nirvana is a type o...  [a nirvana or [Z] is a [MASK]., a nirvana or [...  [[MASK] such as nirvana., [MASK], including ni...  [[MASK] such as nirvana and [Z]., [MASK], incl...  [such as nirvana and [MASK]., such as nirvana ...         nirvana nirvana nirvana            1  [absolute, emptiness, illusion, place, orgasm,...  {'absolute': -9.548287603994723, 'emptiness': ...  [paradise, building, bliss, house, heaven, uto...  {'paradise': -8.991536014932738, 'building': -...  [poems, story, music, thing, place, writings, ...  {'poems': -8.578334052140976, 'stories': -8.68...  [enlightenments, beatifications, blessednesses...  [enlightenment, beatification, blessedness, be...  [enlightenments, beatifications, blessednesses...  [enlightenment, beatification, blessedness, be...   
7     bogolins  [village]      IsA  [A bogolin is a [MASK]., A bogolin is an [MASK].]                                                 []     7             2      bogolin     bogolins  [a bogolin is a [MASK]., a bogolin is a type o...  [a bogolin or [Z] is a [MASK]., a bogolin or [...  [[MASK] such as bogolins., [MASK], including b...  [[MASK] such as bogolins and [Z]., [MASK], inc...  [such as bogolins and [MASK]., such as bogolin...       bogolins bogolin bogolins            1  [animal, elephant, insect, archer, asteroid, e...  {'animal': -8.336883302933115, 'elephant': -10...  [pig, dog, sausage, horse, cannon, fish, log, ...  {'pig': -10.39650824033111, 'dog': -11.0473997...  [thing, animal, bird, dog, fish, species, peop...  {'things': -10.210964390926904, 'animals': -10...                                          [MISSING]                                          [MISSING]                                          [MISSING]                                          [MISSING]   
8    maelstrom     [book]      IsA  [A maelstrom is a [MASK]., A maelstrom is an [...  [whirlpool, vortex, twist, riptide, torrent, u...     8             2    maelstrom    maelstrom  [a maelstrom is a [MASK]., a maelstrom is a ty...  [a maelstrom or [Z] is a [MASK]., a maelstrom ...  [[MASK] such as maelstrom., [MASK], including ...  [[MASK] such as maelstrom and [Z]., [MASK], in...  [such as maelstrom and [MASK]., such as maelst...   maelstrom maelstrom maelstrom            1  [avalanche, illusion, storm, abyss, event, wat...  {'avalanche': -7.353038456850604, 'illusion': ...  [storm, avalanche, waterfall, landslide, disas...  {'storm': -7.503555647031791, 'avalanche': -8....  [hell, yes, story, event, storm, works, film, ...  {'hell': -9.531064860314544, 'yes': -9.5784095...      [whirlpool, vortex, charybdis, current, eddy]       [whirlpool, vortex, charybdi, current, eddy]  [whirlpools, vortices, charybdis, current, edd...       [whirlpool, vortex, charybdi, current, eddy]   
10  witcheries     [film]      IsA  [A witchery is a [MASK]., A witchery is an [MA...  [diabolism, witchcraft, enchantment, demonism,...    10             2     witchery   witcheries  [a witchery is a [MASK]., a witchery is a type...  [a witchery or [Z] is a [MASK]., a witchery or...  [[MASK] such as witcheries., [MASK], including...  [[MASK] such as witcheries and [Z]., [MASK], i...  [such as witcheries and [MASK]., such as witch...  witcheries witchery witcheries            1  [illusion, witch, evil, coven, art, witchcraft...  {'illusion': -7.40947151763448, 'witch': -7.50...  [witchcraft, witch, coven, magic, shop, bakery...  {'witchcraft': -7.1989752767408035, 'witch': -...  [witch, witchcraft, thing, place, ritual, inst...  {'witches': -7.678177575181099, 'witchcraft': ...  [witchcrafts, necromancies, sorceries, demonis...  [witchcraft, necromancy, sorcery, demonism, di...  [witchcrafts, necromancies, sorceries, demonis...  [witchcraft, necromancy, sorcery, demonism, di...   

             subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
4     boneheads bonehead boneheads           1  [a bonehead or [Z] is a [MASK]., a bonehead or...  [[MASK] such as boneheads and [Z]., [MASK], in...  [bone, skull, fish, turtle, nail, rock, bird, ...  {'bone': -6.986862514593536, 'skull': -10.0750...  [band, thing, artist, group, people, punk, ani...  {'bands': -8.74537531909171, 'things': -9.2003...  
5          nirvana nirvana nirvana           5  [a nirvana or an enlightenment is a [MASK]., a...  [[MASK] such as nirvana and enlightenments., [...  [miracle, light, meditation, paradise, prayer,...  {'miracle': -9.26951433548801, 'light': -9.561...  [concept, thing, spirituality, practice, relig...  {'concepts': -8.771203189917266, 'things': -9....  
7        bogolins bogolin bogolins           1  [a bogolin or [Z] is a [MASK]., a bogolin or [...  [[MASK] such as bogolins and [Z]., [MASK], inc...  [grape, horn, string, coin, rock, particle, sa...  {'grape': -10.268551742528098, 'horn': -10.554...  [word, poems, story, name, thing, term, works,...  {'words': -9.280488363218304, 'poems': -9.4037...  
8    maelstrom maelstrom maelstrom           5  [a maelstrom or a whirlpool is a [MASK]., a ma...  [[MASK] such as maelstrom and whirlpools., [MA...  [storm, phenomenon, vortex, cyclone, tornado, ...  {'storm': -7.166365438419527, 'phenomenon': -9...  [phenomenon, storm, thing, event, tolkien, gam...  {'phenomena': -9.08447417334702, 'storms': -9....  
10  witcheries witchery witcheries           5  [a witchery or a witchcraft is a [MASK]., a wi...  [[MASK] such as witcheries and witchcrafts., [...  [witchcraft, magic, poison, spell, witch, ritu...  {'witchcraft': -6.303737754257231, 'magic': -7...  [witchcraft, thing, witch, practice, magic, sp...  {'witchcraft': -7.723682287403004, 'things': -...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  51.9 	    78 	     78 	  61.9 
  1 	 subj_anchors_wordnet_all 	  51.9 	    78 	     78 	  61.9 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	   5   	  11.5 	   14.8 	   7.8 	              1 
  2 	 lsp_sap     	   4.6 	  13   	   18.5 	   8.4 	              3 
  3 	 def_dap     	   6.2 	  12.4 	   15.5 	   8.9 	              2 
  4 	 lsp_dap     	   5.3 	  13.7 	   18.7 	   9   	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/SHWARTZ/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.SHWARTZ.tsv
save log/bert-large-uncased/hypernymsuite/SHWARTZ/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.SHWARTZ.csv
debug: False
---------------------------------------- config ----------------------------------------
{'debug': False, 'test_relations': ['IsA'], 'save_all_data': True, 'top_k': 10, 'data_dir': 'data/hypernymsuite/SHWARTZ/', 'mask_string_mapping': {'bert-large-uncased': '[MASK]'}, 'use_dap_global': True, 'return_probs': True, 'anchor_scorer_list': ['probAvg'], 'scorer_target_1_prompt': 'probSum', 'scorer_target_N_prompts': 'freqProbLogSum', 'use_original_prompt': True, 'original_prompt_source': 'masked_sentence', 'incorporate_operations': ['concate_or_single'], 'filter_anchors_flag': True, 'filter_objects_flag': True, 'cpt_only': False, 'anchor_types': ['Coordinate_remove_Y_PUNC_FULL'], 'add_cpt_score': False, 'constrain_targets': False, 'only_wordnet_anchor': True, 'add_wordnet_path_score': False, 'add_wordnet_filter': False, 'anchor_probe': 'plural_probe', 'anchor_col_prefix': 'subj_anchors_wordnet', 'anchor_col': 'subj_anchors_swow', 'anchor_col_sg': 'subj_anchors_swow_sg', 'anchor_col_pl': 'subj_anchors_swow_pl', 'anchor_col_all': 'anchor_col_all', 'filter_objects_with_input': True, 'sub_col': 'sub_label', 'sub_col_sg': 'sub_label_sg', 'sub_col_pl': 'sub_label_pl', 'top_k_anchors': 5, 'max_anchor_num_list': [10], 'max_anchor_num': 10, 'sub_col_sgpl': 'sub_label_sgpl', 'filter_objects_with_anchors': False, 'oracle_anchor_inserted': False, 'use_oracle_anchor': True, 'anchor_source': 'WordNet', 'only_swow_anchor': False, 'add_swow_score': False, 'swow_score_source': 'None', 'add_swow_filter': False, 'dataset': 'SHWARTZ'}
---------------------------------------- config ----------------------------------------
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
reading cohyponyms: pre_post_process/log/word_to_cohyponyms_score_pl.json
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-large-uncased were not used when initializing BertForMaskedLM: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
---------------------------------------- bert-large-uncased-anchor_type: Coordinate_remove_Y_PUNC_FULL-scorer_anchor:probAvg-op:concate_or_single ----------------------------------------
{
    "IsA": {
        "relation": "IsA",
        "def_sap": [
            "[X] is a [MASK].",
            "[X] is a type of [MASK].",
            "[X] is a kind of [MASK]."
        ],
        "def_dap": [
            "[X] or [Z] is a [MASK].",
            "[X] or [Z] is a type of [MASK].",
            "[X] or [Z] is a kind of [MASK]."
        ],
        "lsp_sap": [
            "[MASK] such as [X].",
            "[MASK], including [X].",
            "[MASK], especially [X].",
            "[X] or other [MASK].",
            "[X] and other [MASK].",
            "such [MASK] as [X]."
        ],
        "lsp_dap": [
            "[MASK] such as [X] and [Z].",
            "[MASK], including [X] and [Z].",
            "[MASK], especially [X] and [Z].",
            "[X], [Z] and other [MASK].",
            "[X], [Z] or other [MASK].",
            "such [MASK] as [X] and [Z]."
        ],
        "use_dap": true,
        "anchor_target": "[X]",
        "anchor_lsp_sap": [
            "such as [X] and [MASK].",
            "such as [X] or [MASK].",
            "such as [X], [MASK],",
            "including [X] and [MASK].",
            "including [X] or [MASK].",
            "including [X], [MASK],",
            "especially [X] and [MASK].",
            "especially [X] or [MASK].",
            "especially [X], [MASK],",
            "[X], [MASK] or other",
            "[X], [MASK] and other"
        ]
    }
}
Processing IsA ... data/hypernymsuite/SHWARTZ//IsA.jsonl
#All Instances: 12994
#Valid Instances: 12724 in SHWARTZ (hyper in BERT)
	 step1: get anchors (fill and filter)
/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
--- def_sap
--- lsp_sap
relation: IsA 	 use_dap: True
	 step2: insert anchors
sub_col sub_label
                                                 def_dap                            subj_anchors_wordnet_sg
4      [a bonehead or [Z] is a [MASK]., a bonehead or...                                          [MISSING]
5      [a nirvana or [Z] is a [MASK]., a nirvana or [...  [enlightenment, beatification, blessedness, be...
7      [a bogolin or [Z] is a [MASK]., a bogolin or [...                                          [MISSING]
8      [a maelstrom or [Z] is a [MASK]., a maelstrom ...    [whirlpool, vortex, current, charybdi, torrent]
10     [a witchery or [Z] is a [MASK]., a witchery or...  [witchcraft, necromancy, sorcery, satanism, ob...
...                                                  ...                                                ...
12717  [a cataract or [Z] is a [MASK]., a cataract or...  [retinopathy, keratonosus, drusen, glaucoma, t...
12719  [a fresco or [Z] is a [MASK]., a fresco or [Z]...                                          [MISSING]
12720  [a mongrel or [Z] is a [MASK]., a mongrel or [...                     [mutt, curs, fice, dog, feist]
12722  [a tronador or [Z] is a [MASK]., a tronador or...                                          [MISSING]
12723  [a repulsion or [Z] is a [MASK]., a repulsion ...  [revulsion, repugnance, attraction, thrust, ex...

[6557 rows x 2 columns]
                                                 lsp_dap                            subj_anchors_wordnet_pl
4      [[MASK] such as boneheads and [Z]., [MASK], in...                                          [MISSING]
5      [[MASK] such as nirvana and [Z]., [MASK], incl...  [enlightenments, beatifications, blessednesses...
7      [[MASK] such as bogolins and [Z]., [MASK], inc...                                          [MISSING]
8      [[MASK] such as maelstrom and [Z]., [MASK], in...  [whirlpools, vortices, current, charybdis, tor...
10     [[MASK] such as witcheries and [Z]., [MASK], i...  [witchcrafts, necromancies, sorceries, satanis...
...                                                  ...                                                ...
12717  [[MASK] such as cataract and [Z]., [MASK], inc...  [retinopathy, keratonosus, drusen, glaucoma, t...
12719  [[MASK] such as frescoes and [Z]., [MASK], inc...                                          [MISSING]
12720  [[MASK] such as mongrel and [Z]., [MASK], incl...                 [mutts, curs, fices, dogs, feists]
12722  [[MASK] such as tronadors and [Z]., [MASK], in...                                          [MISSING]
12723  [[MASK] such as repulsions and [Z]., [MASK], i...  [revulsions, repugnances, attractions, thrust,...

[6557 rows x 2 columns]
	 step3: fill mask in dap anchors
  0%|          | 0/6557 [00:00<?, ?it/s]/home/chunhua/.local/lib/python3.8/site-packages/transformers/pipelines/base.py:1043: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(
  7%|▋         | 443/6557 [01:00<13:48,  7.38it/s]  7%|▋         | 443/6557 [01:20<13:48,  7.38it/s] 14%|█▍        | 940/6557 [02:00<11:50,  7.90it/s] 14%|█▍        | 940/6557 [02:20<11:50,  7.90it/s] 21%|██        | 1381/6557 [03:00<11:16,  7.65it/s] 21%|██        | 1381/6557 [03:20<11:16,  7.65it/s] 28%|██▊       | 1834/6557 [04:00<10:21,  7.60it/s] 28%|██▊       | 1834/6557 [04:20<10:21,  7.60it/s] 35%|███▍      | 2285/6557 [05:00<09:24,  7.57it/s] 35%|███▍      | 2285/6557 [05:20<09:24,  7.57it/s] 42%|████▏     | 2744/6557 [06:00<08:22,  7.59it/s] 42%|████▏     | 2744/6557 [06:20<08:22,  7.59it/s] 49%|████▊     | 3183/6557 [07:00<07:29,  7.50it/s] 49%|████▊     | 3183/6557 [07:20<07:29,  7.50it/s] 55%|█████▌    | 3635/6557 [08:00<06:29,  7.51it/s] 55%|█████▌    | 3635/6557 [08:20<06:29,  7.51it/s] 62%|██████▏   | 4069/6557 [09:00<05:35,  7.42it/s] 62%|██████▏   | 4069/6557 [09:20<05:35,  7.42it/s] 69%|██████▉   | 4519/6557 [10:00<04:33,  7.44it/s] 69%|██████▉   | 4519/6557 [10:20<04:33,  7.44it/s] 76%|███████▌  | 4956/6557 [11:00<03:36,  7.39it/s] 76%|███████▌  | 4956/6557 [11:20<03:36,  7.39it/s] 82%|████████▏ | 5407/6557 [12:00<02:34,  7.43it/s] 82%|████████▏ | 5407/6557 [12:20<02:34,  7.43it/s] 90%|████████▉ | 5871/6557 [13:01<01:31,  7.51it/s] 90%|████████▉ | 5871/6557 [13:20<01:31,  7.51it/s] 96%|█████████▌| 6297/6557 [14:01<00:35,  7.39it/s] 96%|█████████▌| 6297/6557 [14:20<00:35,  7.39it/s]100%|██████████| 6557/6557 [14:37<00:00,  7.47it/s]
  0%|          | 0/6557 [00:00<?, ?it/s]  3%|▎         | 228/6557 [01:00<27:50,  3.79it/s]  3%|▎         | 228/6557 [01:12<27:50,  3.79it/s]  7%|▋         | 461/6557 [02:00<26:25,  3.84it/s]  7%|▋         | 461/6557 [02:12<26:25,  3.84it/s] 11%|█         | 713/6557 [03:00<24:19,  4.00it/s] 11%|█         | 713/6557 [03:12<24:19,  4.00it/s] 15%|█▍        | 965/6557 [04:00<22:51,  4.08it/s] 15%|█▍        | 965/6557 [04:12<22:51,  4.08it/s] 18%|█▊        | 1195/6557 [05:00<22:26,  3.98it/s] 18%|█▊        | 1195/6557 [05:12<22:26,  3.98it/s] 22%|██▏       | 1425/6557 [06:00<21:47,  3.93it/s] 22%|██▏       | 1425/6557 [06:12<21:47,  3.93it/s] 25%|██▌       | 1668/6557 [07:01<20:33,  3.96it/s] 25%|██▌       | 1668/6557 [07:12<20:33,  3.96it/s] 29%|██▉       | 1891/6557 [08:01<20:02,  3.88it/s] 29%|██▉       | 1891/6557 [08:12<20:02,  3.88it/s] 32%|███▏      | 2122/6557 [09:01<19:06,  3.87it/s] 32%|███▏      | 2122/6557 [09:12<19:06,  3.87it/s] 36%|███▌      | 2344/6557 [10:01<18:25,  3.81it/s] 36%|███▌      | 2344/6557 [10:12<18:25,  3.81it/s] 39%|███▉      | 2588/6557 [11:01<17:00,  3.89it/s] 39%|███▉      | 2588/6557 [11:12<17:00,  3.89it/s] 43%|████▎     | 2817/6557 [12:01<16:07,  3.86it/s] 43%|████▎     | 2817/6557 [12:12<16:07,  3.86it/s] 46%|████▋     | 3040/6557 [13:01<15:21,  3.82it/s] 46%|████▋     | 3040/6557 [13:12<15:21,  3.82it/s] 50%|████▉     | 3269/6557 [14:02<14:21,  3.82it/s] 50%|████▉     | 3269/6557 [14:12<14:21,  3.82it/s] 53%|█████▎    | 3504/6557 [15:02<13:13,  3.85it/s] 53%|█████▎    | 3504/6557 [15:12<13:13,  3.85it/s] 57%|█████▋    | 3719/6557 [16:02<12:33,  3.76it/s] 57%|█████▋    | 3719/6557 [16:12<12:33,  3.76it/s] 60%|██████    | 3942/6557 [17:02<11:37,  3.75it/s] 60%|██████    | 3942/6557 [17:12<11:37,  3.75it/s] 64%|██████▎   | 4165/6557 [18:02<10:40,  3.74it/s] 64%|██████▎   | 4165/6557 [18:12<10:40,  3.74it/s] 67%|██████▋   | 4395/6557 [19:02<09:35,  3.76it/s] 67%|██████▋   | 4395/6557 [19:22<09:35,  3.76it/s] 70%|███████   | 4613/6557 [20:02<08:42,  3.72it/s] 70%|███████   | 4613/6557 [20:22<08:42,  3.72it/s] 74%|███████▍  | 4836/6557 [21:03<07:43,  3.72it/s] 74%|███████▍  | 4836/6557 [21:22<07:43,  3.72it/s] 77%|███████▋  | 5057/6557 [22:03<06:44,  3.71it/s] 77%|███████▋  | 5057/6557 [22:22<06:44,  3.71it/s] 81%|████████  | 5297/6557 [23:03<05:32,  3.79it/s] 81%|████████  | 5297/6557 [23:22<05:32,  3.79it/s] 84%|████████▍ | 5503/6557 [24:03<04:46,  3.67it/s] 84%|████████▍ | 5503/6557 [24:22<04:46,  3.67it/s] 87%|████████▋ | 5692/6557 [25:03<04:06,  3.52it/s] 87%|████████▋ | 5692/6557 [25:22<04:06,  3.52it/s] 90%|████████▉ | 5889/6557 [26:04<03:14,  3.44it/s] 90%|████████▉ | 5889/6557 [26:22<03:14,  3.44it/s] 92%|█████████▏| 6059/6557 [27:04<02:33,  3.25it/s] 92%|█████████▏| 6059/6557 [27:22<02:33,  3.25it/s] 95%|█████████▌| 6237/6557 [28:04<01:41,  3.17it/s] 95%|█████████▌| 6237/6557 [28:23<01:41,  3.17it/s] 98%|█████████▊| 6440/6557 [29:04<00:36,  3.23it/s] 98%|█████████▊| 6440/6557 [29:23<00:36,  3.23it/s]100%|██████████| 6557/6557 [29:36<00:00,  3.69it/s]
     sub_label  obj_label relation                                   masked_sentences                                         sub_sister  uuid  sub_position sub_label_sg sub_label_pl                                            def_sap                                            def_dap                                            lsp_sap                                            lsp_dap                                     anchor_lsp_sap                  sub_label_sgpl  obj_in_BERT                                  obj_mask_sentence                            obj_mask_sentence_score                                   obj_mask_def_sap                             obj_mask_def_sap_score                                   obj_mask_lsp_sap                             obj_mask_lsp_sap_score                               subj_anchors_wordnet                            subj_anchors_wordnet_sg                            subj_anchors_wordnet_pl                           subj_anchors_wordnet_all  \
4    boneheads     [band]      IsA  [A bonehead is a [MASK]., A bonehead is an [MA...  [knucklehead, hammerhead, loggerhead, dumbass,...     4             2     bonehead    boneheads  [a bonehead is a [MASK]., a bonehead is a type...  [a bonehead or [Z] is a [MASK]., a bonehead or...  [[MASK] such as boneheads., [MASK], including ...  [[MASK] such as boneheads and [Z]., [MASK], in...  [such as boneheads and [MASK]., such as bonehe...    boneheads bonehead boneheads            1  [animal, individual, actor, insect, anchor, el...  {'animal': -7.760352993909391, 'individual': -...  [fish, turtle, bird, bone, animal, catfish, pi...  {'fish': -9.285614179926169, 'turtle': -9.8092...  [yeah, bone, people, thing, animal, band, yes,...  {'yeah': -8.830292573364021, 'bones': -9.55534...                                          [MISSING]                                          [MISSING]                                          [MISSING]                                          [MISSING]   
5      nirvana    [album]      IsA  [A nirvana is a [MASK]., A nirvana is an [MASK].]  [air, inside, zone, top, vacuity, hell, county...     5             2      nirvana      nirvana  [a nirvana is a [MASK]., a nirvana is a type o...  [a nirvana or [Z] is a [MASK]., a nirvana or [...  [[MASK] such as nirvana., [MASK], including ni...  [[MASK] such as nirvana and [Z]., [MASK], incl...  [such as nirvana and [MASK]., such as nirvana ...         nirvana nirvana nirvana            1  [absolute, emptiness, illusion, place, orgasm,...  {'absolute': -9.548287603994723, 'emptiness': ...  [paradise, building, bliss, house, heaven, uto...  {'paradise': -8.991536014932738, 'building': -...  [poems, story, music, thing, place, writings, ...  {'poems': -8.578334052140976, 'stories': -8.68...  [enlightenments, beatifications, blessednesses...  [enlightenment, beatification, blessedness, be...  [enlightenments, beatifications, blessednesses...  [enlightenment, beatification, blessedness, be...   
7     bogolins  [village]      IsA  [A bogolin is a [MASK]., A bogolin is an [MASK].]                                                 []     7             2      bogolin     bogolins  [a bogolin is a [MASK]., a bogolin is a type o...  [a bogolin or [Z] is a [MASK]., a bogolin or [...  [[MASK] such as bogolins., [MASK], including b...  [[MASK] such as bogolins and [Z]., [MASK], inc...  [such as bogolins and [MASK]., such as bogolin...       bogolins bogolin bogolins            1  [animal, elephant, insect, archer, asteroid, e...  {'animal': -8.336883302933115, 'elephant': -10...  [pig, dog, sausage, horse, cannon, fish, log, ...  {'pig': -10.39650824033111, 'dog': -11.0473997...  [thing, animal, bird, dog, fish, species, peop...  {'things': -10.210964390926904, 'animals': -10...                                          [MISSING]                                          [MISSING]                                          [MISSING]                                          [MISSING]   
8    maelstrom     [book]      IsA  [A maelstrom is a [MASK]., A maelstrom is an [...  [whirlpool, vortex, twist, riptide, torrent, u...     8             2    maelstrom    maelstrom  [a maelstrom is a [MASK]., a maelstrom is a ty...  [a maelstrom or [Z] is a [MASK]., a maelstrom ...  [[MASK] such as maelstrom., [MASK], including ...  [[MASK] such as maelstrom and [Z]., [MASK], in...  [such as maelstrom and [MASK]., such as maelst...   maelstrom maelstrom maelstrom            1  [avalanche, illusion, storm, abyss, event, wat...  {'avalanche': -7.353038456850604, 'illusion': ...  [storm, avalanche, waterfall, landslide, disas...  {'storm': -7.503555647031791, 'avalanche': -8....  [hell, yes, story, event, storm, works, film, ...  {'hell': -9.531064860314544, 'yes': -9.5784095...  [whirlpool, vortex, current, charybdis, torrents]    [whirlpool, vortex, current, charybdi, torrent]  [whirlpools, vortices, current, charybdis, tor...    [whirlpool, vortex, current, charybdi, torrent]   
10  witcheries     [film]      IsA  [A witchery is a [MASK]., A witchery is an [MA...  [diabolism, witchcraft, enchantment, demonism,...    10             2     witchery   witcheries  [a witchery is a [MASK]., a witchery is a type...  [a witchery or [Z] is a [MASK]., a witchery or...  [[MASK] such as witcheries., [MASK], including...  [[MASK] such as witcheries and [Z]., [MASK], i...  [such as witcheries and [MASK]., such as witch...  witcheries witchery witcheries            1  [illusion, witch, evil, coven, art, witchcraft...  {'illusion': -7.40947151763448, 'witch': -7.50...  [witchcraft, witch, coven, magic, shop, bakery...  {'witchcraft': -7.1989752767408035, 'witch': -...  [witch, witchcraft, thing, place, ritual, inst...  {'witches': -7.678177575181099, 'witchcraft': ...  [witchcrafts, necromancies, sorceries, satanis...  [witchcraft, necromancy, sorcery, satanism, ob...  [witchcrafts, necromancies, sorceries, satanis...  [witchcraft, necromancy, sorcery, satanism, ob...   

             subj_anchors_combined  anchor_num                           def_dap_with_subj_anchor                           lsp_dap_with_subj_anchor                                   obj_mask_def_dap                             obj_mask_def_dap_score                                   obj_mask_lsp_dap                             obj_mask_lsp_dap_score  
4     boneheads bonehead boneheads           1  [a bonehead or [Z] is a [MASK]., a bonehead or...  [[MASK] such as boneheads and [Z]., [MASK], in...  [bone, skull, fish, turtle, nail, rock, bird, ...  {'bone': -6.986862514593536, 'skull': -10.0750...  [band, thing, artist, group, people, punk, ani...  {'bands': -8.74537531909171, 'things': -9.2003...  
5          nirvana nirvana nirvana           5  [a nirvana or an enlightenment is a [MASK]., a...  [[MASK] such as nirvana and enlightenments., [...  [miracle, light, meditation, paradise, prayer,...  {'miracle': -9.26951433548801, 'light': -9.561...  [concept, thing, spirituality, practice, relig...  {'concepts': -8.771203189917266, 'things': -9....  
7        bogolins bogolin bogolins           1  [a bogolin or [Z] is a [MASK]., a bogolin or [...  [[MASK] such as bogolins and [Z]., [MASK], inc...  [grape, horn, string, coin, rock, particle, sa...  {'grape': -10.268551742528098, 'horn': -10.554...  [word, poems, story, name, thing, term, works,...  {'words': -9.280488363218304, 'poems': -9.4037...  
8    maelstrom maelstrom maelstrom           5  [a maelstrom or a whirlpool is a [MASK]., a ma...  [[MASK] such as maelstrom and whirlpools., [MA...  [storm, waterfall, vortex, tornado, phenomenon...  {'storm': -7.255300944450738, 'waterfall': -9....  [storm, phenomenon, event, tolkien, thing, flo...  {'storms': -8.308949386453028, 'phenomena': -9...  
10  witcheries witchery witcheries           5  [a witchery or a witchcraft is a [MASK]., a wi...  [[MASK] such as witcheries and witchcrafts., [...  [witchcraft, magic, religion, crime, spell, wi...  {'witchcraft': -6.224062715956907, 'magic': -7...  [witchcraft, thing, witch, practice, religion,...  {'witchcraft': -7.617842767833141, 'things': -...  
---------------------------------------- anchor evaluation ----------------------------------------
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:832: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'p{k}_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: concept_evaluation(x[0], eval(x[1])[:k] if isinstance(x[1], str) else x[1][:k]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
anchored_prompts.py:905: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[f'mrr_{suffix}'] = df[[label_col, pred_col]].apply(lambda x: get_highest_mrr_among_labels(x[0], x[1]), axis=1 )
begin{tabular}{rlrrrr}
hline
    	 mask_type                	   p@1 	   p@5 	   p@10 	   mrr 
hline
  0 	 subj_anchors_wordnet_sg  	  52.4 	  78.2 	   78.2 	  62.3 
  1 	 subj_anchors_wordnet_all 	  52.4 	  78.2 	   78.2 	  62.3 
hline
end{tabular}
---------------------------------------- obj_label evaluation ----------------------------------------
begin{tabular}{rlrrrrr}
hline
    	 mask_type   	   p@1 	   p@5 	   p@10 	   mrr 	   mask_type_id 
hline
  1 	 def_sap     	   5   	  11.5 	   14.8 	   7.8 	              1 
  2 	 lsp_sap     	   4.6 	  13   	   18.5 	   8.4 	              3 
  3 	 def_dap     	   6.1 	  12.6 	   15.8 	   8.9 	              2 
  4 	 lsp_dap     	   5.5 	  14   	   18.8 	   9.2 	              4 
hline
end{tabular}
save log/bert-large-uncased/hypernymsuite/SHWARTZ/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.SHWARTZ.tsv
save log/bert-large-uncased/hypernymsuite/SHWARTZ/df_all_use_global_dap_True_max_anchor_num_5_anchor_scorer_probAvg_filter_obj_True_filter_objects_with_input_True_anchor_source_WordNet_wns_False_wnf_False_swow_score_source_None.SHWARTZ.csv
